{"ast":null,"code":"import { ref, watch, shallowRef, onBeforeUnmount } from 'vue';\nimport { Editor, Toolbar } from '@wangeditor/editor-for-vue';\nimport '@wangeditor/editor/dist/css/style.css';\nimport { uploadFile } from '@/api/fileUpload';\nimport { ElMessage } from 'element-plus';\n\n// 接收父组件传来的内容\n\nexport default {\n  __name: 'RichTextEditor',\n  props: {\n    modelValue: String,\n    visible: Boolean\n  },\n  emits: ['update:modelValue'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const emit = __emit;\n    const editorRef = shallowRef();\n    const initialValue = ref('');\n\n    // 初始化设置初始值\n    watch(() => props.modelValue, val => {\n      if (editorRef.value && val !== editorRef.value.getHtml()) {\n        editorRef.value.setHtml(val || '');\n      } else {\n        initialValue.value = val || '';\n      }\n    }, {\n      immediate: true\n    });\n\n    // 富文本变化同步到父组件\n    const handleChange = editor => {\n      const html = editor.getHtml();\n      emit('update:modelValue', html);\n    };\n    const editorConfig = {\n      placeholder: '请输入内容...',\n      MENU_CONF: {\n        uploadImage: {\n          async customUpload(file, insertFn) {\n            try {\n              const res = await uploadFile(file);\n              insertFn(res.data, '', '');\n              ElMessage.success('图片上传成功');\n            } catch {\n              ElMessage.error('图片上传失败');\n            }\n          }\n        }\n      }\n    };\n    const handleEditorCreated = editor => {\n      editorRef.value = editor;\n      if (props.modelValue) {\n        editor.setHtml(props.modelValue);\n      }\n    };\n    watch(() => props.visible, val => {\n      if (!val && editorRef.value) {\n        editorRef.value.destroy();\n        editorRef.value = null;\n      }\n    });\n    onBeforeUnmount(() => {\n      if (editorRef.value) {\n        editorRef.value.destroy();\n        editorRef.value = null;\n      }\n    });\n    const __returned__ = {\n      props,\n      emit,\n      editorRef,\n      initialValue,\n      handleChange,\n      editorConfig,\n      handleEditorCreated,\n      ref,\n      watch,\n      shallowRef,\n      onBeforeUnmount,\n      get Editor() {\n        return Editor;\n      },\n      get Toolbar() {\n        return Toolbar;\n      },\n      get uploadFile() {\n        return uploadFile;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","watch","shallowRef","onBeforeUnmount","Editor","Toolbar","uploadFile","ElMessage","props","__props","emit","__emit","editorRef","initialValue","modelValue","val","value","getHtml","setHtml","immediate","handleChange","editor","html","editorConfig","placeholder","MENU_CONF","uploadImage","customUpload","file","insertFn","res","data","success","error","handleEditorCreated","visible","destroy"],"sources":["C:/Users/32561/Desktop/毕设仓库/beauty-front/src/components/RichTextEditor.vue"],"sourcesContent":["<template>\r\n  <div class=\"editor-wrapper\" v-if=\"visible\">\r\n    <Toolbar v-if=\"editorRef\" :editor=\"editorRef\" mode=\"default\" />\r\n    <Editor\r\n        :defaultConfig=\"editorConfig\"\r\n        :value=\"initialValue\"\r\n        mode=\"default\"\r\n        style=\"height: 300px; width: 100%; overflow-y: auto\"\r\n        @onCreated=\"handleEditorCreated\"\r\n        @onChange=\"handleChange\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, watch, shallowRef, onBeforeUnmount } from 'vue'\r\nimport { Editor, Toolbar } from '@wangeditor/editor-for-vue'\r\nimport '@wangeditor/editor/dist/css/style.css'\r\nimport { uploadFile } from '@/api/fileUpload'\r\nimport { ElMessage } from 'element-plus'\r\n\r\n// 接收父组件传来的内容\r\nconst props = defineProps({\r\n  modelValue: String,\r\n  visible: Boolean\r\n})\r\nconst emit = defineEmits(['update:modelValue'])\r\n\r\nconst editorRef = shallowRef()\r\nconst initialValue = ref('')\r\n\r\n// 初始化设置初始值\r\nwatch(\r\n    () => props.modelValue,\r\n    (val) => {\r\n      if (editorRef.value && val !== editorRef.value.getHtml()) {\r\n        editorRef.value.setHtml(val || '')\r\n      } else {\r\n        initialValue.value = val || ''\r\n      }\r\n    },\r\n    { immediate: true }\r\n)\r\n\r\n// 富文本变化同步到父组件\r\nconst handleChange = (editor) => {\r\n  const html = editor.getHtml()\r\n  emit('update:modelValue', html)\r\n}\r\n\r\nconst editorConfig = {\r\n  placeholder: '请输入内容...',\r\n  MENU_CONF: {\r\n    uploadImage: {\r\n      async customUpload(file, insertFn) {\r\n        try {\r\n          const res = await uploadFile(file)\r\n          insertFn(res.data, '', '')\r\n          ElMessage.success('图片上传成功')\r\n        } catch {\r\n          ElMessage.error('图片上传失败')\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst handleEditorCreated = (editor) => {\r\n  editorRef.value = editor\r\n  if (props.modelValue) {\r\n    editor.setHtml(props.modelValue)\r\n  }\r\n}\r\n\r\nwatch(\r\n    () => props.visible,\r\n    (val) => {\r\n      if (!val && editorRef.value) {\r\n        editorRef.value.destroy()\r\n        editorRef.value = null\r\n      }\r\n    }\r\n)\r\n\r\nonBeforeUnmount(() => {\r\n  if (editorRef.value) {\r\n    editorRef.value.destroy()\r\n    editorRef.value = null\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.editor-wrapper {\r\n  border: 1px solid #dcdfe6;\r\n  border-radius: 4px;\r\n  overflow: hidden;\r\n}\r\n</style>\r\n"],"mappings":"AAeA,SAASA,GAAG,EAAEC,KAAK,EAAEC,UAAU,EAAEC,eAAe,QAAQ,KAAK;AAC7D,SAASC,MAAM,EAAEC,OAAO,QAAQ,4BAA4B;AAC5D,OAAO,uCAAuC;AAC9C,SAASC,UAAU,QAAQ,kBAAkB;AAC7C,SAASC,SAAS,QAAQ,cAAc;;AAExC;;;;;;;;;;;;;;IACA,MAAMC,KAAK,GAAGC,OAGZ;IACF,MAAMC,IAAI,GAAGC,MAAkC;IAE/C,MAAMC,SAAS,GAAGV,UAAU,CAAC,CAAC;IAC9B,MAAMW,YAAY,GAAGb,GAAG,CAAC,EAAE,CAAC;;IAE5B;IACAC,KAAK,CACD,MAAMO,KAAK,CAACM,UAAU,EACrBC,GAAG,IAAK;MACP,IAAIH,SAAS,CAACI,KAAK,IAAID,GAAG,KAAKH,SAAS,CAACI,KAAK,CAACC,OAAO,CAAC,CAAC,EAAE;QACxDL,SAAS,CAACI,KAAK,CAACE,OAAO,CAACH,GAAG,IAAI,EAAE,CAAC;MACpC,CAAC,MAAM;QACLF,YAAY,CAACG,KAAK,GAAGD,GAAG,IAAI,EAAE;MAChC;IACF,CAAC,EACD;MAAEI,SAAS,EAAE;IAAK,CACtB,CAAC;;IAED;IACA,MAAMC,YAAY,GAAIC,MAAM,IAAK;MAC/B,MAAMC,IAAI,GAAGD,MAAM,CAACJ,OAAO,CAAC,CAAC;MAC7BP,IAAI,CAAC,mBAAmB,EAAEY,IAAI,CAAC;IACjC,CAAC;IAED,MAAMC,YAAY,GAAG;MACnBC,WAAW,EAAE,UAAU;MACvBC,SAAS,EAAE;QACTC,WAAW,EAAE;UACX,MAAMC,YAAYA,CAACC,IAAI,EAAEC,QAAQ,EAAE;YACjC,IAAI;cACF,MAAMC,GAAG,GAAG,MAAMxB,UAAU,CAACsB,IAAI,CAAC;cAClCC,QAAQ,CAACC,GAAG,CAACC,IAAI,EAAE,EAAE,EAAE,EAAE,CAAC;cAC1BxB,SAAS,CAACyB,OAAO,CAAC,QAAQ,CAAC;YAC7B,CAAC,CAAC,MAAM;cACNzB,SAAS,CAAC0B,KAAK,CAAC,QAAQ,CAAC;YAC3B;UACF;QACF;MACF;IACF,CAAC;IAED,MAAMC,mBAAmB,GAAIb,MAAM,IAAK;MACtCT,SAAS,CAACI,KAAK,GAAGK,MAAM;MACxB,IAAIb,KAAK,CAACM,UAAU,EAAE;QACpBO,MAAM,CAACH,OAAO,CAACV,KAAK,CAACM,UAAU,CAAC;MAClC;IACF,CAAC;IAEDb,KAAK,CACD,MAAMO,KAAK,CAAC2B,OAAO,EAClBpB,GAAG,IAAK;MACP,IAAI,CAACA,GAAG,IAAIH,SAAS,CAACI,KAAK,EAAE;QAC3BJ,SAAS,CAACI,KAAK,CAACoB,OAAO,CAAC,CAAC;QACzBxB,SAAS,CAACI,KAAK,GAAG,IAAI;MACxB;IACF,CACJ,CAAC;IAEDb,eAAe,CAAC,MAAM;MACpB,IAAIS,SAAS,CAACI,KAAK,EAAE;QACnBJ,SAAS,CAACI,KAAK,CAACoB,OAAO,CAAC,CAAC;QACzBxB,SAAS,CAACI,KAAK,GAAG,IAAI;MACxB;IACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}