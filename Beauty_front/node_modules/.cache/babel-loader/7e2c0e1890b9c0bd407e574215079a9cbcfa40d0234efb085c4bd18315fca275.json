{"ast":null,"code":"import { ref, onMounted } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nimport { offlineReservationList, updateReservation } from '@/api/reservation';\nexport default {\n  __name: 'MyOfflineReservation',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const route = useRoute();\n    const router = useRouter();\n    const pageNum = ref(1);\n    const pageSize = ref(15);\n    const total = ref(0);\n    const tableData = ref([]);\n    const status = ref(0); // 新增：默认0\n    const offlineId = route.params.offline_id;\n    const loadingMap = ref({});\n    const statusOptions = [{\n      label: '尚未履约',\n      value: 0\n    }, {\n      label: '未评价',\n      value: 1\n    }, {\n      label: '爽约',\n      value: 2\n    }, {\n      label: '已评价',\n      value: 3\n    }];\n    const statusMap = {\n      0: '尚未履约',\n      1: '未评价',\n      2: '爽约',\n      3: '已评价'\n    };\n    const fetchReservations = async () => {\n      try {\n        const res = await offlineReservationList({\n          pageNum: pageNum.value,\n          pageSize: pageSize.value,\n          offline_id: offlineId,\n          status: status.value\n        });\n        tableData.value = res.data.items || [];\n        total.value = res.data.total || 0;\n      } catch (err) {\n        ElMessage.error(err.msg || '获取预约列表失败');\n      }\n    };\n    const handlePageChange = newPage => {\n      pageNum.value = newPage;\n      fetchReservations();\n    };\n\n    // 新增：切换 status 时\n    const handleStatusChange = val => {\n      pageNum.value = 1; // 每次切换回第一页\n      fetchReservations();\n    };\n    const verifyReservation = reservation => {\n      ElMessageBox.confirm(`确定核销预约ID「${reservation.reservation_id}」吗？`, '提示', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'success'\n      }).then(async () => {\n        loadingMap.value[reservation.reservation_id] = true;\n        try {\n          await updateReservation(reservation.reservation_id, 1);\n          ElMessage.success('核销成功');\n          fetchReservations();\n        } catch (err) {\n          ElMessage.error(err.msg || '核销失败');\n        } finally {\n          loadingMap.value[reservation.reservation_id] = false;\n        }\n      }).catch(() => {});\n    };\n    const timeoutReservation = reservation => {\n      ElMessageBox.confirm(`确定将预约ID「${reservation.reservation_id}」标记为超时吗？`, '提示', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async () => {\n        loadingMap.value[reservation.reservation_id] = true;\n        try {\n          await updateReservation(reservation.reservation_id, 2);\n          ElMessage.success('标记超时成功');\n          fetchReservations();\n        } catch (err) {\n          ElMessage.error(err.msg || '操作失败');\n        } finally {\n          loadingMap.value[reservation.reservation_id] = false;\n        }\n      }).catch(() => {});\n    };\n    onMounted(() => {\n      fetchReservations();\n    });\n    const __returned__ = {\n      route,\n      router,\n      pageNum,\n      pageSize,\n      total,\n      tableData,\n      status,\n      offlineId,\n      loadingMap,\n      statusOptions,\n      statusMap,\n      fetchReservations,\n      handlePageChange,\n      handleStatusChange,\n      verifyReservation,\n      timeoutReservation,\n      ref,\n      onMounted,\n      get useRoute() {\n        return useRoute;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get ElMessageBox() {\n        return ElMessageBox;\n      },\n      get offlineReservationList() {\n        return offlineReservationList;\n      },\n      get updateReservation() {\n        return updateReservation;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","useRoute","useRouter","ElMessage","ElMessageBox","offlineReservationList","updateReservation","route","router","pageNum","pageSize","total","tableData","status","offlineId","params","offline_id","loadingMap","statusOptions","label","value","statusMap","fetchReservations","res","data","items","err","error","msg","handlePageChange","newPage","handleStatusChange","val","verifyReservation","reservation","confirm","reservation_id","confirmButtonText","cancelButtonText","type","then","success","catch","timeoutReservation"],"sources":["C:/Users/32561/Desktop/毕设仓库/beauty-front/src/views/Mine/MyOfflineReservation.vue"],"sourcesContent":["<script setup>\r\nimport {ref, onMounted} from 'vue'\r\nimport {useRoute, useRouter} from 'vue-router'\r\nimport {ElMessage, ElMessageBox} from 'element-plus'\r\nimport {offlineReservationList, updateReservation} from '@/api/reservation'\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\n\r\nconst pageNum = ref(1)\r\nconst pageSize = ref(15)\r\nconst total = ref(0)\r\nconst tableData = ref([])\r\nconst status = ref(0)  // 新增：默认0\r\nconst offlineId = route.params.offline_id\r\nconst loadingMap = ref({})\r\n\r\nconst statusOptions = [\r\n  { label: '尚未履约', value: 0 },\r\n  { label: '未评价', value: 1 },\r\n  { label: '爽约', value: 2 },\r\n  { label: '已评价', value: 3 }\r\n]\r\n\r\nconst statusMap = {\r\n  0: '尚未履约',\r\n  1: '未评价',\r\n  2: '爽约',\r\n  3: '已评价'\r\n}\r\n\r\nconst fetchReservations = async () => {\r\n  try {\r\n    const res = await offlineReservationList({\r\n      pageNum: pageNum.value,\r\n      pageSize: pageSize.value,\r\n      offline_id: offlineId,\r\n      status: status.value\r\n    })\r\n    tableData.value = res.data.items || []\r\n    total.value = res.data.total || 0\r\n  } catch (err) {\r\n    ElMessage.error(err.msg || '获取预约列表失败')\r\n  }\r\n}\r\n\r\nconst handlePageChange = (newPage) => {\r\n  pageNum.value = newPage\r\n  fetchReservations()\r\n}\r\n\r\n// 新增：切换 status 时\r\nconst handleStatusChange = (val) => {\r\n  pageNum.value = 1  // 每次切换回第一页\r\n  fetchReservations()\r\n}\r\n\r\nconst verifyReservation = (reservation) => {\r\n  ElMessageBox.confirm(\r\n      `确定核销预约ID「${reservation.reservation_id}」吗？`,\r\n      '提示',\r\n      {\r\n        confirmButtonText: '确认',\r\n        cancelButtonText: '取消',\r\n        type: 'success'\r\n      }\r\n  ).then(async () => {\r\n    loadingMap.value[reservation.reservation_id] = true\r\n    try {\r\n      await updateReservation(reservation.reservation_id, 1)\r\n      ElMessage.success('核销成功')\r\n      fetchReservations()\r\n    } catch (err) {\r\n      ElMessage.error(err.msg || '核销失败')\r\n    } finally {\r\n      loadingMap.value[reservation.reservation_id] = false\r\n    }\r\n  }).catch(() => {})\r\n}\r\n\r\nconst timeoutReservation = (reservation) => {\r\n  ElMessageBox.confirm(\r\n      `确定将预约ID「${reservation.reservation_id}」标记为超时吗？`,\r\n      '提示',\r\n      {\r\n        confirmButtonText: '确认',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }\r\n  ).then(async () => {\r\n    loadingMap.value[reservation.reservation_id] = true\r\n    try {\r\n      await updateReservation(reservation.reservation_id, 2)\r\n      ElMessage.success('标记超时成功')\r\n      fetchReservations()\r\n    } catch (err) {\r\n      ElMessage.error(err.msg || '操作失败')\r\n    } finally {\r\n      loadingMap.value[reservation.reservation_id] = false\r\n    }\r\n  }).catch(() => {})\r\n}\r\n\r\nonMounted(() => {\r\n  fetchReservations()\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div class=\"main-content\">\r\n    <el-button\r\n        class=\"back-btn\"\r\n        type=\"primary\"\r\n        plain\r\n        @click=\"() => router.back()\"\r\n    >\r\n      返回\r\n    </el-button>\r\n\r\n    <div class=\"section-title\">门店预约管理</div>\r\n\r\n    <div style=\"margin-bottom: 20px; \">\r\n      <el-select v-model=\"status\" placeholder=\"请选择预约状态\" @change=\"handleStatusChange\" style=\"width: 200px;\">\r\n        <el-option\r\n            v-for=\"item in statusOptions\"\r\n            :key=\"item.value\"\r\n            :label=\"item.label\"\r\n            :value=\"item.value\"\r\n        />\r\n      </el-select>\r\n    </div>\r\n\r\n    <el-table :data=\"tableData\" style=\"width: 100%;\">\r\n      <el-table-column prop=\"reservation_id\" label=\"预约ID\" width=\"100\"/>\r\n      <el-table-column prop=\"user_id\" label=\"顾客ID\" width=\"100\"/>\r\n      <el-table-column prop=\"start_at\" label=\"预约开始时间\" width=\"200\"/>\r\n      <el-table-column prop=\"end_at\" label=\"预约结束时间\" width=\"200\"/>\r\n      <el-table-column prop=\"status\" label=\"状态\" width=\"120\">\r\n        <template #default=\"{ row }\">\r\n          <el-tag>{{ statusMap[row.status] }}</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"point\" label=\"评分\" width=\"100\">\r\n        <template #default=\"{ row }\">\r\n          <span v-if=\"row.comment\">{{ row.point }}</span>\r\n          <span v-else style=\"color: #999;\">暂无评分</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"comment\" label=\"评论\" width=\"520\">\r\n        <template #default=\"{ row }\">\r\n          <div v-if=\"row.comment\" v-html=\"row.comment\"></div>\r\n          <span v-else style=\"color: #999;\">暂无评论</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"操作\" width=\"220\">\r\n        <template #default=\"{ row }\">\r\n          <template v-if=\"row.status === 0\">\r\n            <el-button\r\n                size=\"small\"\r\n                type=\"success\"\r\n                :loading=\"loadingMap[row.reservation_id]\"\r\n                @click=\"verifyReservation(row)\"\r\n            >核销</el-button>\r\n            <el-button\r\n                size=\"small\"\r\n                type=\"danger\"\r\n                :loading=\"loadingMap[row.reservation_id]\"\r\n                @click=\"timeoutReservation(row)\"\r\n            >超时</el-button>\r\n          </template>\r\n          <template v-else>\r\n            <span style=\"color: #999;\">无需操作</span>\r\n          </template>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <div style=\"text-align: center; margin-top: 20px;\">\r\n      <el-pagination\r\n          background\r\n          layout=\"prev, pager, next, ->, total\"\r\n          :total=\"total\"\r\n          :current-page=\"pageNum\"\r\n          :page-size=\"pageSize\"\r\n          @current-change=\"handlePageChange\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.main-content {\r\n  flex: 1;\r\n  width: 1720px;\r\n  margin: 0 auto;\r\n  padding: 20px;\r\n  background: #f5f7fa;\r\n  min-height: 800px;\r\n}\r\n\r\n.section-title {\r\n  font-size: 20px;\r\n  font-weight: bold;\r\n  background-color: #eef1f6;\r\n  padding: 10px 15px;\r\n  border-left: 5px solid #409EFF;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.back-btn {\r\n  margin-bottom: 20px;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}