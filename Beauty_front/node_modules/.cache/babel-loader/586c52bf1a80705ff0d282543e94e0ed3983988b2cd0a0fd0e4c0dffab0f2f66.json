{"ast":null,"code":"import { createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"creation-page\"\n};\nconst _hoisted_2 = {\n  class: \"header\"\n};\nconst _hoisted_3 = {\n  class: \"form-section\"\n};\nconst _hoisted_4 = {\n  class: \"upload-box\"\n};\nconst _hoisted_5 = [\"src\"];\nconst _hoisted_6 = {\n  class: \"editor-section\"\n};\nconst _hoisted_7 = {\n  class: \"submit-btn\"\n};\nexport function render(_ctx, _cache) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_upload = _resolveComponent(\"el-upload\");\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n  const _component_el_option = _resolveComponent(\"el-option\");\n  const _component_el_select = _resolveComponent(\"el-select\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_form = _resolveComponent(\"el-form\");\n  const _component_RichTextEditor = _resolveComponent(\"RichTextEditor\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_el_button, {\n    icon: \"el-icon-arrow-left\",\n    onClick: _cache[0] || (_cache[0] = $event => _ctx.router.back())\n  }, {\n    default: _withCtx(() => _cache[5] || (_cache[5] = [_createTextVNode(\"返回\")])),\n    _: 1 /* STABLE */\n  })]), _createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_form, {\n    model: _ctx.form,\n    \"label-width\": \"80px\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_form_item, {\n      label: \"封面\"\n    }, {\n      default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_4, [_ctx.form.cover_pic ? (_openBlock(), _createElementBlock(\"img\", {\n        key: 0,\n        src: _ctx.form.cover_pic,\n        class: \"cover-img\"\n      }, null, 8 /* PROPS */, _hoisted_5)) : _createCommentVNode(\"v-if\", true), _createVNode(_component_el_upload, {\n        \"http-request\": _ctx.handleUpload,\n        \"show-file-list\": false,\n        accept: \"image/*\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_button, {\n          type: \"primary\"\n        }, {\n          default: _withCtx(() => _cache[6] || (_cache[6] = [_createTextVNode(\"上传封面\")])),\n          _: 1 /* STABLE */\n        })]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"http-request\"])])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, {\n      label: \"分类\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_select, {\n        modelValue: _ctx.form.class_id,\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => _ctx.form.class_id = $event),\n        placeholder: \"请选择分类\",\n        style: {\n          \"width\": \"160px\"\n        }\n      }, {\n        default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.classOptions, cls => {\n          return _openBlock(), _createBlock(_component_el_option, {\n            key: cls.class_id,\n            label: cls.class_name,\n            value: cls.class_id\n          }, null, 8 /* PROPS */, [\"label\", \"value\"]);\n        }), 128 /* KEYED_FRAGMENT */))]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, {\n      label: \"标题\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: _ctx.form.title,\n        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => _ctx.form.title = $event),\n        placeholder: \"1~10字\",\n        maxlength: \"10\",\n        \"show-word-limit\": \"\"\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, {\n      label: \"摘要\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: _ctx.form.abs_text,\n        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => _ctx.form.abs_text = $event),\n        placeholder: \"1~30字\",\n        maxlength: \"30\",\n        \"show-word-limit\": \"\"\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"model\"])]), _createElementVNode(\"div\", _hoisted_6, [_createVNode(_component_RichTextEditor, {\n    ref: \"richEditorRef\",\n    modelValue: _ctx.form.content,\n    \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => _ctx.form.content = $event),\n    visible: _ctx.editorVisible\n  }, null, 8 /* PROPS */, [\"modelValue\", \"visible\"])]), _createElementVNode(\"div\", _hoisted_7, [_createVNode(_component_el_button, {\n    type: \"success\",\n    onClick: _ctx.handleSubmit,\n    loading: _ctx.loading\n  }, {\n    default: _withCtx(() => _cache[7] || (_cache[7] = [_createTextVNode(\"保存修改\")])),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"onClick\", \"loading\"])])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_el_button","icon","onClick","_cache","$event","_ctx","router","back","default","_withCtx","_createTextVNode","_","_hoisted_3","_component_el_form","model","form","_component_el_form_item","label","_hoisted_4","cover_pic","key","src","_hoisted_5","_createCommentVNode","_component_el_upload","handleUpload","accept","type","_component_el_select","modelValue","class_id","placeholder","style","_Fragment","_renderList","classOptions","cls","_createBlock","_component_el_option","class_name","value","_component_el_input","title","maxlength","abs_text","_hoisted_6","_component_RichTextEditor","ref","content","visible","editorVisible","_hoisted_7","handleSubmit","loading"],"sources":["C:\\Users\\32561\\Desktop\\毕设仓库\\beauty-front\\src\\views\\UpdateCreationPage.vue"],"sourcesContent":["<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { useRouter, useRoute } from 'vue-router'\r\nimport { ElMessage } from 'element-plus'\r\nimport { uploadFile } from '@/api/fileUpload'\r\nimport { creationInfo, creationClassList, updateCreation } from '@/api/creation'\r\nimport RichTextEditor from '@/components/RichTextEditor.vue'\r\n\r\nconst router = useRouter()\r\nconst route = useRoute()\r\nconst creationId = route.params.id\r\nconst richEditorRef = ref(null)\r\n\r\nconst form = ref({\r\n  creation_id: null,\r\n  title: '',\r\n  abs_text: '',\r\n  cover_pic: '',\r\n  content: '<p><br></p>',\r\n  class_id: null\r\n})\r\n\r\nconst classOptions = ref([])\r\nconst loading = ref(false)\r\n\r\nconst decodeHTML = (htmlStr) => {\r\n  const textarea = document.createElement('textarea')\r\n  textarea.innerHTML = htmlStr\r\n  return textarea.value\r\n}\r\n\r\n\r\nconst fetchCreationDetail = async () => {\r\n  const res = await creationInfo(creationId)\r\n  form.value = {\r\n    ...res.data,\r\n    content: decodeHTML(res.data.content)\r\n  }\r\n\r\n  editorVisible.value = true\r\n\r\n  await nextTick()\r\n  richEditorRef.value?.editorRef?.setHtml(form.value.content)\r\n}\r\n\r\n\r\nconst fetchCreationDetail = async () => {\r\n  try {\r\n    const res = await creationInfo(creationId)\r\n    const data = res.data\r\n\r\n    form.value = {\r\n      creation_id: data.creation_id,\r\n      title: data.title,\r\n      abs_text: data.abs_text,\r\n      cover_pic: data.cover_pic,\r\n      content: decodeHTML(data.content),\r\n      class_id: data.class_id\r\n    }\r\n\r\n    editorVisible.value = true\r\n  } catch (err) {\r\n    ElMessage.error('获取内容失败')\r\n  }\r\n}\r\n\r\nconst fetchClassOptions = async () => {\r\n  try {\r\n    const res = await creationClassList({ pageNum: 1, pageSize: 100 })\r\n    classOptions.value = res.data.items || []\r\n  } catch (err) {\r\n    ElMessage.error('获取分类失败')\r\n  }\r\n}\r\n\r\nconst handleUpload = async ({ file }) => {\r\n  try {\r\n    const res = await uploadFile(file)\r\n    form.value.cover_pic = res.data\r\n    ElMessage.success('上传成功')\r\n  } catch {\r\n    ElMessage.error('上传失败')\r\n  }\r\n}\r\n\r\nconst handleSubmit = async () => {\r\n  const { title, abs_text, cover_pic, content, class_id } = form.value\r\n  const isEmptyContent = !content || content.trim() === '' || content === '<p><br></p>'\r\n\r\n  if (!title || !abs_text || !cover_pic || isEmptyContent || !class_id) {\r\n    return ElMessage.warning('请完整填写所有信息')\r\n  }\r\n\r\n  loading.value = true\r\n  try {\r\n    await updateCreation({ ...form.value })\r\n    ElMessage.success('更新成功')\r\n    router.back()\r\n  } catch (err) {\r\n    ElMessage.error('更新失败')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nonMounted(() => {\r\n  fetchClassOptions()\r\n  fetchCreationDetail()\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div class=\"creation-page\">\r\n    <div class=\"header\">\r\n      <el-button icon=\"el-icon-arrow-left\" @click=\"router.back()\">返回</el-button>\r\n    </div>\r\n\r\n    <div class=\"form-section\">\r\n      <el-form :model=\"form\" label-width=\"80px\">\r\n        <el-form-item label=\"封面\">\r\n          <div class=\"upload-box\">\r\n            <img v-if=\"form.cover_pic\" :src=\"form.cover_pic\" class=\"cover-img\" />\r\n            <el-upload :http-request=\"handleUpload\" :show-file-list=\"false\" accept=\"image/*\">\r\n              <el-button type=\"primary\">上传封面</el-button>\r\n            </el-upload>\r\n          </div>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"分类\">\r\n          <el-select v-model=\"form.class_id\" placeholder=\"请选择分类\" style=\"width: 160px\">\r\n            <el-option\r\n                v-for=\"cls in classOptions\"\r\n                :key=\"cls.class_id\"\r\n                :label=\"cls.class_name\"\r\n                :value=\"cls.class_id\"\r\n            />\r\n          </el-select>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"标题\">\r\n          <el-input v-model=\"form.title\" placeholder=\"1~10字\" maxlength=\"10\" show-word-limit />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"摘要\">\r\n          <el-input v-model=\"form.abs_text\" placeholder=\"1~30字\" maxlength=\"30\" show-word-limit />\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n\r\n    <div class=\"editor-section\">\r\n      <RichTextEditor\r\n          ref=\"richEditorRef\"\r\n          v-model=\"form.content\"\r\n          :visible=\"editorVisible\"\r\n      />\r\n\r\n    </div>\r\n\r\n    <div class=\"submit-btn\">\r\n      <el-button type=\"success\" @click=\"handleSubmit\" :loading=\"loading\">保存修改</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.creation-page {\r\n  max-width: 1080px;\r\n  margin: 0 auto;\r\n  padding: 20px;\r\n  background-color: #fff;\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.header {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.upload-box {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 20px;\r\n}\r\n\r\n.cover-img {\r\n  width: 200px;\r\n  height: 120px;\r\n  object-fit: cover;\r\n  border-radius: 4px;\r\n  border: 1px solid #eee;\r\n}\r\n\r\n.form-section {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.editor-section {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.submit-btn {\r\n  text-align: center;\r\n  margin-top: 30px;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}