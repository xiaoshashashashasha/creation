{"ast":null,"code":"import { shallowRef, watch, onBeforeUnmount, nextTick } from 'vue';\nimport { Editor, Toolbar } from '@wangeditor/editor-for-vue';\nimport '@wangeditor/editor/dist/css/style.css';\nimport { uploadFile } from '@/api/fileUpload';\nimport { ElMessage } from 'element-plus';\nexport default {\n  __name: 'UpdateCreationPage',\n  props: {\n    modelValue: String,\n    visible: Boolean\n  },\n  emits: ['update:modelValue'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    const props = __props;\n    const emit = __emit;\n    const editorRef = shallowRef(null);\n    __expose({\n      editorRef\n    });\n    const editorConfig = {\n      placeholder: '请输入内容...',\n      MENU_CONF: {\n        uploadImage: {\n          async customUpload(file, insertFn) {\n            try {\n              const res = await uploadFile(file);\n              insertFn(res.data, '', '');\n              ElMessage.success('图片上传成功');\n            } catch {\n              ElMessage.error('图片上传失败');\n            }\n          }\n        }\n      }\n    };\n    const handleEditorChange = editor => {\n      emit('update:modelValue', editor.getHtml());\n    };\n    const handleEditorCreated = editor => {\n      editorRef.value = editor;\n    };\n\n    // ✅ 只在编辑器已创建 & 内容不一致时再 setHtml，防止循环\n    watch(() => props.modelValue, newVal => {\n      if (editorRef.value && editorRef.value.getHtml() !== newVal) {\n        editorRef.value.setHtml(newVal || '<p><br></p>');\n      }\n    }, {\n      immediate: true\n    });\n    watch(() => props.visible, val => {\n      if (!val && editorRef.value) {\n        editorRef.value.destroy();\n        editorRef.value = null;\n      }\n    });\n    onBeforeUnmount(() => {\n      if (editorRef.value) {\n        editorRef.value.destroy();\n        editorRef.value = null;\n      }\n    });\n    const __returned__ = {\n      props,\n      emit,\n      editorRef,\n      editorConfig,\n      handleEditorChange,\n      handleEditorCreated,\n      shallowRef,\n      watch,\n      onBeforeUnmount,\n      nextTick,\n      get Editor() {\n        return Editor;\n      },\n      get Toolbar() {\n        return Toolbar;\n      },\n      get uploadFile() {\n        return uploadFile;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["shallowRef","watch","onBeforeUnmount","nextTick","Editor","Toolbar","uploadFile","ElMessage","props","__props","emit","__emit","editorRef","__expose","editorConfig","placeholder","MENU_CONF","uploadImage","customUpload","file","insertFn","res","data","success","error","handleEditorChange","editor","getHtml","handleEditorCreated","value","modelValue","newVal","setHtml","immediate","visible","val","destroy"],"sources":["C:/Users/32561/Desktop/毕设仓库/beauty-front/src/views/UpdateCreationPage.vue"],"sourcesContent":["<script setup>\r\nimport { shallowRef, watch, onBeforeUnmount, nextTick } from 'vue'\r\nimport { Editor, Toolbar } from '@wangeditor/editor-for-vue'\r\nimport '@wangeditor/editor/dist/css/style.css'\r\nimport { uploadFile } from '@/api/fileUpload'\r\nimport { ElMessage } from 'element-plus'\r\n\r\nconst props = defineProps({\r\n  modelValue: String,\r\n  visible: Boolean\r\n})\r\nconst emit = defineEmits(['update:modelValue'])\r\n\r\nconst editorRef = shallowRef(null)\r\n\r\ndefineExpose({ editorRef })\r\n\r\nconst editorConfig = {\r\n  placeholder: '请输入内容...',\r\n  MENU_CONF: {\r\n    uploadImage: {\r\n      async customUpload(file, insertFn) {\r\n        try {\r\n          const res = await uploadFile(file)\r\n          insertFn(res.data, '', '')\r\n          ElMessage.success('图片上传成功')\r\n        } catch {\r\n          ElMessage.error('图片上传失败')\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst handleEditorChange = (editor) => {\r\n  emit('update:modelValue', editor.getHtml())\r\n}\r\n\r\n\r\nconst handleEditorCreated = (editor) => {\r\n  editorRef.value = editor\r\n}\r\n\r\n// ✅ 只在编辑器已创建 & 内容不一致时再 setHtml，防止循环\r\nwatch(\r\n    () => props.modelValue,\r\n    (newVal) => {\r\n      if (editorRef.value && editorRef.value.getHtml() !== newVal) {\r\n        editorRef.value.setHtml(newVal || '<p><br></p>')\r\n      }\r\n    },\r\n    { immediate: true }\r\n)\r\n\r\nwatch(() => props.visible, (val) => {\r\n  if (!val && editorRef.value) {\r\n    editorRef.value.destroy()\r\n    editorRef.value = null\r\n  }\r\n})\r\n\r\nonBeforeUnmount(() => {\r\n  if (editorRef.value) {\r\n    editorRef.value.destroy()\r\n    editorRef.value = null\r\n  }\r\n})\r\n</script>\r\n\r\n\r\n<template>\r\n  <div class=\"creation-page\">\r\n    <div class=\"header\">\r\n      <el-button icon=\"el-icon-arrow-left\" @click=\"router.back()\">返回</el-button>\r\n    </div>\r\n\r\n    <div class=\"form-section\">\r\n      <el-form :model=\"form\" label-width=\"80px\">\r\n        <el-form-item label=\"封面\">\r\n          <div class=\"upload-box\">\r\n            <img v-if=\"form.cover_pic\" :src=\"form.cover_pic\" class=\"cover-img\" />\r\n            <el-upload :http-request=\"handleUpload\" :show-file-list=\"false\" accept=\"image/*\">\r\n              <el-button type=\"primary\">上传封面</el-button>\r\n            </el-upload>\r\n          </div>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"分类\">\r\n          <el-select v-model=\"form.class_id\" placeholder=\"请选择分类\" style=\"width: 160px\">\r\n            <el-option\r\n                v-for=\"cls in classOptions\"\r\n                :key=\"cls.class_id\"\r\n                :label=\"cls.class_name\"\r\n                :value=\"cls.class_id\"\r\n            />\r\n          </el-select>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"标题\">\r\n          <el-input v-model=\"form.title\" placeholder=\"1~10字\" maxlength=\"10\" show-word-limit />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"摘要\">\r\n          <el-input v-model=\"form.abs_text\" placeholder=\"1~30字\" maxlength=\"30\" show-word-limit />\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n\r\n    <div class=\"editor-section\">\r\n      <RichTextEditor\r\n          ref=\"richEditorRef\"\r\n          v-model=\"form.content\"\r\n          :visible=\"editorVisible\"\r\n      />\r\n\r\n    </div>\r\n\r\n    <div class=\"submit-btn\">\r\n      <el-button type=\"success\" @click=\"handleSubmit\" :loading=\"loading\">保存修改</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.creation-page {\r\n  max-width: 1080px;\r\n  margin: 0 auto;\r\n  padding: 20px;\r\n  background-color: #fff;\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.header {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.upload-box {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 20px;\r\n}\r\n\r\n.cover-img {\r\n  width: 200px;\r\n  height: 120px;\r\n  object-fit: cover;\r\n  border-radius: 4px;\r\n  border: 1px solid #eee;\r\n}\r\n\r\n.form-section {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.editor-section {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.submit-btn {\r\n  text-align: center;\r\n  margin-top: 30px;\r\n}\r\n</style>\r\n"],"mappings":"AACA,SAASA,UAAU,EAAEC,KAAK,EAAEC,eAAe,EAAEC,QAAQ,QAAQ,KAAK;AAClE,SAASC,MAAM,EAAEC,OAAO,QAAQ,4BAA4B;AAC5D,OAAO,uCAAuC;AAC9C,SAASC,UAAU,QAAQ,kBAAkB;AAC7C,SAASC,SAAS,QAAQ,cAAc;;;;;;;;;;;;IAExC,MAAMC,KAAK,GAAGC,OAGZ;IACF,MAAMC,IAAI,GAAGC,MAAkC;IAE/C,MAAMC,SAAS,GAAGZ,UAAU,CAAC,IAAI,CAAC;IAElCa,QAAY,CAAC;MAAED;IAAU,CAAC,CAAC;IAE3B,MAAME,YAAY,GAAG;MACnBC,WAAW,EAAE,UAAU;MACvBC,SAAS,EAAE;QACTC,WAAW,EAAE;UACX,MAAMC,YAAYA,CAACC,IAAI,EAAEC,QAAQ,EAAE;YACjC,IAAI;cACF,MAAMC,GAAG,GAAG,MAAMf,UAAU,CAACa,IAAI,CAAC;cAClCC,QAAQ,CAACC,GAAG,CAACC,IAAI,EAAE,EAAE,EAAE,EAAE,CAAC;cAC1Bf,SAAS,CAACgB,OAAO,CAAC,QAAQ,CAAC;YAC7B,CAAC,CAAC,MAAM;cACNhB,SAAS,CAACiB,KAAK,CAAC,QAAQ,CAAC;YAC3B;UACF;QACF;MACF;IACF,CAAC;IAED,MAAMC,kBAAkB,GAAIC,MAAM,IAAK;MACrChB,IAAI,CAAC,mBAAmB,EAAEgB,MAAM,CAACC,OAAO,CAAC,CAAC,CAAC;IAC7C,CAAC;IAGD,MAAMC,mBAAmB,GAAIF,MAAM,IAAK;MACtCd,SAAS,CAACiB,KAAK,GAAGH,MAAM;IAC1B,CAAC;;IAED;IACAzB,KAAK,CACD,MAAMO,KAAK,CAACsB,UAAU,EACrBC,MAAM,IAAK;MACV,IAAInB,SAAS,CAACiB,KAAK,IAAIjB,SAAS,CAACiB,KAAK,CAACF,OAAO,CAAC,CAAC,KAAKI,MAAM,EAAE;QAC3DnB,SAAS,CAACiB,KAAK,CAACG,OAAO,CAACD,MAAM,IAAI,aAAa,CAAC;MAClD;IACF,CAAC,EACD;MAAEE,SAAS,EAAE;IAAK,CACtB,CAAC;IAEDhC,KAAK,CAAC,MAAMO,KAAK,CAAC0B,OAAO,EAAGC,GAAG,IAAK;MAClC,IAAI,CAACA,GAAG,IAAIvB,SAAS,CAACiB,KAAK,EAAE;QAC3BjB,SAAS,CAACiB,KAAK,CAACO,OAAO,CAAC,CAAC;QACzBxB,SAAS,CAACiB,KAAK,GAAG,IAAI;MACxB;IACF,CAAC,CAAC;IAEF3B,eAAe,CAAC,MAAM;MACpB,IAAIU,SAAS,CAACiB,KAAK,EAAE;QACnBjB,SAAS,CAACiB,KAAK,CAACO,OAAO,CAAC,CAAC;QACzBxB,SAAS,CAACiB,KAAK,GAAG,IAAI;MACxB;IACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}