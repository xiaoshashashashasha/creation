{"ast":null,"code":"import { ref } from \"vue\";\nimport { userListService, userChangeRoleService } from \"@/api/user\";\nimport { ElMessage } from \"element-plus\";\n\n// 表格数据\n\nexport default {\n  __name: 'ChangeRole',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const tableData = ref([]);\n\n    // 分页数据\n    const pageNum = ref(1);\n    const pageSize = ref(10);\n    const total = ref(0);\n\n    // 搜索条件\n    const searchValue = ref('');\n    const searchType = ref('user_id');\n    const changeRole = async (user_id, role) => {\n      try {\n        await userChangeRoleService(user_id, role);\n        ElMessage.success('权限更改成功');\n        getUserList();\n      } catch (error) {\n        console.log(error);\n        ElMessage.error(error.message);\n      }\n    };\n\n    // 操作按钮\n    function setRoleban(row) {\n      changeRole(row.user_id, 2);\n    }\n    function setRoleuser(row) {\n      changeRole(row.user_id, 0);\n    }\n    function setRolemanager(row) {\n      changeRole(row.user_id, 1);\n    }\n\n    // 获取用户列表\n    const getUserList = async () => {\n      const params = {\n        pageNum: pageNum.value,\n        pageSize: pageSize.value\n      };\n      if (searchType.value === 'user_id' && searchValue.value) {\n        params.user_id = parseInt(searchValue.value);\n      } else if (searchType.value === 'username' && searchValue.value) {\n        params.keyWord = searchValue.value;\n      }\n      try {\n        const result = await userListService(params);\n        tableData.value = result.data.items;\n        total.value = result.data.total;\n      } catch (err) {\n        console.error('获取用户列表失败:', err);\n      }\n    };\n\n    // 搜索按钮\n    const handleSearch = () => {\n      pageNum.value = 1;\n      getUserList();\n    };\n\n    // 重置按钮\n    const handleReset = () => {\n      searchValue.value = '';\n      searchType.value = 'user_id';\n      pageNum.value = 1;\n      getUserList();\n    };\n\n    // 分页变化\n    const handlePageChange = newPage => {\n      pageNum.value = newPage;\n      getUserList();\n    };\n\n    // 初始化加载\n    getUserList();\n    const __returned__ = {\n      tableData,\n      pageNum,\n      pageSize,\n      total,\n      searchValue,\n      searchType,\n      changeRole,\n      setRoleban,\n      setRoleuser,\n      setRolemanager,\n      getUserList,\n      handleSearch,\n      handleReset,\n      handlePageChange,\n      ref,\n      get userListService() {\n        return userListService;\n      },\n      get userChangeRoleService() {\n        return userChangeRoleService;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","userListService","userChangeRoleService","ElMessage","tableData","pageNum","pageSize","total","searchValue","searchType","changeRole","user_id","role","success","getUserList","error","console","log","message","setRoleban","row","setRoleuser","setRolemanager","params","value","parseInt","keyWord","result","data","items","err","handleSearch","handleReset","handlePageChange","newPage"],"sources":["C:/Users/32561/Desktop/毕设仓库/beauty-front/src/views/manage/user/ChangeRole.vue"],"sourcesContent":["<script setup>\r\nimport { ref } from \"vue\"\r\nimport { userListService, userChangeRoleService } from \"@/api/user\"\r\nimport {ElMessage} from \"element-plus\";\r\n\r\n// 表格数据\r\nconst tableData = ref([])\r\n\r\n// 分页数据\r\nconst pageNum = ref(1)\r\nconst pageSize = ref(10)\r\nconst total = ref(0)\r\n\r\n// 搜索条件\r\nconst searchValue = ref('')\r\nconst searchType = ref('user_id')\r\n\r\nconst changeRole = async (user_id,role) => {\r\n  try {\r\n    await userChangeRoleService(user_id,role)\r\n    ElMessage.success('权限更改成功')\r\n\r\n    getUserList()\r\n  } catch (error) {\r\n    console.log(error)\r\n    ElMessage.error(error.message)\r\n  }\r\n}\r\n\r\n// 操作按钮\r\nfunction setRoleban(row) {\r\n  changeRole(row.user_id,2)\r\n}\r\nfunction setRoleuser(row) {\r\n  changeRole(row.user_id,0)\r\n}\r\nfunction setRolemanager(row) {\r\n  changeRole(row.user_id,1)\r\n}\r\n\r\n\r\n\r\n// 获取用户列表\r\nconst getUserList = async () => {\r\n  const params = {\r\n    pageNum: pageNum.value,\r\n    pageSize: pageSize.value,\r\n  }\r\n\r\n  if (searchType.value === 'user_id' && searchValue.value) {\r\n    params.user_id = parseInt(searchValue.value)\r\n  } else if (searchType.value === 'username' && searchValue.value) {\r\n    params.keyWord = searchValue.value\r\n  }\r\n\r\n  try {\r\n    const result = await userListService(params)\r\n    tableData.value = result.data.items\r\n    total.value = result.data.total\r\n  } catch (err) {\r\n    console.error('获取用户列表失败:', err)\r\n  }\r\n}\r\n\r\n// 搜索按钮\r\nconst handleSearch = () => {\r\n  pageNum.value = 1\r\n  getUserList()\r\n}\r\n\r\n// 重置按钮\r\nconst handleReset = () => {\r\n  searchValue.value = ''\r\n  searchType.value = 'user_id'\r\n  pageNum.value = 1\r\n  getUserList()\r\n}\r\n\r\n// 分页变化\r\nconst handlePageChange = (newPage) => {\r\n  pageNum.value = newPage\r\n  getUserList()\r\n}\r\n\r\n// 初始化加载\r\ngetUserList()\r\n</script>\r\n\r\n<template>\r\n  <el-row>\r\n    <!--路径部分-->\r\n    <div class=\"path\">\r\n      <p style=\"font-size: 20px; margin-top: 5px\">更改权限</p>\r\n    </div>\r\n\r\n    <!-- 搜索栏 -->\r\n    <div class=\"search\">\r\n      <el-row :gutter=\"10\" align=\"middle\" style=\"padding: 10px;\">\r\n        <el-col :span=\"4\">\r\n          <el-select v-model=\"searchType\" placeholder=\"搜索类型\">\r\n            <el-option label=\"用户ID\" value=\"user_id\"/>\r\n            <el-option label=\"用户名\" value=\"username\"/>\r\n          </el-select>\r\n        </el-col>\r\n        <el-col :span=\"6\">\r\n          <el-input v-model=\"searchValue\" placeholder=\"请输入搜索内容\"/>\r\n        </el-col>\r\n        <el-col :span=\"4\">\r\n          <el-button type=\"primary\" @click=\"handleSearch\">搜索</el-button>\r\n          <el-button @click=\"handleReset\">重置</el-button>\r\n        </el-col>\r\n      </el-row>\r\n    </div>\r\n\r\n    <!-- 表格部分 -->\r\n    <el-table :data=\"tableData\" style=\"width: 100%\">\r\n      <el-table-column prop=\"user_id\" label=\"用户ID\" width=\"120px\"/>\r\n      <el-table-column prop=\"username\" label=\"用户名\" width=\"240px\"/>\r\n      <el-table-column prop=\"nickname\" label=\"昵称\" width=\"160px\"/>\r\n      <el-table-column prop=\"email\" label=\"邮箱\" width=\"200px\"/>\r\n      <el-table-column prop=\"created_at\" label=\"创建时间\" width=\"240px\"/>\r\n      <el-table-column prop=\"updated_at\" label=\"更新时间\" width=\"240px\"/>\r\n      <el-table-column label=\"角色\" width=\"120px\">\r\n        <template #default=\"{ row }\">\r\n          <el-tag\r\n              :type=\"row.role === 1 ? 'success' : row.role === 2 ? 'danger' : 'info'\"\r\n              disable-transitions\r\n          >\r\n            {{ row.role === 0 ? '正常用户' : row.role === 1 ? '管理员' : '封禁中' }}\r\n          </el-tag>\r\n        </template>\r\n      </el-table-column>\r\n\r\n      <el-table-column label=\"操作\">\r\n        <template #default=\"scope\">\r\n          <el-button @click=\"setRoleban(scope.row)\">封禁</el-button>\r\n          <el-button @click=\"setRoleuser(scope.row)\">设为用户</el-button>\r\n          <el-button @click=\"setRolemanager(scope.row)\">设为管理员</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <!-- 分页 -->\r\n    <div style=\"text-align: center; margin-top: 20px; width: 100%\">\r\n      <el-pagination\r\n          background\r\n          layout=\"prev, pager, next, jumper, ->, total\"\r\n          :total=\"total\"\r\n          :current-page=\"pageNum\"\r\n          :page-size=\"pageSize\"\r\n          @current-change=\"handlePageChange\"\r\n      />\r\n    </div>\r\n  </el-row>\r\n</template>\r\n\r\n<style scoped>\r\n.path {\r\n  height: 40px;\r\n  width: 100%;\r\n  background-color: #d8a6a6;\r\n}\r\n.search {\r\n  width: 100%;\r\n  background-color: #bbd2e3;\r\n  height: 52px;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}