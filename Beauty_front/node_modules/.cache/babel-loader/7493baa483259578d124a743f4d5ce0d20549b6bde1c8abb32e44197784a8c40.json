{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { BubbleMenuPlugin } from '@tiptap/extension-bubble-menu';\nimport { defineComponent, ref, onMounted, onBeforeUnmount, h, markRaw, customRef, getCurrentInstance, watchEffect, nextTick, unref, shallowRef, reactive, render, provide } from 'vue';\nimport { Editor as Editor$1, NodeView } from '@tiptap/core';\nexport * from '@tiptap/core';\nimport { FloatingMenuPlugin } from '@tiptap/extension-floating-menu';\nconst BubbleMenu = defineComponent({\n  name: 'BubbleMenu',\n  props: {\n    pluginKey: {\n      type: [String, Object],\n      default: 'bubbleMenu'\n    },\n    editor: {\n      type: Object,\n      required: true\n    },\n    updateDelay: {\n      type: Number,\n      default: undefined\n    },\n    tippyOptions: {\n      type: Object,\n      default: () => ({})\n    },\n    shouldShow: {\n      type: Function,\n      default: null\n    }\n  },\n  setup(props, {\n    slots\n  }) {\n    const root = ref(null);\n    onMounted(() => {\n      const {\n        updateDelay,\n        editor,\n        pluginKey,\n        shouldShow,\n        tippyOptions\n      } = props;\n      editor.registerPlugin(BubbleMenuPlugin({\n        updateDelay,\n        editor,\n        element: root.value,\n        pluginKey,\n        shouldShow,\n        tippyOptions\n      }));\n    });\n    onBeforeUnmount(() => {\n      const {\n        pluginKey,\n        editor\n      } = props;\n      editor.unregisterPlugin(pluginKey);\n    });\n    return () => {\n      var _a;\n      return h('div', {\n        ref: root\n      }, (_a = slots.default) === null || _a === void 0 ? void 0 : _a.call(slots));\n    };\n  }\n});\n\n/* eslint-disable react-hooks/rules-of-hooks */\nfunction useDebouncedRef(value) {\n  return customRef((track, trigger) => {\n    return {\n      get() {\n        track();\n        return value;\n      },\n      set(newValue) {\n        // update state\n        value = newValue;\n        // update view as soon as possible\n        requestAnimationFrame(() => {\n          requestAnimationFrame(() => {\n            trigger();\n          });\n        });\n      }\n    };\n  });\n}\nclass Editor extends Editor$1 {\n  constructor(options = {}) {\n    super(options);\n    this.contentComponent = null;\n    this.appContext = null;\n    this.reactiveState = useDebouncedRef(this.view.state);\n    this.reactiveExtensionStorage = useDebouncedRef(this.extensionStorage);\n    this.on('beforeTransaction', ({\n      nextState\n    }) => {\n      this.reactiveState.value = nextState;\n      this.reactiveExtensionStorage.value = this.extensionStorage;\n    });\n    return markRaw(this); // eslint-disable-line\n  }\n  get state() {\n    return this.reactiveState ? this.reactiveState.value : this.view.state;\n  }\n  get storage() {\n    return this.reactiveExtensionStorage ? this.reactiveExtensionStorage.value : super.storage;\n  }\n  /**\n   * Register a ProseMirror plugin.\n   */\n  registerPlugin(plugin, handlePlugins) {\n    const nextState = super.registerPlugin(plugin, handlePlugins);\n    if (this.reactiveState) {\n      this.reactiveState.value = nextState;\n    }\n    return nextState;\n  }\n  /**\n   * Unregister a ProseMirror plugin.\n   */\n  unregisterPlugin(nameOrPluginKey) {\n    const nextState = super.unregisterPlugin(nameOrPluginKey);\n    if (this.reactiveState && nextState) {\n      this.reactiveState.value = nextState;\n    }\n    return nextState;\n  }\n}\nconst EditorContent = defineComponent({\n  name: 'EditorContent',\n  props: {\n    editor: {\n      default: null,\n      type: Object\n    }\n  },\n  setup(props) {\n    const rootEl = ref();\n    const instance = getCurrentInstance();\n    watchEffect(() => {\n      const editor = props.editor;\n      if (editor && editor.options.element && rootEl.value) {\n        nextTick(() => {\n          if (!rootEl.value || !editor.options.element.firstChild) {\n            return;\n          }\n          const element = unref(rootEl.value);\n          rootEl.value.append(...editor.options.element.childNodes);\n          // @ts-ignore\n          editor.contentComponent = instance.ctx._;\n          if (instance) {\n            editor.appContext = {\n              ...instance.appContext,\n              // Vue internally uses prototype chain to forward/shadow injects across the entire component chain\n              // so don't use object spread operator or 'Object.assign' and just set `provides` as is on editor's appContext\n              // @ts-expect-error forward instance's 'provides' into appContext\n              provides: instance.provides\n            };\n          }\n          editor.setOptions({\n            element\n          });\n          editor.createNodeViews();\n        });\n      }\n    });\n    onBeforeUnmount(() => {\n      const editor = props.editor;\n      if (!editor) {\n        return;\n      }\n      editor.contentComponent = null;\n      editor.appContext = null;\n    });\n    return {\n      rootEl\n    };\n  },\n  render() {\n    return h('div', {\n      ref: el => {\n        this.rootEl = el;\n      }\n    });\n  }\n});\nconst FloatingMenu = defineComponent({\n  name: 'FloatingMenu',\n  props: {\n    pluginKey: {\n      // TODO: TypeScript breaks :(\n      // type: [String, Object as PropType<Exclude<FloatingMenuPluginProps['pluginKey'], string>>],\n      type: null,\n      default: 'floatingMenu'\n    },\n    editor: {\n      type: Object,\n      required: true\n    },\n    tippyOptions: {\n      type: Object,\n      default: () => ({})\n    },\n    shouldShow: {\n      type: Function,\n      default: null\n    }\n  },\n  setup(props, {\n    slots\n  }) {\n    const root = ref(null);\n    onMounted(() => {\n      const {\n        pluginKey,\n        editor,\n        tippyOptions,\n        shouldShow\n      } = props;\n      editor.registerPlugin(FloatingMenuPlugin({\n        pluginKey,\n        editor,\n        element: root.value,\n        tippyOptions,\n        shouldShow\n      }));\n    });\n    onBeforeUnmount(() => {\n      const {\n        pluginKey,\n        editor\n      } = props;\n      editor.unregisterPlugin(pluginKey);\n    });\n    return () => {\n      var _a;\n      return h('div', {\n        ref: root\n      }, (_a = slots.default) === null || _a === void 0 ? void 0 : _a.call(slots));\n    };\n  }\n});\nconst NodeViewContent = defineComponent({\n  name: 'NodeViewContent',\n  props: {\n    as: {\n      type: String,\n      default: 'div'\n    }\n  },\n  render() {\n    return h(this.as, {\n      style: {\n        whiteSpace: 'pre-wrap'\n      },\n      'data-node-view-content': ''\n    });\n  }\n});\nconst NodeViewWrapper = defineComponent({\n  name: 'NodeViewWrapper',\n  props: {\n    as: {\n      type: String,\n      default: 'div'\n    }\n  },\n  inject: ['onDragStart', 'decorationClasses'],\n  render() {\n    var _a, _b;\n    return h(this.as, {\n      // @ts-ignore\n      class: this.decorationClasses,\n      style: {\n        whiteSpace: 'normal'\n      },\n      'data-node-view-wrapper': '',\n      // @ts-ignore (https://github.com/vuejs/vue-next/issues/3031)\n      onDragstart: this.onDragStart\n    }, (_b = (_a = this.$slots).default) === null || _b === void 0 ? void 0 : _b.call(_a));\n  }\n});\nconst useEditor = (options = {}) => {\n  const editor = shallowRef();\n  onMounted(() => {\n    editor.value = new Editor(options);\n  });\n  onBeforeUnmount(() => {\n    var _a, _b, _c;\n    // Cloning root node (and its children) to avoid content being lost by destroy\n    const nodes = (_a = editor.value) === null || _a === void 0 ? void 0 : _a.options.element;\n    const newEl = nodes === null || nodes === void 0 ? void 0 : nodes.cloneNode(true);\n    (_b = nodes === null || nodes === void 0 ? void 0 : nodes.parentNode) === null || _b === void 0 ? void 0 : _b.replaceChild(newEl, nodes);\n    (_c = editor.value) === null || _c === void 0 ? void 0 : _c.destroy();\n  });\n  return editor;\n};\n\n/**\n * This class is used to render Vue components inside the editor.\n */\nclass VueRenderer {\n  constructor(component, {\n    props = {},\n    editor\n  }) {\n    this.editor = editor;\n    this.component = markRaw(component);\n    this.el = document.createElement('div');\n    this.props = reactive(props);\n    this.renderedComponent = this.renderComponent();\n  }\n  get element() {\n    return this.renderedComponent.el;\n  }\n  get ref() {\n    var _a, _b, _c, _d;\n    // Composition API\n    if ((_b = (_a = this.renderedComponent.vNode) === null || _a === void 0 ? void 0 : _a.component) === null || _b === void 0 ? void 0 : _b.exposed) {\n      return this.renderedComponent.vNode.component.exposed;\n    }\n    // Option API\n    return (_d = (_c = this.renderedComponent.vNode) === null || _c === void 0 ? void 0 : _c.component) === null || _d === void 0 ? void 0 : _d.proxy;\n  }\n  renderComponent() {\n    let vNode = h(this.component, this.props);\n    if (this.editor.appContext) {\n      vNode.appContext = this.editor.appContext;\n    }\n    if (typeof document !== 'undefined' && this.el) {\n      render(vNode, this.el);\n    }\n    const destroy = () => {\n      if (this.el) {\n        render(null, this.el);\n      }\n      this.el = null;\n      vNode = null;\n    };\n    return {\n      vNode,\n      destroy,\n      el: this.el ? this.el.firstElementChild : null\n    };\n  }\n  updateProps(props = {}) {\n    Object.entries(props).forEach(([key, value]) => {\n      this.props[key] = value;\n    });\n    this.renderComponent();\n  }\n  destroy() {\n    this.renderedComponent.destroy();\n  }\n}\n\n/* eslint-disable no-underscore-dangle */\nconst nodeViewProps = {\n  editor: {\n    type: Object,\n    required: true\n  },\n  node: {\n    type: Object,\n    required: true\n  },\n  decorations: {\n    type: Object,\n    required: true\n  },\n  selected: {\n    type: Boolean,\n    required: true\n  },\n  extension: {\n    type: Object,\n    required: true\n  },\n  getPos: {\n    type: Function,\n    required: true\n  },\n  updateAttributes: {\n    type: Function,\n    required: true\n  },\n  deleteNode: {\n    type: Function,\n    required: true\n  },\n  view: {\n    type: Object,\n    required: true\n  },\n  innerDecorations: {\n    type: Object,\n    required: true\n  },\n  HTMLAttributes: {\n    type: Object,\n    required: true\n  }\n};\nclass VueNodeView extends NodeView {\n  mount() {\n    const props = {\n      editor: this.editor,\n      node: this.node,\n      decorations: this.decorations,\n      innerDecorations: this.innerDecorations,\n      view: this.view,\n      selected: false,\n      extension: this.extension,\n      HTMLAttributes: this.HTMLAttributes,\n      getPos: () => this.getPos(),\n      updateAttributes: (attributes = {}) => this.updateAttributes(attributes),\n      deleteNode: () => this.deleteNode()\n    };\n    const onDragStart = this.onDragStart.bind(this);\n    this.decorationClasses = ref(this.getDecorationClasses());\n    const extendedComponent = defineComponent({\n      extends: {\n        ...this.component\n      },\n      props: Object.keys(props),\n      template: this.component.template,\n      setup: reactiveProps => {\n        var _a, _b;\n        provide('onDragStart', onDragStart);\n        provide('decorationClasses', this.decorationClasses);\n        return (_b = (_a = this.component).setup) === null || _b === void 0 ? void 0 : _b.call(_a, reactiveProps, {\n          expose: () => undefined\n        });\n      },\n      // add support for scoped styles\n      // @ts-ignore\n      // eslint-disable-next-line\n      __scopeId: this.component.__scopeId,\n      // add support for CSS Modules\n      // @ts-ignore\n      // eslint-disable-next-line\n      __cssModules: this.component.__cssModules,\n      // add support for vue devtools\n      // @ts-ignore\n      // eslint-disable-next-line\n      __name: this.component.__name,\n      // @ts-ignore\n      // eslint-disable-next-line\n      __file: this.component.__file\n    });\n    this.handleSelectionUpdate = this.handleSelectionUpdate.bind(this);\n    this.editor.on('selectionUpdate', this.handleSelectionUpdate);\n    this.renderer = new VueRenderer(extendedComponent, {\n      editor: this.editor,\n      props\n    });\n  }\n  /**\n   * Return the DOM element.\n   * This is the element that will be used to display the node view.\n   */\n  get dom() {\n    if (!this.renderer.element || !this.renderer.element.hasAttribute('data-node-view-wrapper')) {\n      throw Error('Please use the NodeViewWrapper component for your node view.');\n    }\n    return this.renderer.element;\n  }\n  /**\n   * Return the content DOM element.\n   * This is the element that will be used to display the rich-text content of the node.\n   */\n  get contentDOM() {\n    if (this.node.isLeaf) {\n      return null;\n    }\n    return this.dom.querySelector('[data-node-view-content]');\n  }\n  /**\n   * On editor selection update, check if the node is selected.\n   * If it is, call `selectNode`, otherwise call `deselectNode`.\n   */\n  handleSelectionUpdate() {\n    const {\n      from,\n      to\n    } = this.editor.state.selection;\n    const pos = this.getPos();\n    if (typeof pos !== 'number') {\n      return;\n    }\n    if (from <= pos && to >= pos + this.node.nodeSize) {\n      if (this.renderer.props.selected) {\n        return;\n      }\n      this.selectNode();\n    } else {\n      if (!this.renderer.props.selected) {\n        return;\n      }\n      this.deselectNode();\n    }\n  }\n  /**\n   * On update, update the React component.\n   * To prevent unnecessary updates, the `update` option can be used.\n   */\n  update(node, decorations, innerDecorations) {\n    const rerenderComponent = props => {\n      this.decorationClasses.value = this.getDecorationClasses();\n      this.renderer.updateProps(props);\n    };\n    if (typeof this.options.update === 'function') {\n      const oldNode = this.node;\n      const oldDecorations = this.decorations;\n      const oldInnerDecorations = this.innerDecorations;\n      this.node = node;\n      this.decorations = decorations;\n      this.innerDecorations = innerDecorations;\n      return this.options.update({\n        oldNode,\n        oldDecorations,\n        newNode: node,\n        newDecorations: decorations,\n        oldInnerDecorations,\n        innerDecorations,\n        updateProps: () => rerenderComponent({\n          node,\n          decorations,\n          innerDecorations\n        })\n      });\n    }\n    if (node.type !== this.node.type) {\n      return false;\n    }\n    if (node === this.node && this.decorations === decorations && this.innerDecorations === innerDecorations) {\n      return true;\n    }\n    this.node = node;\n    this.decorations = decorations;\n    this.innerDecorations = innerDecorations;\n    rerenderComponent({\n      node,\n      decorations,\n      innerDecorations\n    });\n    return true;\n  }\n  /**\n   * Select the node.\n   * Add the `selected` prop and the `ProseMirror-selectednode` class.\n   */\n  selectNode() {\n    this.renderer.updateProps({\n      selected: true\n    });\n    if (this.renderer.element) {\n      this.renderer.element.classList.add('ProseMirror-selectednode');\n    }\n  }\n  /**\n   * Deselect the node.\n   * Remove the `selected` prop and the `ProseMirror-selectednode` class.\n   */\n  deselectNode() {\n    this.renderer.updateProps({\n      selected: false\n    });\n    if (this.renderer.element) {\n      this.renderer.element.classList.remove('ProseMirror-selectednode');\n    }\n  }\n  getDecorationClasses() {\n    return this.decorations\n    // @ts-ignore\n    .map(item => item.type.attrs.class).flat().join(' ');\n  }\n  destroy() {\n    this.renderer.destroy();\n    this.editor.off('selectionUpdate', this.handleSelectionUpdate);\n  }\n}\nfunction VueNodeViewRenderer(component, options) {\n  return props => {\n    // try to get the parent component\n    // this is important for vue devtools to show the component hierarchy correctly\n    // maybe it’s `undefined` because <editor-content> isn’t rendered yet\n    if (!props.editor.contentComponent) {\n      return {};\n    }\n    // check for class-component and normalize if neccessary\n    const normalizedComponent = typeof component === 'function' && '__vccOpts' in component ? component.__vccOpts : component;\n    return new VueNodeView(normalizedComponent, props, options);\n  };\n}\nexport { BubbleMenu, Editor, EditorContent, FloatingMenu, NodeViewContent, NodeViewWrapper, VueNodeViewRenderer, VueRenderer, nodeViewProps, useEditor };","map":{"version":3,"names":["BubbleMenu","defineComponent","name","props","pluginKey","type","String","Object","default","editor","required","updateDelay","Number","undefined","tippyOptions","shouldShow","Function","setup","slots","root","ref","onMounted","registerPlugin","BubbleMenuPlugin","element","value","onBeforeUnmount","unregisterPlugin","_a","h","call","useDebouncedRef","customRef","track","trigger","get","set","newValue","requestAnimationFrame","Editor","Editor$1","constructor","options","contentComponent","appContext","reactiveState","view","state","reactiveExtensionStorage","extensionStorage","on","nextState","markRaw","storage","plugin","handlePlugins","nameOrPluginKey","EditorContent","rootEl","instance","getCurrentInstance","watchEffect","nextTick","firstChild","unref","append","childNodes","ctx","_","provides","setOptions","createNodeViews","render","el","FloatingMenu","FloatingMenuPlugin","NodeViewContent","as","style","whiteSpace","NodeViewWrapper","inject","class","decorationClasses","onDragstart","onDragStart","_b","$slots","useEditor","shallowRef","nodes","newEl","cloneNode","parentNode","replaceChild","_c","destroy","VueRenderer","component","document","createElement","reactive","renderedComponent","renderComponent","vNode","exposed","_d","proxy","firstElementChild","updateProps","entries","forEach","key","nodeViewProps","node","decorations","selected","Boolean","extension","getPos","updateAttributes","deleteNode","innerDecorations","HTMLAttributes","VueNodeView","NodeView","mount","attributes","bind","getDecorationClasses","extendedComponent","extends","keys","template","reactiveProps","provide","expose","__scopeId","__cssModules","__name","__file","handleSelectionUpdate","renderer","dom","hasAttribute","Error","contentDOM","isLeaf","querySelector","from","to","selection","pos","nodeSize","selectNode","deselectNode","update","rerenderComponent","oldNode","oldDecorations","oldInnerDecorations","newNode","newDecorations","classList","add","remove","map","item","attrs","flat","join","off","VueNodeViewRenderer","normalizedComponent","__vccOpts"],"sources":["../src/BubbleMenu.ts","../src/Editor.ts","../src/EditorContent.ts","../src/FloatingMenu.ts","../src/NodeViewContent.ts","../src/NodeViewWrapper.ts","../src/useEditor.ts","../src/VueRenderer.ts","../src/VueNodeViewRenderer.ts"],"sourcesContent":["import { BubbleMenuPlugin, BubbleMenuPluginProps } from '@tiptap/extension-bubble-menu'\nimport {\n  defineComponent,\n  h,\n  onBeforeUnmount,\n  onMounted,\n  PropType,\n  ref,\n} from 'vue'\n\nexport const BubbleMenu = defineComponent({\n  name: 'BubbleMenu',\n\n  props: {\n    pluginKey: {\n      type: [String, Object] as PropType<BubbleMenuPluginProps['pluginKey']>,\n      default: 'bubbleMenu',\n    },\n\n    editor: {\n      type: Object as PropType<BubbleMenuPluginProps['editor']>,\n      required: true,\n    },\n\n    updateDelay: {\n      type: Number as PropType<BubbleMenuPluginProps['updateDelay']>,\n      default: undefined,\n    },\n\n    tippyOptions: {\n      type: Object as PropType<BubbleMenuPluginProps['tippyOptions']>,\n      default: () => ({}),\n    },\n\n    shouldShow: {\n      type: Function as PropType<Exclude<Required<BubbleMenuPluginProps>['shouldShow'], null>>,\n      default: null,\n    },\n  },\n\n  setup(props, { slots }) {\n    const root = ref<HTMLElement | null>(null)\n\n    onMounted(() => {\n      const {\n        updateDelay,\n        editor,\n        pluginKey,\n        shouldShow,\n        tippyOptions,\n      } = props\n\n      editor.registerPlugin(BubbleMenuPlugin({\n        updateDelay,\n        editor,\n        element: root.value as HTMLElement,\n        pluginKey,\n        shouldShow,\n        tippyOptions,\n      }))\n    })\n\n    onBeforeUnmount(() => {\n      const { pluginKey, editor } = props\n\n      editor.unregisterPlugin(pluginKey)\n    })\n\n    return () => h('div', { ref: root }, slots.default?.())\n  },\n})\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport { Editor as CoreEditor, EditorOptions } from '@tiptap/core'\nimport { EditorState, Plugin, PluginKey } from '@tiptap/pm/state'\nimport {\n  AppContext,\n  ComponentInternalInstance,\n  ComponentPublicInstance,\n  customRef,\n  markRaw,\n  Ref,\n} from 'vue'\n\nfunction useDebouncedRef<T>(value: T) {\n  return customRef<T>((track, trigger) => {\n    return {\n      get() {\n        track()\n        return value\n      },\n      set(newValue) {\n        // update state\n        value = newValue\n\n        // update view as soon as possible\n        requestAnimationFrame(() => {\n          requestAnimationFrame(() => {\n            trigger()\n          })\n        })\n      },\n    }\n  })\n}\n\nexport type ContentComponent = ComponentInternalInstance & {\n  ctx: ComponentPublicInstance\n}\n\nexport class Editor extends CoreEditor {\n  private reactiveState: Ref<EditorState>\n\n  private reactiveExtensionStorage: Ref<Record<string, any>>\n\n  public contentComponent: ContentComponent | null = null\n\n  public appContext: AppContext | null = null\n\n  constructor(options: Partial<EditorOptions> = {}) {\n    super(options)\n\n    this.reactiveState = useDebouncedRef(this.view.state)\n    this.reactiveExtensionStorage = useDebouncedRef(this.extensionStorage)\n\n    this.on('beforeTransaction', ({ nextState }) => {\n      this.reactiveState.value = nextState\n      this.reactiveExtensionStorage.value = this.extensionStorage\n    })\n\n    return markRaw(this) // eslint-disable-line\n  }\n\n  get state() {\n    return this.reactiveState ? this.reactiveState.value : this.view.state\n  }\n\n  get storage() {\n    return this.reactiveExtensionStorage ? this.reactiveExtensionStorage.value : super.storage\n  }\n\n  /**\n   * Register a ProseMirror plugin.\n   */\n  public registerPlugin(\n    plugin: Plugin,\n    handlePlugins?: (newPlugin: Plugin, plugins: Plugin[]) => Plugin[],\n  ): EditorState {\n    const nextState = super.registerPlugin(plugin, handlePlugins)\n\n    if (this.reactiveState) {\n      this.reactiveState.value = nextState\n    }\n\n    return nextState\n  }\n\n  /**\n   * Unregister a ProseMirror plugin.\n   */\n  public unregisterPlugin(nameOrPluginKey: string | PluginKey): EditorState | undefined {\n    const nextState = super.unregisterPlugin(nameOrPluginKey)\n\n    if (this.reactiveState && nextState) {\n      this.reactiveState.value = nextState\n    }\n\n    return nextState\n  }\n}\n","import {\n  defineComponent,\n  getCurrentInstance,\n  h,\n  nextTick,\n  onBeforeUnmount,\n  PropType,\n  Ref,\n  ref,\n  unref,\n  watchEffect,\n} from 'vue'\n\nimport { Editor } from './Editor.js'\n\nexport const EditorContent = defineComponent({\n  name: 'EditorContent',\n\n  props: {\n    editor: {\n      default: null,\n      type: Object as PropType<Editor>,\n    },\n  },\n\n  setup(props) {\n    const rootEl: Ref<Element | undefined> = ref()\n    const instance = getCurrentInstance()\n\n    watchEffect(() => {\n      const editor = props.editor\n\n      if (editor && editor.options.element && rootEl.value) {\n        nextTick(() => {\n          if (!rootEl.value || !editor.options.element.firstChild) {\n            return\n          }\n\n          const element = unref(rootEl.value)\n\n          rootEl.value.append(...editor.options.element.childNodes)\n\n          // @ts-ignore\n          editor.contentComponent = instance.ctx._\n\n          if (instance) {\n            editor.appContext = {\n              ...instance.appContext,\n              // Vue internally uses prototype chain to forward/shadow injects across the entire component chain\n              // so don't use object spread operator or 'Object.assign' and just set `provides` as is on editor's appContext\n              // @ts-expect-error forward instance's 'provides' into appContext\n              provides: instance.provides,\n            }\n          }\n\n          editor.setOptions({\n            element,\n          })\n\n          editor.createNodeViews()\n        })\n      }\n    })\n\n    onBeforeUnmount(() => {\n      const editor = props.editor\n\n      if (!editor) {\n        return\n      }\n\n      editor.contentComponent = null\n      editor.appContext = null\n    })\n\n    return { rootEl }\n  },\n\n  render() {\n    return h(\n      'div',\n      {\n        ref: (el: any) => { this.rootEl = el },\n      },\n    )\n  },\n})\n","import { FloatingMenuPlugin, FloatingMenuPluginProps } from '@tiptap/extension-floating-menu'\nimport {\n  defineComponent,\n  h,\n  onBeforeUnmount,\n  onMounted,\n  PropType,\n  ref,\n} from 'vue'\n\nexport const FloatingMenu = defineComponent({\n  name: 'FloatingMenu',\n\n  props: {\n    pluginKey: {\n      // TODO: TypeScript breaks :(\n      // type: [String, Object as PropType<Exclude<FloatingMenuPluginProps['pluginKey'], string>>],\n      type: null,\n      default: 'floatingMenu',\n    },\n\n    editor: {\n      type: Object as PropType<FloatingMenuPluginProps['editor']>,\n      required: true,\n    },\n\n    tippyOptions: {\n      type: Object as PropType<FloatingMenuPluginProps['tippyOptions']>,\n      default: () => ({}),\n    },\n\n    shouldShow: {\n      type: Function as PropType<Exclude<Required<FloatingMenuPluginProps>['shouldShow'], null>>,\n      default: null,\n    },\n  },\n\n  setup(props, { slots }) {\n    const root = ref<HTMLElement | null>(null)\n\n    onMounted(() => {\n      const {\n        pluginKey,\n        editor,\n        tippyOptions,\n        shouldShow,\n      } = props\n\n      editor.registerPlugin(FloatingMenuPlugin({\n        pluginKey,\n        editor,\n        element: root.value as HTMLElement,\n        tippyOptions,\n        shouldShow,\n      }))\n    })\n\n    onBeforeUnmount(() => {\n      const { pluginKey, editor } = props\n\n      editor.unregisterPlugin(pluginKey)\n    })\n\n    return () => h('div', { ref: root }, slots.default?.())\n  },\n})\n","import { defineComponent, h } from 'vue'\n\nexport const NodeViewContent = defineComponent({\n  name: 'NodeViewContent',\n\n  props: {\n    as: {\n      type: String,\n      default: 'div',\n    },\n  },\n\n  render() {\n    return h(this.as, {\n      style: {\n        whiteSpace: 'pre-wrap',\n      },\n      'data-node-view-content': '',\n    })\n  },\n})\n","import { defineComponent, h } from 'vue'\n\nexport const NodeViewWrapper = defineComponent({\n  name: 'NodeViewWrapper',\n\n  props: {\n    as: {\n      type: String,\n      default: 'div',\n    },\n  },\n\n  inject: ['onDragStart', 'decorationClasses'],\n\n  render() {\n    return h(\n      this.as,\n      {\n        // @ts-ignore\n        class: this.decorationClasses,\n        style: {\n          whiteSpace: 'normal',\n        },\n        'data-node-view-wrapper': '',\n        // @ts-ignore (https://github.com/vuejs/vue-next/issues/3031)\n        onDragstart: this.onDragStart,\n      },\n      this.$slots.default?.(),\n    )\n  },\n})\n","import { EditorOptions } from '@tiptap/core'\nimport { onBeforeUnmount, onMounted, shallowRef } from 'vue'\n\nimport { Editor } from './Editor.js'\n\nexport const useEditor = (options: Partial<EditorOptions> = {}) => {\n  const editor = shallowRef<Editor>()\n\n  onMounted(() => {\n    editor.value = new Editor(options)\n  })\n\n  onBeforeUnmount(() => {\n    // Cloning root node (and its children) to avoid content being lost by destroy\n    const nodes = editor.value?.options.element\n    const newEl = nodes?.cloneNode(true) as HTMLElement\n\n    nodes?.parentNode?.replaceChild(newEl, nodes)\n\n    editor.value?.destroy()\n  })\n\n  return editor\n}\n","import { Editor } from '@tiptap/core'\nimport {\n  Component, DefineComponent, h, markRaw, reactive, render,\n} from 'vue'\n\nimport { Editor as ExtendedEditor } from './Editor.js'\n\nexport interface VueRendererOptions {\n  editor: Editor;\n  props?: Record<string, any>;\n}\n\ntype ExtendedVNode = ReturnType<typeof h> | null;\n\ninterface RenderedComponent {\n  vNode: ExtendedVNode;\n  destroy: () => void;\n  el: Element | null;\n}\n\n/**\n * This class is used to render Vue components inside the editor.\n */\nexport class VueRenderer {\n  renderedComponent!: RenderedComponent\n\n  editor: ExtendedEditor\n\n  component: Component\n\n  el: Element | null\n\n  props: Record<string, any>\n\n  constructor(component: Component, { props = {}, editor }: VueRendererOptions) {\n    this.editor = editor as ExtendedEditor\n    this.component = markRaw(component)\n    this.el = document.createElement('div')\n    this.props = reactive(props)\n    this.renderedComponent = this.renderComponent()\n  }\n\n  get element(): Element | null {\n    return this.renderedComponent.el\n  }\n\n  get ref(): any {\n    // Composition API\n    if (this.renderedComponent.vNode?.component?.exposed) {\n      return this.renderedComponent.vNode.component.exposed\n    }\n    // Option API\n    return this.renderedComponent.vNode?.component?.proxy\n  }\n\n  renderComponent() {\n    let vNode: ExtendedVNode = h(this.component as DefineComponent, this.props)\n\n    if (this.editor.appContext) {\n      vNode.appContext = this.editor.appContext\n    }\n    if (typeof document !== 'undefined' && this.el) {\n      render(vNode, this.el)\n    }\n\n    const destroy = () => {\n      if (this.el) {\n        render(null, this.el)\n      }\n      this.el = null\n      vNode = null\n    }\n\n    return { vNode, destroy, el: this.el ? this.el.firstElementChild : null }\n  }\n\n  updateProps(props: Record<string, any> = {}): void {\n    Object.entries(props).forEach(([key, value]) => {\n      this.props[key] = value\n    })\n    this.renderComponent()\n  }\n\n  destroy(): void {\n    this.renderedComponent.destroy()\n  }\n}\n","/* eslint-disable no-underscore-dangle */\nimport {\n  DecorationWithType,\n  NodeView,\n  NodeViewProps,\n  NodeViewRenderer,\n  NodeViewRendererOptions,\n} from '@tiptap/core'\nimport { Node as ProseMirrorNode } from '@tiptap/pm/model'\nimport { Decoration, DecorationSource, NodeView as ProseMirrorNodeView } from '@tiptap/pm/view'\nimport {\n  Component, defineComponent, PropType, provide, Ref, ref,\n} from 'vue'\n\nimport { Editor } from './Editor.js'\nimport { VueRenderer } from './VueRenderer.js'\n\nexport const nodeViewProps = {\n  editor: {\n    type: Object as PropType<NodeViewProps['editor']>,\n    required: true as const,\n  },\n  node: {\n    type: Object as PropType<NodeViewProps['node']>,\n    required: true as const,\n  },\n  decorations: {\n    type: Object as PropType<NodeViewProps['decorations']>,\n    required: true as const,\n  },\n  selected: {\n    type: Boolean as PropType<NodeViewProps['selected']>,\n    required: true as const,\n  },\n  extension: {\n    type: Object as PropType<NodeViewProps['extension']>,\n    required: true as const,\n  },\n  getPos: {\n    type: Function as PropType<NodeViewProps['getPos']>,\n    required: true as const,\n  },\n  updateAttributes: {\n    type: Function as PropType<NodeViewProps['updateAttributes']>,\n    required: true as const,\n  },\n  deleteNode: {\n    type: Function as PropType<NodeViewProps['deleteNode']>,\n    required: true as const,\n  },\n  view: {\n    type: Object as PropType<NodeViewProps['view']>,\n    required: true as const,\n  },\n  innerDecorations: {\n    type: Object as PropType<NodeViewProps['innerDecorations']>,\n    required: true as const,\n  },\n  HTMLAttributes: {\n    type: Object as PropType<NodeViewProps['HTMLAttributes']>,\n    required: true as const,\n  },\n}\n\nexport interface VueNodeViewRendererOptions extends NodeViewRendererOptions {\n  update:\n    | ((props: {\n        oldNode: ProseMirrorNode;\n        oldDecorations: readonly Decoration[];\n        oldInnerDecorations: DecorationSource;\n        newNode: ProseMirrorNode;\n        newDecorations: readonly Decoration[];\n        innerDecorations: DecorationSource;\n        updateProps: () => void;\n      }) => boolean)\n    | null;\n}\n\nclass VueNodeView extends NodeView<Component, Editor, VueNodeViewRendererOptions> {\n  renderer!: VueRenderer\n\n  decorationClasses!: Ref<string>\n\n  mount() {\n    const props = {\n      editor: this.editor,\n      node: this.node,\n      decorations: this.decorations as DecorationWithType[],\n      innerDecorations: this.innerDecorations,\n      view: this.view,\n      selected: false,\n      extension: this.extension,\n      HTMLAttributes: this.HTMLAttributes,\n      getPos: () => this.getPos(),\n      updateAttributes: (attributes = {}) => this.updateAttributes(attributes),\n      deleteNode: () => this.deleteNode(),\n    } satisfies NodeViewProps\n\n    const onDragStart = this.onDragStart.bind(this)\n\n    this.decorationClasses = ref(this.getDecorationClasses())\n\n    const extendedComponent = defineComponent({\n      extends: { ...this.component },\n      props: Object.keys(props),\n      template: (this.component as any).template,\n      setup: reactiveProps => {\n        provide('onDragStart', onDragStart)\n        provide('decorationClasses', this.decorationClasses)\n\n        return (this.component as any).setup?.(reactiveProps, {\n          expose: () => undefined,\n        })\n      },\n      // add support for scoped styles\n      // @ts-ignore\n      // eslint-disable-next-line\n      __scopeId: this.component.__scopeId,\n      // add support for CSS Modules\n      // @ts-ignore\n      // eslint-disable-next-line\n      __cssModules: this.component.__cssModules,\n      // add support for vue devtools\n      // @ts-ignore\n      // eslint-disable-next-line\n      __name: this.component.__name,\n      // @ts-ignore\n      // eslint-disable-next-line\n      __file: this.component.__file,\n    })\n\n    this.handleSelectionUpdate = this.handleSelectionUpdate.bind(this)\n    this.editor.on('selectionUpdate', this.handleSelectionUpdate)\n\n    this.renderer = new VueRenderer(extendedComponent, {\n      editor: this.editor,\n      props,\n    })\n  }\n\n  /**\n   * Return the DOM element.\n   * This is the element that will be used to display the node view.\n   */\n  get dom() {\n    if (!this.renderer.element || !this.renderer.element.hasAttribute('data-node-view-wrapper')) {\n      throw Error('Please use the NodeViewWrapper component for your node view.')\n    }\n\n    return this.renderer.element as HTMLElement\n  }\n\n  /**\n   * Return the content DOM element.\n   * This is the element that will be used to display the rich-text content of the node.\n   */\n  get contentDOM() {\n    if (this.node.isLeaf) {\n      return null\n    }\n\n    return this.dom.querySelector('[data-node-view-content]') as HTMLElement | null\n  }\n\n  /**\n   * On editor selection update, check if the node is selected.\n   * If it is, call `selectNode`, otherwise call `deselectNode`.\n   */\n  handleSelectionUpdate() {\n    const { from, to } = this.editor.state.selection\n    const pos = this.getPos()\n\n    if (typeof pos !== 'number') {\n      return\n    }\n\n    if (from <= pos && to >= pos + this.node.nodeSize) {\n      if (this.renderer.props.selected) {\n        return\n      }\n\n      this.selectNode()\n    } else {\n      if (!this.renderer.props.selected) {\n        return\n      }\n\n      this.deselectNode()\n    }\n  }\n\n  /**\n   * On update, update the React component.\n   * To prevent unnecessary updates, the `update` option can be used.\n   */\n  update(\n    node: ProseMirrorNode,\n    decorations: readonly Decoration[],\n    innerDecorations: DecorationSource,\n  ): boolean {\n    const rerenderComponent = (props?: Record<string, any>) => {\n      this.decorationClasses.value = this.getDecorationClasses()\n      this.renderer.updateProps(props)\n    }\n\n    if (typeof this.options.update === 'function') {\n      const oldNode = this.node\n      const oldDecorations = this.decorations\n      const oldInnerDecorations = this.innerDecorations\n\n      this.node = node\n      this.decorations = decorations\n      this.innerDecorations = innerDecorations\n\n      return this.options.update({\n        oldNode,\n        oldDecorations,\n        newNode: node,\n        newDecorations: decorations,\n        oldInnerDecorations,\n        innerDecorations,\n        updateProps: () => rerenderComponent({ node, decorations, innerDecorations }),\n      })\n    }\n\n    if (node.type !== this.node.type) {\n      return false\n    }\n\n    if (node === this.node && this.decorations === decorations && this.innerDecorations === innerDecorations) {\n      return true\n    }\n\n    this.node = node\n    this.decorations = decorations\n    this.innerDecorations = innerDecorations\n\n    rerenderComponent({ node, decorations, innerDecorations })\n\n    return true\n  }\n\n  /**\n   * Select the node.\n   * Add the `selected` prop and the `ProseMirror-selectednode` class.\n   */\n  selectNode() {\n    this.renderer.updateProps({\n      selected: true,\n    })\n    if (this.renderer.element) {\n      this.renderer.element.classList.add('ProseMirror-selectednode')\n    }\n  }\n\n  /**\n   * Deselect the node.\n   * Remove the `selected` prop and the `ProseMirror-selectednode` class.\n   */\n  deselectNode() {\n    this.renderer.updateProps({\n      selected: false,\n    })\n    if (this.renderer.element) {\n      this.renderer.element.classList.remove('ProseMirror-selectednode')\n    }\n  }\n\n  getDecorationClasses() {\n    return (\n      this.decorations\n        // @ts-ignore\n        .map(item => item.type.attrs.class)\n        .flat()\n        .join(' ')\n    )\n  }\n\n  destroy() {\n    this.renderer.destroy()\n    this.editor.off('selectionUpdate', this.handleSelectionUpdate)\n  }\n}\n\nexport function VueNodeViewRenderer(\n  component: Component<NodeViewProps>,\n  options?: Partial<VueNodeViewRendererOptions>,\n): NodeViewRenderer {\n  return props => {\n    // try to get the parent component\n    // this is important for vue devtools to show the component hierarchy correctly\n    // maybe it’s `undefined` because <editor-content> isn’t rendered yet\n    if (!(props.editor as Editor).contentComponent) {\n      return {} as unknown as ProseMirrorNodeView\n    }\n    // check for class-component and normalize if neccessary\n    const normalizedComponent = typeof component === 'function' && '__vccOpts' in component\n      ? (component.__vccOpts as Component)\n      : component\n\n    return new VueNodeView(normalizedComponent, props, options)\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}