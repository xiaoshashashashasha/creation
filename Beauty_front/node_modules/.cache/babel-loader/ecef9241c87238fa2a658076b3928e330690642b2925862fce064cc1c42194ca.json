{"ast":null,"code":"import { ref, watch, onBeforeUnmount } from 'vue';\nimport { Editor, Toolbar } from '@wangeditor/editor-for-vue';\nimport '@wangeditor/editor/dist/css/style.css';\nimport { uploadFile } from '@/api/fileUpload';\nimport { ElMessage } from 'element-plus';\nexport default {\n  __name: 'RichTextEditor',\n  props: {\n    modelValue: String,\n    visible: Boolean,\n    ready: Boolean\n  },\n  emits: ['update:modelValue'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const emit = __emit;\n    let editorRef = null; // ✅ 非响应式，避免 Proxy 报错\n    const editorReady = ref(false); // ✅ 控制编辑器挂载时机\n    const localValue = ref(props.modelValue);\n\n    // 父 -> 子\n    watch(() => props.modelValue, val => {\n      localValue.value = val;\n    });\n\n    // 子 -> 父\n    watch(localValue, val => {\n      emit('update:modelValue', val);\n    });\n    const editorConfig = {\n      placeholder: '请输入内容...',\n      MENU_CONF: {\n        uploadImage: {\n          async customUpload(file, insertFn) {\n            try {\n              const res = await uploadFile(file);\n              insertFn(String(res.data), '', '');\n              ElMessage.success('图片上传成功');\n            } catch {\n              ElMessage.error('图片上传失败');\n            }\n          }\n        }\n      }\n    };\n\n    // 监听 visible 控制挂载 & 销毁\n    watch(() => props.visible, val => {\n      if (val) {\n        setTimeout(() => {\n          editorReady.value = true;\n        }, 50); // 延迟 50ms，确保样式加载完成再挂载\n      } else {\n        editorReady.value = false;\n        if (editorRef) {\n          editorRef.destroy();\n          editorRef = null;\n        }\n      }\n    });\n    onBeforeUnmount(() => {\n      if (editorRef) {\n        editorRef.destroy();\n        editorRef = null;\n      }\n    });\n    const __returned__ = {\n      props,\n      emit,\n      get editorRef() {\n        return editorRef;\n      },\n      set editorRef(v) {\n        editorRef = v;\n      },\n      editorReady,\n      localValue,\n      editorConfig,\n      ref,\n      watch,\n      onBeforeUnmount,\n      get Editor() {\n        return Editor;\n      },\n      get Toolbar() {\n        return Toolbar;\n      },\n      get uploadFile() {\n        return uploadFile;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","watch","onBeforeUnmount","Editor","Toolbar","uploadFile","ElMessage","props","__props","emit","__emit","editorRef","editorReady","localValue","modelValue","val","value","editorConfig","placeholder","MENU_CONF","uploadImage","customUpload","file","insertFn","res","String","data","success","error","visible","setTimeout","destroy"],"sources":["C:/Users/32561/Desktop/毕设仓库/beauty-front/src/components/RichTextEditor.vue"],"sourcesContent":["<template>\r\n  <div class=\"editor-wrapper\" v-if=\"visible\">\r\n    <Toolbar v-if=\"editorReady && editorRef\" :editor=\"editorRef\" mode=\"default\" />\r\n    <Editor\r\n        v-if=\"editorReady\"\r\n        v-model=\"localValue\"\r\n        :defaultConfig=\"editorConfig\"\r\n        mode=\"default\"\r\n        style=\"height: 300px; width: 100%; overflow-y: auto\"\r\n        @onCreated=\"editor => (editorRef = editor)\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, watch, onBeforeUnmount } from 'vue'\r\nimport { Editor, Toolbar } from '@wangeditor/editor-for-vue'\r\nimport '@wangeditor/editor/dist/css/style.css'\r\nimport { uploadFile } from '@/api/fileUpload'\r\nimport { ElMessage } from 'element-plus'\r\n\r\nconst props = defineProps({\r\n  modelValue: String,\r\n  visible: Boolean,\r\n  ready: Boolean \r\n})\r\n\r\nconst emit = defineEmits(['update:modelValue'])\r\n\r\nlet editorRef = null             // ✅ 非响应式，避免 Proxy 报错\r\nconst editorReady = ref(false)   // ✅ 控制编辑器挂载时机\r\nconst localValue = ref(props.modelValue)\r\n\r\n// 父 -> 子\r\nwatch(() => props.modelValue, (val) => {\r\n  localValue.value = val\r\n})\r\n\r\n// 子 -> 父\r\nwatch(localValue, (val) => {\r\n  emit('update:modelValue', val)\r\n})\r\n\r\nconst editorConfig = {\r\n  placeholder: '请输入内容...',\r\n  MENU_CONF: {\r\n    uploadImage: {\r\n      async customUpload(file, insertFn) {\r\n        try {\r\n          const res = await uploadFile(file)\r\n          insertFn(String(res.data), '', '')\r\n          ElMessage.success('图片上传成功')\r\n        } catch {\r\n          ElMessage.error('图片上传失败')\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// 监听 visible 控制挂载 & 销毁\r\nwatch(() => props.visible, (val) => {\r\n  if (val) {\r\n    setTimeout(() => {\r\n      editorReady.value = true\r\n    }, 50) // 延迟 50ms，确保样式加载完成再挂载\r\n  } else {\r\n    editorReady.value = false\r\n    if (editorRef) {\r\n      editorRef.destroy()\r\n      editorRef = null\r\n    }\r\n  }\r\n})\r\n\r\nonBeforeUnmount(() => {\r\n  if (editorRef) {\r\n    editorRef.destroy()\r\n    editorRef = null\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.editor-wrapper {\r\n  border: 1px solid #dcdfe6;\r\n  border-radius: 4px;\r\n  overflow: hidden;\r\n  margin-top: 10px;\r\n}\r\n\r\n.w-e-text-container {\r\n  min-height: 200px;\r\n  padding: 10px;\r\n}\r\n\r\n.w-e-text img {\r\n  max-width: 100%;\r\n  height: auto;\r\n  display: block;\r\n  margin: 10px 0;\r\n  cursor: nwse-resize;\r\n}\r\n</style>\r\n"],"mappings":"AAeA,SAASA,GAAG,EAAEC,KAAK,EAAEC,eAAe,QAAQ,KAAK;AACjD,SAASC,MAAM,EAAEC,OAAO,QAAQ,4BAA4B;AAC5D,OAAO,uCAAuC;AAC9C,SAASC,UAAU,QAAQ,kBAAkB;AAC7C,SAASC,SAAS,QAAQ,cAAc;;;;;;;;;;;;;;IAExC,MAAMC,KAAK,GAAGC,OAIZ;IAEF,MAAMC,IAAI,GAAGC,MAAkC;IAE/C,IAAIC,SAAS,GAAG,IAAI,EAAa;IACjC,MAAMC,WAAW,GAAGZ,GAAG,CAAC,KAAK,CAAC,EAAG;IACjC,MAAMa,UAAU,GAAGb,GAAG,CAACO,KAAK,CAACO,UAAU,CAAC;;IAExC;IACAb,KAAK,CAAC,MAAMM,KAAK,CAACO,UAAU,EAAGC,GAAG,IAAK;MACrCF,UAAU,CAACG,KAAK,GAAGD,GAAG;IACxB,CAAC,CAAC;;IAEF;IACAd,KAAK,CAACY,UAAU,EAAGE,GAAG,IAAK;MACzBN,IAAI,CAAC,mBAAmB,EAAEM,GAAG,CAAC;IAChC,CAAC,CAAC;IAEF,MAAME,YAAY,GAAG;MACnBC,WAAW,EAAE,UAAU;MACvBC,SAAS,EAAE;QACTC,WAAW,EAAE;UACX,MAAMC,YAAYA,CAACC,IAAI,EAAEC,QAAQ,EAAE;YACjC,IAAI;cACF,MAAMC,GAAG,GAAG,MAAMnB,UAAU,CAACiB,IAAI,CAAC;cAClCC,QAAQ,CAACE,MAAM,CAACD,GAAG,CAACE,IAAI,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC;cAClCpB,SAAS,CAACqB,OAAO,CAAC,QAAQ,CAAC;YAC7B,CAAC,CAAC,MAAM;cACNrB,SAAS,CAACsB,KAAK,CAAC,QAAQ,CAAC;YAC3B;UACF;QACF;MACF;IACF,CAAC;;IAED;IACA3B,KAAK,CAAC,MAAMM,KAAK,CAACsB,OAAO,EAAGd,GAAG,IAAK;MAClC,IAAIA,GAAG,EAAE;QACPe,UAAU,CAAC,MAAM;UACflB,WAAW,CAACI,KAAK,GAAG,IAAI;QAC1B,CAAC,EAAE,EAAE,CAAC,EAAC;MACT,CAAC,MAAM;QACLJ,WAAW,CAACI,KAAK,GAAG,KAAK;QACzB,IAAIL,SAAS,EAAE;UACbA,SAAS,CAACoB,OAAO,CAAC,CAAC;UACnBpB,SAAS,GAAG,IAAI;QAClB;MACF;IACF,CAAC,CAAC;IAEFT,eAAe,CAAC,MAAM;MACpB,IAAIS,SAAS,EAAE;QACbA,SAAS,CAACoB,OAAO,CAAC,CAAC;QACnBpB,SAAS,GAAG,IAAI;MAClB;IACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}