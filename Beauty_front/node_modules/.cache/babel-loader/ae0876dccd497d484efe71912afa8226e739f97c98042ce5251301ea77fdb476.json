{"ast":null,"code":"import { createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"creation-page\"\n};\nconst _hoisted_2 = {\n  class: \"header\"\n};\nconst _hoisted_3 = {\n  class: \"form-section\"\n};\nconst _hoisted_4 = {\n  class: \"upload-box\"\n};\nconst _hoisted_5 = [\"src\"];\nconst _hoisted_6 = [\"src\"];\nconst _hoisted_7 = {\n  class: \"editor-section\"\n};\nconst _hoisted_8 = {\n  class: \"submit-btn\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_upload = _resolveComponent(\"el-upload\");\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n  const _component_el_option = _resolveComponent(\"el-option\");\n  const _component_el_select = _resolveComponent(\"el-select\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_form = _resolveComponent(\"el-form\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_el_button, {\n    icon: \"el-icon-arrow-left\",\n    onClick: _cache[0] || (_cache[0] = $event => $setup.router.back())\n  }, {\n    default: _withCtx(() => _cache[5] || (_cache[5] = [_createTextVNode(\"返回\")])),\n    _: 1 /* STABLE */\n  })]), _createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_form, {\n    model: $setup.form,\n    \"label-width\": \"80px\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_form_item, {\n      label: \"封面\"\n    }, {\n      default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_4, [$setup.coverPreviewUrl ? (_openBlock(), _createElementBlock(\"img\", {\n        key: 0,\n        src: $setup.coverPreviewUrl,\n        class: \"cover-img\"\n      }, null, 8 /* PROPS */, _hoisted_5)) : $setup.form.cover_pic ? (_openBlock(), _createElementBlock(\"img\", {\n        key: 1,\n        src: $setup.form.cover_pic,\n        class: \"cover-img\"\n      }, null, 8 /* PROPS */, _hoisted_6)) : _createCommentVNode(\"v-if\", true), _createVNode(_component_el_upload, {\n        \"http-request\": $setup.handleUpload,\n        \"show-file-list\": false,\n        accept: \"image/*\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_button, {\n          type: \"primary\"\n        }, {\n          default: _withCtx(() => _cache[6] || (_cache[6] = [_createTextVNode(\"上传封面\")])),\n          _: 1 /* STABLE */\n        })]),\n        _: 1 /* STABLE */\n      })])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, {\n      label: \"分类\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_select, {\n        modelValue: $setup.form.class_id,\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.form.class_id = $event),\n        placeholder: \"请选择分类\",\n        style: {\n          \"width\": \"160px\"\n        }\n      }, {\n        default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.classOptions, cls => {\n          return _openBlock(), _createBlock(_component_el_option, {\n            key: cls.class_id,\n            label: cls.class_name,\n            value: cls.class_id\n          }, null, 8 /* PROPS */, [\"label\", \"value\"]);\n        }), 128 /* KEYED_FRAGMENT */))]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, {\n      label: \"标题\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: $setup.form.title,\n        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.form.title = $event),\n        placeholder: \"1~16字\",\n        maxlength: \"16\",\n        style: {\n          \"width\": \"200px\"\n        },\n        \"show-word-limit\": \"\"\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, {\n      label: \"摘要\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: $setup.form.abs_text,\n        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $setup.form.abs_text = $event),\n        placeholder: \"1~30字\",\n        maxlength: \"30\",\n        style: {\n          \"width\": \"400px\"\n        },\n        \"show-word-limit\": \"\"\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"model\"])]), _createElementVNode(\"div\", _hoisted_7, [_createVNode($setup[\"RichTextEditor\"], {\n    modelValue: $setup.form.content,\n    \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => $setup.form.content = $event),\n    visible: true\n  }, null, 8 /* PROPS */, [\"modelValue\"])]), _createElementVNode(\"div\", _hoisted_8, [_createVNode(_component_el_button, {\n    type: \"success\",\n    onClick: $setup.handleSubmit,\n    loading: $setup.loading\n  }, {\n    default: _withCtx(() => _cache[7] || (_cache[7] = [_createTextVNode(\"发布\")])),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"loading\"])])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_el_button","icon","onClick","_cache","$event","$setup","router","back","default","_withCtx","_createTextVNode","_","_hoisted_3","_component_el_form","model","form","_component_el_form_item","label","_hoisted_4","coverPreviewUrl","key","src","_hoisted_5","cover_pic","_hoisted_6","_createCommentVNode","_component_el_upload","handleUpload","accept","type","_component_el_select","modelValue","class_id","placeholder","style","_Fragment","_renderList","classOptions","cls","_createBlock","_component_el_option","class_name","value","_component_el_input","title","maxlength","abs_text","_hoisted_7","content","visible","_hoisted_8","handleSubmit","loading"],"sources":["C:\\Users\\32561\\Desktop\\毕设仓库\\beauty-front\\src\\views\\CreateCreationPage.vue"],"sourcesContent":["<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport { ElMessage } from 'element-plus'\r\nimport { uploadFile } from '@/api/fileUpload'\r\nimport { addCreation, creationClassList } from '@/api/creation'\r\nimport RichTextEditor from '@/components/part/RichTextEditor.vue'\r\n\r\nconst router = useRouter()\r\n\r\nconst coverPreviewUrl = ref('')\r\nconst coverImageFile = ref(null)\r\n\r\nconst form = ref({\r\n  title: '',\r\n  abs_text: '',\r\n  cover_pic: '',\r\n  content: '<p><br></p>',\r\n  class_id: null\r\n})\r\n\r\nconst classOptions = ref([])\r\nconst loading = ref(false)\r\n\r\nconst handleUpload = ({ file }) => {\r\n  coverImageFile.value = file\r\n  coverPreviewUrl.value = URL.createObjectURL(file)\r\n}\r\n\r\n\r\nconst handleSubmit = async () => {\r\n  const { title, abs_text, content, class_id } = form.value\r\n  const isEmptyContent = !content || content.trim() === '' || content === '<p><br></p>'\r\n\r\n  if (!title || !abs_text || (!form.value.cover_pic && !coverPreviewUrl.value) || isEmptyContent || !class_id) {\r\n    return ElMessage.warning('请完整填写所有信息')\r\n  }\r\n\r\n  loading.value = true\r\n  try {\r\n    // 统一处理图片上传\r\n    if (coverImageFile.value) {\r\n      const res = await uploadFile(coverImageFile.value)\r\n      form.value.cover_pic = res.data\r\n    }\r\n\r\n    await addCreation({ ...form.value })\r\n    ElMessage.success('发布成功')\r\n    router.back()\r\n  } catch (err) {\r\n    ElMessage.error('发布失败')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst fetchClassOptions = async () => {\r\n  try {\r\n    const res = await creationClassList({ pageNum: 1, pageSize: 100 })\r\n    classOptions.value = res.data.items || []\r\n\r\n    // 默认选择第一个分类\r\n    if (!form.value.class_id && classOptions.value.length > 0) {\r\n      form.value.class_id = classOptions.value[0].class_id\r\n    }\r\n  } catch (err) {\r\n    ElMessage.error('获取分类失败')\r\n  }\r\n}\r\n\r\nonMounted(() => {\r\n  fetchClassOptions()\r\n})\r\n</script>\r\n\r\n\r\n<template>\r\n  <div class=\"creation-page\">\r\n    <div class=\"header\">\r\n      <el-button icon=\"el-icon-arrow-left\" @click=\"router.back()\">返回</el-button>\r\n    </div>\r\n\r\n    <div class=\"form-section\">\r\n      <el-form :model=\"form\" label-width=\"80px\">\r\n        <el-form-item label=\"封面\">\r\n          <div class=\"upload-box\">\r\n            <img v-if=\"coverPreviewUrl\" :src=\"coverPreviewUrl\" class=\"cover-img\" />\r\n            <img v-else-if=\"form.cover_pic\" :src=\"form.cover_pic\" class=\"cover-img\" />\r\n            <el-upload :http-request=\"handleUpload\" :show-file-list=\"false\" accept=\"image/*\">\r\n              <el-button type=\"primary\">上传封面</el-button>\r\n            </el-upload>\r\n          </div>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"分类\">\r\n          <el-select v-model=\"form.class_id\" placeholder=\"请选择分类\" style=\"width: 160px\">\r\n            <el-option\r\n                v-for=\"cls in classOptions\"\r\n                :key=\"cls.class_id\"\r\n                :label=\"cls.class_name\"\r\n                :value=\"cls.class_id\"\r\n            />\r\n          </el-select>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"标题\">\r\n          <el-input v-model=\"form.title\" placeholder=\"1~16字\" maxlength=\"16\" style=\"width: 200px\" show-word-limit />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"摘要\">\r\n          <el-input v-model=\"form.abs_text\" placeholder=\"1~30字\" maxlength=\"30\" style=\"width: 400px;\" show-word-limit />\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n\r\n    <div class=\"editor-section\">\r\n      <RichTextEditor v-model=\"form.content\" :visible=\"true\" />\r\n    </div>\r\n\r\n    <div class=\"submit-btn\">\r\n      <el-button type=\"success\" @click=\"handleSubmit\" :loading=\"loading\">发布</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.creation-page {\r\n  width: 1720px;\r\n  margin: 0 auto;\r\n  padding: 20px;\r\n  background-color: #fff;\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.header {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.upload-box {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 20px;\r\n}\r\n\r\n.cover-img {\r\n  width: 200px;\r\n  height: 120px;\r\n  object-fit: cover;\r\n  border-radius: 4px;\r\n  border: 1px solid #eee;\r\n}\r\n\r\n.form-section {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.editor-section {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.submit-btn {\r\n  text-align: center;\r\n  margin-top: 30px;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}