{"ast":null,"code":"import { ref, onMounted } from \"vue\";\nimport { ElMessage } from \"element-plus\";\nimport { creationListExamine, creationExamine, creationClassList, creationChangeClass, creationInfo } from \"@/api/creation\";\nexport default {\n  __name: 'CreationExamine',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const tableData = ref([]);\n    const pageNum = ref(1);\n    const pageSize = ref(5);\n    const total = ref(0);\n    const classDialogVisible = ref(false);\n    const contentDialogVisible = ref(false);\n    const contentDetail = ref(null);\n    const currentCreationId = ref(null);\n    const selectedClassId = ref(null);\n    const commentMap = ref({});\n    const selectedSearchClassId = ref(null);\n    const SearchClassOptions = ref([]);\n    const handleSearch = () => {\n      pageNum.value = 1;\n      fetchData();\n    };\n    const fetchData = async () => {\n      try {\n        const res = await creationListExamine({\n          pageNum: pageNum.value,\n          pageSize: pageSize.value,\n          examine: 2,\n          class_id: selectedSearchClassId.value\n        });\n        const creations = res.data.items;\n        tableData.value = creations;\n        total.value = res.data.total;\n      } catch (err) {\n        ElMessage.error(err.msg || \"获取内容失败\");\n      }\n    };\n    const fetchSearchOptions = async () => {\n      try {\n        const [classRes, tagRes] = await Promise.all([creationClassList({\n          pageNum: 1,\n          pageSize: 100\n        })]);\n        SearchClassOptions.value = classRes.data.items || [];\n      } catch (err) {\n        ElMessage.error(\"分类或标签加载失败\");\n      }\n    };\n    const openClassDialog = creation_id => {\n      currentCreationId.value = creation_id;\n      classDialogVisible.value = true;\n    };\n    const openContentDialog = async creation_id => {\n      try {\n        const res = await creationInfo(creation_id);\n        contentDetail.value = res.data;\n        contentDialogVisible.value = true;\n      } catch (err) {\n        ElMessage.error(err.msg || \"获取内容详情失败\");\n      }\n    };\n    const confirmClassChange = async () => {\n      if (!selectedClassId.value) return ElMessage.warning(\"请选择分类\");\n      try {\n        await creationChangeClass(currentCreationId.value, selectedClassId.value);\n        ElMessage.success(\"分类更改成功\");\n        classDialogVisible.value = false;\n        selectedClassId.value = null;\n        fetchData();\n      } catch (err) {\n        ElMessage.error(err.msg || \"分类更改失败\");\n      }\n    };\n    const handleReject = async row => {\n      const comment = commentMap.value[row.creation_id];\n      if (!comment || comment.trim() === '') {\n        ElMessage.warning(\"请输入打回原因\");\n        return;\n      }\n      try {\n        await creationExamine(row.creation_id, 1, comment);\n        ElMessage.success(\"已打回\");\n        fetchData();\n      } catch (err) {\n        ElMessage.error(err.msg || \"操作失败\");\n      }\n    };\n    const handleApprove = async row => {\n      try {\n        await creationExamine(row.creation_id, 0, ''); // 直接传参数\n        ElMessage.success(\"已通过该稿件\");\n        fetchData();\n      } catch (err) {\n        ElMessage.error(err.msg || \"通过操作失败\");\n      }\n    };\n    const handlePageChange = newPage => {\n      pageNum.value = newPage;\n      fetchData();\n    };\n    onMounted(() => {\n      fetchData();\n      fetchSearchOptions();\n    });\n    const __returned__ = {\n      tableData,\n      pageNum,\n      pageSize,\n      total,\n      classDialogVisible,\n      contentDialogVisible,\n      contentDetail,\n      currentCreationId,\n      selectedClassId,\n      commentMap,\n      selectedSearchClassId,\n      SearchClassOptions,\n      handleSearch,\n      fetchData,\n      fetchSearchOptions,\n      openClassDialog,\n      openContentDialog,\n      confirmClassChange,\n      handleReject,\n      handleApprove,\n      handlePageChange,\n      ref,\n      onMounted,\n      get ElMessage() {\n        return ElMessage;\n      },\n      get creationListExamine() {\n        return creationListExamine;\n      },\n      get creationExamine() {\n        return creationExamine;\n      },\n      get creationClassList() {\n        return creationClassList;\n      },\n      get creationChangeClass() {\n        return creationChangeClass;\n      },\n      get creationInfo() {\n        return creationInfo;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","ElMessage","creationListExamine","creationExamine","creationClassList","creationChangeClass","creationInfo","tableData","pageNum","pageSize","total","classDialogVisible","contentDialogVisible","contentDetail","currentCreationId","selectedClassId","commentMap","selectedSearchClassId","SearchClassOptions","handleSearch","value","fetchData","res","examine","class_id","creations","data","items","err","error","msg","fetchSearchOptions","classRes","tagRes","Promise","all","openClassDialog","creation_id","openContentDialog","confirmClassChange","warning","success","handleReject","row","comment","trim","handleApprove","handlePageChange","newPage"],"sources":["C:/Users/32561/Desktop/毕设仓库/beauty-front/src/views/manage/creation/CreationExamine.vue"],"sourcesContent":["<script setup>\r\nimport {ref, onMounted} from \"vue\"\r\nimport {ElMessage} from \"element-plus\"\r\nimport {\r\n  creationListExamine,\r\n  creationExamine,\r\n  creationClassList,\r\n  creationChangeClass,\r\n  creationInfo\r\n} from \"@/api/creation\"\r\n\r\nconst tableData = ref([])\r\nconst pageNum = ref(1)\r\nconst pageSize = ref(5)\r\nconst total = ref(0)\r\nconst classDialogVisible = ref(false)\r\nconst contentDialogVisible = ref(false)\r\nconst contentDetail = ref(null)\r\nconst currentCreationId = ref(null)\r\nconst selectedClassId = ref(null)\r\nconst commentMap = ref({})\r\nconst selectedSearchClassId = ref(null)\r\nconst SearchClassOptions = ref([])\r\n\r\n\r\nconst handleSearch = () => {\r\n  pageNum.value = 1\r\n  fetchData()\r\n}\r\n\r\nconst fetchData = async () => {\r\n  try {\r\n    const res = await creationListExamine({\r\n      pageNum: pageNum.value,\r\n      pageSize: pageSize.value,\r\n      examine: 2,\r\n      class_id: selectedSearchClassId.value,\r\n    })\r\n\r\n    const creations = res.data.items\r\n\r\n    tableData.value = creations\r\n    total.value = res.data.total\r\n\r\n  } catch (err) {\r\n    ElMessage.error(err.msg || \"获取内容失败\")\r\n  }\r\n}\r\n\r\nconst fetchSearchOptions = async () => {\r\n  try {\r\n    const [classRes, tagRes] = await Promise.all([\r\n      creationClassList({pageNum: 1, pageSize: 100})\r\n    ])\r\n\r\n    SearchClassOptions.value = classRes.data.items || []\r\n  } catch (err) {\r\n    ElMessage.error(\"分类或标签加载失败\")\r\n  }\r\n}\r\n\r\n\r\nconst openClassDialog = (creation_id) => {\r\n  currentCreationId.value = creation_id\r\n  classDialogVisible.value = true\r\n}\r\n\r\nconst openContentDialog = async (creation_id) => {\r\n  try {\r\n    const res = await creationInfo(creation_id)\r\n    contentDetail.value = res.data\r\n    contentDialogVisible.value = true\r\n  } catch (err) {\r\n    ElMessage.error(err.msg || \"获取内容详情失败\")\r\n  }\r\n}\r\n\r\nconst confirmClassChange = async () => {\r\n  if (!selectedClassId.value) return ElMessage.warning(\"请选择分类\")\r\n  try {\r\n    await creationChangeClass(currentCreationId.value, selectedClassId.value)\r\n    ElMessage.success(\"分类更改成功\")\r\n    classDialogVisible.value = false\r\n    selectedClassId.value = null\r\n    fetchData()\r\n  } catch (err) {\r\n    ElMessage.error(err.msg || \"分类更改失败\")\r\n  }\r\n}\r\n\r\nconst handleReject = async (row) => {\r\n  const comment = commentMap.value[row.creation_id]\r\n  if (!comment || comment.trim() === '') {\r\n    ElMessage.warning(\"请输入打回原因\")\r\n    return\r\n  }\r\n  try {\r\n    await creationExamine(row.creation_id, 1, comment)\r\n\r\n    ElMessage.success(\"已打回\")\r\n    fetchData()\r\n  } catch (err) {\r\n    ElMessage.error(err.msg || \"操作失败\")\r\n  }\r\n}\r\n\r\nconst handleApprove = async (row) => {\r\n  try {\r\n    await creationExamine(row.creation_id, 0, '') // 直接传参数\r\n    ElMessage.success(\"已通过该稿件\")\r\n    fetchData()\r\n  } catch (err) {\r\n    ElMessage.error(err.msg || \"通过操作失败\")\r\n  }\r\n}\r\n\r\n\r\n\r\nconst handlePageChange = (newPage) => {\r\n  pageNum.value = newPage\r\n  fetchData()\r\n}\r\n\r\nonMounted(() => {\r\n  fetchData()\r\n  fetchSearchOptions()\r\n})\r\n</script>\r\n\r\n<template>\r\n  <el-row :gutter=\"0\">\r\n    <div class=\"path\">\r\n      <p style=\"font-size: 20px; margin-top: 5px\">内容审核</p>\r\n    </div>\r\n\r\n    <div class=\"search\">\r\n      <el-row :gutter=\"10\" style=\"padding: 10px\">\r\n        <el-col :span=\"6\">\r\n          <el-select v-model=\"selectedSearchClassId\" placeholder=\"请选择分类\" clearable style=\"width: 100%\">\r\n            <el-option\r\n                v-for=\"cls in SearchClassOptions\"\r\n                :key=\"cls.class_id\"\r\n                :label=\"cls.class_name\"\r\n                :value=\"cls.class_id\"\r\n            />\r\n          </el-select>\r\n        </el-col>\r\n\r\n        <el-col :span=\"4\">\r\n          <el-button type=\"primary\" @click=\"handleSearch\">搜索</el-button>\r\n          <el-button @click=\"() => { selectedSearchClassId = null; handleSearch() }\">重置\r\n          </el-button>\r\n        </el-col>\r\n      </el-row>\r\n    </div>\r\n\r\n    <el-table :data=\"tableData\" style=\"width: 100%\">\r\n      <el-table-column prop=\"creation_id\" label=\"内容ID\" width=\"120px\"/>\r\n      <el-table-column prop=\"user_id\" label=\"用户ID\" width=\"120px\"/>\r\n      <el-table-column label=\"封面\" width=\"200px\">\r\n        <template #default=\"{ row }\">\r\n          <img :src=\"row.cover_pic\" alt=\"封面\" style=\"width: 200px; height: 100px; object-fit: cover;\"/>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"title\" label=\"标题\" width=\"160px\"/>\r\n      <el-table-column prop=\"class_name\" label=\"分类名\" width=\"120px\"/>\r\n      <el-table-column label=\"更改分类\" width=\"120px\">\r\n        <template #default=\"{ row }\">\r\n          <el-button size=\"small\" @click=\"openClassDialog(row.creation_id)\">更改</el-button>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"查看内容\" width=\"120px\">\r\n        <template #default=\"{ row }\">\r\n          <el-button size=\"small\" @click=\"openContentDialog(row.creation_id)\">查看</el-button>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"打回原因\" width=\"240px\">\r\n        <template #default=\"{ row }\">\r\n          <el-input v-model=\"commentMap[row.creation_id]\" placeholder=\"请输入原因\" size=\"small\"/>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"打回稿件\" width=\"120px\">\r\n        <template #default=\"{ row }\">\r\n          <el-button size=\"small\" type=\"danger\" @click=\"handleReject(row)\">打回</el-button>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"通过稿件\" width=\"120px\">\r\n        <template #default=\"{ row }\">\r\n          <el-button size=\"small\" type=\"success\" @click=\"handleApprove(row)\">通过</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <div style=\"text-align: center; margin-top: 20px\">\r\n      <el-pagination\r\n          background\r\n          layout=\"prev, pager, next, ->, total\"\r\n          :total=\"total\"\r\n          :current-page=\"pageNum\"\r\n          :page-size=\"pageSize\"\r\n          @current-change=\"handlePageChange\"\r\n      />\r\n    </div>\r\n\r\n    <!-- 标签选择弹窗 -->\r\n    <el-dialog v-model=\"tagDialogVisible\" title=\"选择标签\" width=\"30%\">\r\n      <el-select v-model=\"selectedTagId\" placeholder=\"请选择标签\" style=\"width: 100%\">\r\n        <el-option\r\n            v-for=\"tag in tagOptions\"\r\n            :key=\"tag.tag_id\"\r\n            :label=\"tag.tag_name\"\r\n            :value=\"tag.tag_id\"\r\n        />\r\n      </el-select>\r\n      <template #footer>\r\n        <el-button @click=\"tagDialogVisible = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"connectTag\">确认</el-button>\r\n      </template>\r\n    </el-dialog>\r\n\r\n    <!-- 分类修改弹窗 -->\r\n    <el-dialog v-model=\"classDialogVisible\" title=\"更改分类\" width=\"30%\">\r\n      <el-select v-model=\"selectedClassId\" placeholder=\"请选择新分类\" style=\"width: 100%\">\r\n        <el-option\r\n            v-for=\"cls in SearchClassOptions\"\r\n            :key=\"cls.class_id\"\r\n            :label=\"cls.class_name\"\r\n            :value=\"cls.class_id\"\r\n        />\r\n      </el-select>\r\n      <template #footer>\r\n        <el-button @click=\"classDialogVisible = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"confirmClassChange\">确认</el-button>\r\n      </template>\r\n    </el-dialog>\r\n\r\n    <!-- 查看内容弹窗 -->\r\n    <el-dialog v-model=\"contentDialogVisible\" title=\"内容详情\" width=\"50%\">\r\n      <div v-if=\"contentDetail\">\r\n        <h3>{{ contentDetail.title }}</h3>\r\n        <img :src=\"contentDetail.cover_pic\" alt=\"封面\"\r\n             style=\"width: 100%; max-height: 300px; object-fit: contain; margin-bottom: 20px;\"/>\r\n        <div v-html=\"contentDetail.content\"></div>\r\n      </div>\r\n    </el-dialog>\r\n  </el-row>\r\n</template>\r\n\r\n<style scoped>\r\n.path {\r\n  height: 40px;\r\n  width: 100%;\r\n  background-color: #d8a6a6;\r\n}\r\n\r\n.search {\r\n  width: 100%;\r\n  background-color: #bbd2e3;\r\n}\r\n\r\n::v-deep(.el-table__row) {\r\n  height: 100px;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}