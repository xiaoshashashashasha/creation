{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport { ref, onMounted, nextTick, onUnmounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nimport { getChatList, getHistory, sendMessage, setMessageRead } from '@/api/prMessage';\nimport { userOtherInfoService, userInfoService } from '@/api/user';\nimport RichTextEditor from \"@/components/RichTextEditor.vue\";\nimport { throttle } from 'lodash-es';\nexport default {\n  __name: 'MyMessage',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const chatList = ref([]);\n    const activeChat = ref(null);\n    const messages = ref([]);\n    const inputMessage = ref('');\n    const pageNum = ref(1);\n    const pageSize = ref(20);\n    const loadingMessages = ref(false);\n    const currentUser = ref({});\n    const chatBodyRef = ref(null);\n    const router = useRouter();\n    const goBack = () => {\n      router.back();\n    };\n\n    // 获取当前用户信息\n    const fetchCurrentUser = async () => {\n      try {\n        const res = await userInfoService();\n        if (res.data) {\n          currentUser.value = res.data; // 成功后赋值\n        }\n      } catch (err) {\n        if (err?.response?.status === 401) {\n          console.warn('[Chat] 用户未登录，跳过');\n        } else {\n          console.error('[Chat] 获取当前用户信息失败:', err);\n          ElMessage.error('无法获取当前登录信息');\n        }\n      }\n    };\n    const fetchChatList = async () => {\n      try {\n        const res = await getChatList();\n        if (res.code === 0) {\n          const list = res.data || [];\n          // 批量补充头像昵称\n          for (const chat of list) {\n            try {\n              const userRes = await userOtherInfoService(chat.target_id);\n              if (userRes.data && userRes.code === 0) {\n                chat.nickname = userRes.data.nickname;\n                chat.user_pic = userRes.data.user_pic;\n              } else {\n                chat.nickname = '未知用户';\n                chat.user_pic = '';\n              }\n            } catch (err) {\n              console.error('拉取用户信息失败', err);\n              chat.nickname = '未知用户';\n              chat.user_pic = '';\n            }\n          }\n          chatList.value = list;\n        } else {\n          console.error('后端返回失败:', res);\n          ElMessage.error(res.msg || '获取聊天列表失败');\n        }\n      } catch (err) {\n        console.error('请求异常:', err);\n        ElMessage.error('网络错误');\n      }\n    };\n\n    // 拉取聊天记录\n    const fetchMessages = async (append = false) => {\n      if (!activeChat.value) return;\n      loadingMessages.value = true;\n      try {\n        const res = await getHistory({\n          pageNum: pageNum.value,\n          pageSize: pageSize.value,\n          target_id: activeChat.value.target_id\n        });\n        if (res.code === 0) {\n          const list = res.data || [];\n          if (list.length === 0 && append) {\n            noMoreMessages.value = true; // 加个flag标记到底了\n            return;\n          }\n          if (append) {\n            // 加载更多时追加到最前面\n            messages.value = [...list.reverse(), ...messages.value];\n          } else {\n            // 正常首次拉取\n            messages.value = list.reverse();\n            await nextTick();\n            scrollToBottom();\n          }\n        } else {\n          ElMessage.error(res.msg || '拉取聊天记录失败');\n        }\n      } catch (err) {\n        console.error('请求聊天记录异常:', err);\n        ElMessage.error('获取消息失败');\n      } finally {\n        loadingMessages.value = false;\n      }\n    };\n\n    // 选择聊天对象\n    const selectChat = async chat => {\n      activeChat.value = chat;\n      pageNum.value = 1; // 重新选择聊天对象时重置页码\n      messages.value = []; // 清空旧消息\n      await setMessageRead(chat.target_id);\n      await fetchMessages(); // 拉第一页最新的消息\n      await fetchChatList();\n    };\n\n    // 发送消息\n    const sendMsg = async () => {\n      if (!inputMessage.value.trim() || !activeChat.value) return;\n      try {\n        const content = inputMessage.value.trim();\n        await sendMessage({\n          to_id: activeChat.value.target_id,\n          content: content\n        });\n        inputMessage.value = '';\n\n        // 更新当前聊天窗口消息\n        await fetchMessages();\n\n        // 手动更新聊天列表最后一条消息\n        const now = new Date().toISOString().slice(0, 19).replace('T', ' '); // 格式成 'yyyy-MM-dd HH:mm:ss'\n        activeChat.value.lastMessage = content;\n        activeChat.value.lastTime = now;\n\n        // 同步更新到chatList列表中\n        const chat = chatList.value.find(c => c.target_id === activeChat.value.target_id);\n        if (chat) {\n          chat.lastMessage = content;\n          chat.lastTime = now;\n\n          //把当前聊天置顶\n          chatList.value = [chat, ...chatList.value.filter(c => c.target_id !== chat.target_id)];\n        }\n        await nextTick();\n        scrollToBottom();\n      } catch (err) {\n        ElMessage.error('发送失败');\n      }\n    };\n\n    // 自动滚动到底\n    const scrollToBottom = () => {\n      if (chatBodyRef.value) {\n        chatBodyRef.value.scrollTop = chatBodyRef.value.scrollHeight;\n      }\n    };\n    const noMoreMessages = ref(false); // 没有更多了标记\n\n    const handleScroll = async () => {\n      if (chatBodyRef.value.scrollTop <= 20 && !loadingMessages.value && !noMoreMessages.value) {\n        pageNum.value += 1;\n        await fetchMessages(true);\n      }\n    };\n    onMounted(async () => {\n      await fetchCurrentUser();\n      await fetchChatList();\n\n      // 绑定滚动监听\n      nextTick(() => {\n        if (chatBodyRef.value) {\n          chatBodyRef.value.addEventListener('scroll', throttle(handleScroll, 300));\n        }\n      });\n    });\n    onUnmounted(() => {\n      if (chatBodyRef.value) {\n        chatBodyRef.value.removeEventListener('scroll', handleScroll);\n      }\n    });\n    const __returned__ = {\n      chatList,\n      activeChat,\n      messages,\n      inputMessage,\n      pageNum,\n      pageSize,\n      loadingMessages,\n      currentUser,\n      chatBodyRef,\n      router,\n      goBack,\n      fetchCurrentUser,\n      fetchChatList,\n      fetchMessages,\n      selectChat,\n      sendMsg,\n      scrollToBottom,\n      noMoreMessages,\n      handleScroll,\n      ref,\n      onMounted,\n      nextTick,\n      onUnmounted,\n      get useRouter() {\n        return useRouter;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get getChatList() {\n        return getChatList;\n      },\n      get getHistory() {\n        return getHistory;\n      },\n      get sendMessage() {\n        return sendMessage;\n      },\n      get setMessageRead() {\n        return setMessageRead;\n      },\n      get userOtherInfoService() {\n        return userOtherInfoService;\n      },\n      get userInfoService() {\n        return userInfoService;\n      },\n      RichTextEditor,\n      get throttle() {\n        return throttle;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","nextTick","onUnmounted","useRouter","ElMessage","getChatList","getHistory","sendMessage","setMessageRead","userOtherInfoService","userInfoService","RichTextEditor","throttle","chatList","activeChat","messages","inputMessage","pageNum","pageSize","loadingMessages","currentUser","chatBodyRef","router","goBack","back","fetchCurrentUser","res","data","value","err","response","status","console","warn","error","fetchChatList","code","list","chat","userRes","target_id","nickname","user_pic","msg","fetchMessages","append","length","noMoreMessages","reverse","scrollToBottom","selectChat","sendMsg","trim","content","to_id","now","Date","toISOString","slice","replace","lastMessage","lastTime","find","c","filter","scrollTop","scrollHeight","handleScroll","addEventListener","removeEventListener"],"sources":["C:/Users/32561/Desktop/毕设仓库/beauty-front/src/views/Mine/MyMessage.vue"],"sourcesContent":["<script setup>\r\nimport {ref, onMounted, nextTick, onUnmounted} from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport {ElMessage} from 'element-plus'\r\nimport {getChatList, getHistory, sendMessage, setMessageRead} from '@/api/prMessage'\r\nimport {userOtherInfoService, userInfoService} from '@/api/user'\r\nimport RichTextEditor from \"@/components/RichTextEditor.vue\";\r\nimport { throttle } from 'lodash-es'\r\n\r\nconst chatList = ref([])\r\nconst activeChat = ref(null)\r\nconst messages = ref([])\r\nconst inputMessage = ref('')\r\nconst pageNum = ref(1)\r\nconst pageSize = ref(20)\r\nconst loadingMessages = ref(false)\r\nconst currentUser = ref({})\r\nconst chatBodyRef = ref(null)\r\n\r\nconst router = useRouter()\r\n\r\nconst goBack = () => {\r\n  router.back()\r\n}\r\n\r\n// 获取当前用户信息\r\nconst fetchCurrentUser = async () => {\r\n  try {\r\n    const res = await userInfoService()\r\n    if (res.data) {\r\n      currentUser.value = res.data  // 成功后赋值\r\n    }\r\n  } catch (err) {\r\n    if (err?.response?.status === 401) {\r\n      console.warn('[Chat] 用户未登录，跳过')\r\n    } else {\r\n      console.error('[Chat] 获取当前用户信息失败:', err)\r\n      ElMessage.error('无法获取当前登录信息')\r\n    }\r\n  }\r\n}\r\n\r\n\r\n\r\nconst fetchChatList = async () => {\r\n  try {\r\n    const res = await getChatList()\r\n\r\n    if (res.code === 0) {\r\n      const list = res.data || []\r\n      // 批量补充头像昵称\r\n      for (const chat of list) {\r\n        try {\r\n          const userRes = await userOtherInfoService(chat.target_id)\r\n          if (userRes.data && userRes.code === 0) {\r\n            chat.nickname = userRes.data.nickname\r\n            chat.user_pic = userRes.data.user_pic\r\n          } else {\r\n            chat.nickname = '未知用户'\r\n            chat.user_pic = ''\r\n          }\r\n        } catch (err) {\r\n          console.error('拉取用户信息失败', err)\r\n          chat.nickname = '未知用户'\r\n          chat.user_pic = ''\r\n        }\r\n      }\r\n      chatList.value = list\r\n    } else {\r\n      console.error('后端返回失败:', res)\r\n      ElMessage.error(res.msg || '获取聊天列表失败')\r\n    }\r\n  } catch (err) {\r\n    console.error('请求异常:', err)\r\n    ElMessage.error('网络错误')\r\n  }\r\n}\r\n\r\n\r\n// 拉取聊天记录\r\nconst fetchMessages = async (append = false) => {\r\n  if (!activeChat.value) return\r\n  loadingMessages.value = true\r\n  try {\r\n    const res = await getHistory({\r\n      pageNum: pageNum.value,\r\n      pageSize: pageSize.value,\r\n      target_id: activeChat.value.target_id\r\n    })\r\n    if (res.code === 0) {\r\n      const list = res.data || []\r\n      if (list.length === 0 && append) {\r\n        noMoreMessages.value = true  // 加个flag标记到底了\r\n        return\r\n      }\r\n\r\n      if (append) {\r\n        // 加载更多时追加到最前面\r\n        messages.value = [...list.reverse(), ...messages.value]\r\n      } else {\r\n        // 正常首次拉取\r\n        messages.value = list.reverse()\r\n        await nextTick()\r\n        scrollToBottom()\r\n      }\r\n    } else {\r\n      ElMessage.error(res.msg || '拉取聊天记录失败')\r\n    }\r\n  } catch (err) {\r\n    console.error('请求聊天记录异常:', err)\r\n    ElMessage.error('获取消息失败')\r\n  } finally {\r\n    loadingMessages.value = false\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n// 选择聊天对象\r\nconst selectChat = async (chat) => {\r\n  activeChat.value = chat\r\n  pageNum.value = 1 // 重新选择聊天对象时重置页码\r\n  messages.value = [] // 清空旧消息\r\n  await setMessageRead(chat.target_id)\r\n  await fetchMessages() // 拉第一页最新的消息\r\n  await fetchChatList()\r\n}\r\n\r\n\r\n\r\n// 发送消息\r\nconst sendMsg = async () => {\r\n  if (!inputMessage.value.trim() || !activeChat.value) return\r\n  try {\r\n    const content = inputMessage.value.trim()\r\n    await sendMessage({\r\n      to_id: activeChat.value.target_id,\r\n      content: content\r\n    })\r\n    inputMessage.value = ''\r\n\r\n    // 更新当前聊天窗口消息\r\n    await fetchMessages()\r\n\r\n    // 手动更新聊天列表最后一条消息\r\n    const now = new Date().toISOString().slice(0, 19).replace('T', ' ')  // 格式成 'yyyy-MM-dd HH:mm:ss'\r\n    activeChat.value.lastMessage = content\r\n    activeChat.value.lastTime = now\r\n\r\n    // 同步更新到chatList列表中\r\n    const chat = chatList.value.find(c => c.target_id === activeChat.value.target_id)\r\n    if (chat) {\r\n      chat.lastMessage = content\r\n      chat.lastTime = now\r\n\r\n      //把当前聊天置顶\r\n      chatList.value = [\r\n        chat,\r\n        ...chatList.value.filter(c => c.target_id !== chat.target_id)\r\n      ]\r\n    }\r\n\r\n    await nextTick()\r\n    scrollToBottom()\r\n\r\n  } catch (err) {\r\n    ElMessage.error('发送失败')\r\n  }\r\n}\r\n\r\n\r\n\r\n// 自动滚动到底\r\nconst scrollToBottom = () => {\r\n  if (chatBodyRef.value) {\r\n    chatBodyRef.value.scrollTop = chatBodyRef.value.scrollHeight\r\n  }\r\n}\r\n\r\nconst noMoreMessages = ref(false) // 没有更多了标记\r\n\r\nconst handleScroll = async () => {\r\n  if (chatBodyRef.value.scrollTop <= 20  && !loadingMessages.value && !noMoreMessages.value) {\r\n    pageNum.value += 1\r\n    await fetchMessages(true)\r\n  }\r\n}\r\n\r\n\r\n\r\nonMounted(async () => {\r\n  await fetchCurrentUser()\r\n  await fetchChatList()\r\n\r\n  // 绑定滚动监听\r\n  nextTick(() => {\r\n    if (chatBodyRef.value) {\r\n      chatBodyRef.value.addEventListener('scroll', throttle(handleScroll, 300))\r\n    }\r\n  })\r\n})\r\n\r\nonUnmounted(() => {\r\n  if (chatBodyRef.value) {\r\n    chatBodyRef.value.removeEventListener('scroll', handleScroll)\r\n  }\r\n})\r\n\r\n</script>\r\n\r\n<template>\r\n  <div class=\"main-content\">\r\n    <el-button type=\"primary\" plain class=\"back-btn\" @click=\"goBack\">\r\n      返回\r\n    </el-button>\r\n    <div class=\"message-page\">\r\n      <div class=\"chat-list\">\r\n        <div\r\n            v-for=\"chat in chatList\"\r\n            :key=\"chat.target_id\"\r\n            class=\"chat-item\"\r\n            :class=\"{ active: activeChat && activeChat.target_id === chat.target_id }\"\r\n            @click=\"selectChat(chat)\"\r\n        >\r\n          <el-avatar :src=\"chat.user_pic\" size=\"large\">{{ chat.nickname ? chat.nickname[0] : '?' }}</el-avatar>\r\n          <div class=\"chat-info\">\r\n            <div class=\"chat-name\">{{ chat.nickname }}</div>\r\n            <div class=\"chat-last\" v-html=\"chat.lastMessage\"></div>\r\n          </div>\r\n          <el-badge :value=\"chat.unReadCount\" v-if=\"chat.unReadCount > 0\"/>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"chat-window\" v-if=\"activeChat\">\r\n        <div class=\"chat-header\">\r\n          与 {{ activeChat.nickname }} 的聊天\r\n        </div>\r\n\r\n        <div class=\"chat-body\" ref=\"chatBodyRef\" v-loading=\"loadingMessages\">\r\n          <div v-for=\"msg in messages\" :key=\"msg.message_id\" class=\"chat-message\"\r\n               :class=\"{ 'me': msg.from_id === currentUser.user_id }\">\r\n            <div class=\"chat-content\" v-html=\"msg.content\"></div>\r\n            <div class=\"chat-time\">{{ new Date(msg.created_at).toLocaleString() }}</div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"chat-input\">\r\n          <RichTextEditor\r\n              v-model=\"inputMessage\"\r\n              style=\"height: 200px\"\r\n              :visible=\"true\"\r\n          />\r\n          <el-button type=\"primary\" @click=\"sendMsg\" style=\"height: 60px ;margin-top: 10px;\">发送</el-button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"chat-window\" v-else>\r\n        <div class=\"chat-placeholder\">请选择一个聊天</div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.main-content {\r\n  flex: 1;\r\n  width: 1720px;\r\n  margin: 0 auto;\r\n  background: #f5f7fa;\r\n}\r\n.message-page {\r\n  display: flex;\r\n  width: 1720px;\r\n  margin: 0 auto;\r\n  margin-bottom: 10px;\r\n  height: 86vh;\r\n  background: #f5f7fa;\r\n}\r\n\r\n.chat-list {\r\n  width: 300px;\r\n  background: white;\r\n  border-right: 1px solid #ddd;\r\n  overflow-y: auto;\r\n}\r\n\r\n.chat-item {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 15px;\r\n  cursor: pointer;\r\n  border-bottom: 1px solid #eee;\r\n  transition: background-color 0.3s, box-shadow 0.3s;\r\n}\r\n\r\n.chat-item:hover {\r\n  background: #f0faff;\r\n}\r\n\r\n.chat-item.active {\r\n  background: #e6f7ff;\r\n  box-shadow: inset 4px 0 0 #409eff; /* 左边一条蓝色高亮条 */\r\n}\r\n\r\n.chat-info {\r\n  margin-left: 10px;\r\n  flex: 1;\r\n  overflow: hidden;\r\n}\r\n\r\n.chat-name {\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n}\r\n\r\n.chat-last {\r\n  color: #999;\r\n  font-size: 12px;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n}\r\n\r\n\r\n.chat-window {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.chat-header {\r\n  background: white;\r\n  padding: 15px;\r\n  border-bottom: 1px solid #ddd;\r\n  font-weight: bold;\r\n}\r\n\r\n.chat-body {\r\n  flex: 1;\r\n  padding: 15px;\r\n  overflow-y: auto;\r\n  background: #f9f9f9;\r\n}\r\n\r\n.chat-message {\r\n  margin-bottom: 10px;\r\n  max-width: 60%;\r\n  word-break: break-word;\r\n}\r\n\r\n.chat-message.me {\r\n  margin-left: auto;\r\n  text-align: right;\r\n}\r\n\r\n.chat-content {\r\n  display: inline-block;\r\n  background: #409eff;\r\n  color: white;\r\n  padding: 10px;\r\n  border-radius: 8px;\r\n}\r\n\r\n.chat-message.me .chat-content {\r\n  background: #67c23a;\r\n}\r\n\r\n.chat-time {\r\n  font-size: 10px;\r\n  color: #999;\r\n  margin-top: 5px;\r\n}\r\n\r\n.chat-input {\r\n  display: flex;\r\n  padding: 15px;\r\n  background: white;\r\n  border-top: 1px solid #ddd;\r\n}\r\n\r\n.chat-placeholder {\r\n  margin: auto;\r\n  font-size: 20px;\r\n  color: #ccc;\r\n}\r\n\r\n.back-btn {\r\n  margin: 5px;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}