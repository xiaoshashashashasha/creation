{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { isTextSelection, isNodeSelection, posToDOMRect, Extension } from '@tiptap/core';\nimport { Plugin, PluginKey } from '@tiptap/pm/state';\nimport tippy from 'tippy.js';\nclass BubbleMenuView {\n  constructor({\n    editor,\n    element,\n    view,\n    tippyOptions = {},\n    updateDelay = 250,\n    shouldShow\n  }) {\n    this.preventHide = false;\n    this.shouldShow = ({\n      view,\n      state,\n      from,\n      to\n    }) => {\n      const {\n        doc,\n        selection\n      } = state;\n      const {\n        empty\n      } = selection;\n      // Sometime check for `empty` is not enough.\n      // Doubleclick an empty paragraph returns a node size of 2.\n      // So we check also for an empty text size.\n      const isEmptyTextBlock = !doc.textBetween(from, to).length && isTextSelection(state.selection);\n      // When clicking on a element inside the bubble menu the editor \"blur\" event\n      // is called and the bubble menu item is focussed. In this case we should\n      // consider the menu as part of the editor and keep showing the menu\n      const isChildOfMenu = this.element.contains(document.activeElement);\n      const hasEditorFocus = view.hasFocus() || isChildOfMenu;\n      if (!hasEditorFocus || empty || isEmptyTextBlock || !this.editor.isEditable) {\n        return false;\n      }\n      return true;\n    };\n    this.mousedownHandler = () => {\n      this.preventHide = true;\n    };\n    this.dragstartHandler = () => {\n      this.hide();\n    };\n    this.focusHandler = () => {\n      // we use `setTimeout` to make sure `selection` is already updated\n      setTimeout(() => this.update(this.editor.view));\n    };\n    this.blurHandler = ({\n      event\n    }) => {\n      var _a;\n      if (this.preventHide) {\n        this.preventHide = false;\n        return;\n      }\n      if ((event === null || event === void 0 ? void 0 : event.relatedTarget) && ((_a = this.element.parentNode) === null || _a === void 0 ? void 0 : _a.contains(event.relatedTarget))) {\n        return;\n      }\n      if ((event === null || event === void 0 ? void 0 : event.relatedTarget) === this.editor.view.dom) {\n        return;\n      }\n      this.hide();\n    };\n    this.tippyBlurHandler = event => {\n      this.blurHandler({\n        event\n      });\n    };\n    this.handleDebouncedUpdate = (view, oldState) => {\n      const selectionChanged = !(oldState === null || oldState === void 0 ? void 0 : oldState.selection.eq(view.state.selection));\n      const docChanged = !(oldState === null || oldState === void 0 ? void 0 : oldState.doc.eq(view.state.doc));\n      if (!selectionChanged && !docChanged) {\n        return;\n      }\n      if (this.updateDebounceTimer) {\n        clearTimeout(this.updateDebounceTimer);\n      }\n      this.updateDebounceTimer = window.setTimeout(() => {\n        this.updateHandler(view, selectionChanged, docChanged, oldState);\n      }, this.updateDelay);\n    };\n    this.updateHandler = (view, selectionChanged, docChanged, oldState) => {\n      var _a, _b, _c;\n      const {\n        state,\n        composing\n      } = view;\n      const {\n        selection\n      } = state;\n      const isSame = !selectionChanged && !docChanged;\n      if (composing || isSame) {\n        return;\n      }\n      this.createTooltip();\n      // support for CellSelections\n      const {\n        ranges\n      } = selection;\n      const from = Math.min(...ranges.map(range => range.$from.pos));\n      const to = Math.max(...ranges.map(range => range.$to.pos));\n      const shouldShow = (_a = this.shouldShow) === null || _a === void 0 ? void 0 : _a.call(this, {\n        editor: this.editor,\n        element: this.element,\n        view,\n        state,\n        oldState,\n        from,\n        to\n      });\n      if (!shouldShow) {\n        this.hide();\n        return;\n      }\n      (_b = this.tippy) === null || _b === void 0 ? void 0 : _b.setProps({\n        getReferenceClientRect: ((_c = this.tippyOptions) === null || _c === void 0 ? void 0 : _c.getReferenceClientRect) || (() => {\n          if (isNodeSelection(state.selection)) {\n            let node = view.nodeDOM(from);\n            if (node) {\n              const nodeViewWrapper = node.dataset.nodeViewWrapper ? node : node.querySelector('[data-node-view-wrapper]');\n              if (nodeViewWrapper) {\n                node = nodeViewWrapper.firstChild;\n              }\n              if (node) {\n                return node.getBoundingClientRect();\n              }\n            }\n          }\n          return posToDOMRect(view, from, to);\n        })\n      });\n      this.show();\n    };\n    this.editor = editor;\n    this.element = element;\n    this.view = view;\n    this.updateDelay = updateDelay;\n    if (shouldShow) {\n      this.shouldShow = shouldShow;\n    }\n    this.element.addEventListener('mousedown', this.mousedownHandler, {\n      capture: true\n    });\n    this.view.dom.addEventListener('dragstart', this.dragstartHandler);\n    this.editor.on('focus', this.focusHandler);\n    this.editor.on('blur', this.blurHandler);\n    this.tippyOptions = tippyOptions;\n    // Detaches menu content from its current parent\n    this.element.remove();\n    this.element.style.visibility = 'visible';\n  }\n  createTooltip() {\n    const {\n      element: editorElement\n    } = this.editor.options;\n    const editorIsAttached = !!editorElement.parentElement;\n    if (this.tippy || !editorIsAttached) {\n      return;\n    }\n    this.tippy = tippy(editorElement, {\n      duration: 0,\n      getReferenceClientRect: null,\n      content: this.element,\n      interactive: true,\n      trigger: 'manual',\n      placement: 'top',\n      hideOnClick: 'toggle',\n      ...this.tippyOptions\n    });\n    // maybe we have to hide tippy on its own blur event as well\n    if (this.tippy.popper.firstChild) {\n      this.tippy.popper.firstChild.addEventListener('blur', this.tippyBlurHandler);\n    }\n  }\n  update(view, oldState) {\n    const {\n      state\n    } = view;\n    const hasValidSelection = state.selection.from !== state.selection.to;\n    if (this.updateDelay > 0 && hasValidSelection) {\n      this.handleDebouncedUpdate(view, oldState);\n      return;\n    }\n    const selectionChanged = !(oldState === null || oldState === void 0 ? void 0 : oldState.selection.eq(view.state.selection));\n    const docChanged = !(oldState === null || oldState === void 0 ? void 0 : oldState.doc.eq(view.state.doc));\n    this.updateHandler(view, selectionChanged, docChanged, oldState);\n  }\n  show() {\n    var _a;\n    (_a = this.tippy) === null || _a === void 0 ? void 0 : _a.show();\n  }\n  hide() {\n    var _a;\n    (_a = this.tippy) === null || _a === void 0 ? void 0 : _a.hide();\n  }\n  destroy() {\n    var _a, _b;\n    if ((_a = this.tippy) === null || _a === void 0 ? void 0 : _a.popper.firstChild) {\n      this.tippy.popper.firstChild.removeEventListener('blur', this.tippyBlurHandler);\n    }\n    (_b = this.tippy) === null || _b === void 0 ? void 0 : _b.destroy();\n    this.element.removeEventListener('mousedown', this.mousedownHandler, {\n      capture: true\n    });\n    this.view.dom.removeEventListener('dragstart', this.dragstartHandler);\n    this.editor.off('focus', this.focusHandler);\n    this.editor.off('blur', this.blurHandler);\n  }\n}\nconst BubbleMenuPlugin = options => {\n  return new Plugin({\n    key: typeof options.pluginKey === 'string' ? new PluginKey(options.pluginKey) : options.pluginKey,\n    view: view => new BubbleMenuView({\n      view,\n      ...options\n    })\n  });\n};\n\n/**\n * This extension allows you to create a bubble menu.\n * @see https://tiptap.dev/api/extensions/bubble-menu\n */\nconst BubbleMenu = Extension.create({\n  name: 'bubbleMenu',\n  addOptions() {\n    return {\n      element: null,\n      tippyOptions: {},\n      pluginKey: 'bubbleMenu',\n      updateDelay: undefined,\n      shouldShow: null\n    };\n  },\n  addProseMirrorPlugins() {\n    if (!this.options.element) {\n      return [];\n    }\n    return [BubbleMenuPlugin({\n      pluginKey: this.options.pluginKey,\n      editor: this.editor,\n      element: this.options.element,\n      tippyOptions: this.options.tippyOptions,\n      updateDelay: this.options.updateDelay,\n      shouldShow: this.options.shouldShow\n    })];\n  }\n});\nexport { BubbleMenu, BubbleMenuPlugin, BubbleMenuView, BubbleMenu as default };","map":{"version":3,"names":["BubbleMenuView","constructor","editor","element","view","tippyOptions","updateDelay","shouldShow","preventHide","state","from","to","doc","selection","empty","isEmptyTextBlock","textBetween","length","isTextSelection","isChildOfMenu","contains","document","activeElement","hasEditorFocus","hasFocus","isEditable","mousedownHandler","dragstartHandler","hide","focusHandler","setTimeout","update","blurHandler","event","relatedTarget","_a","parentNode","dom","tippyBlurHandler","handleDebouncedUpdate","oldState","selectionChanged","eq","docChanged","updateDebounceTimer","clearTimeout","window","updateHandler","composing","isSame","createTooltip","ranges","Math","min","map","range","$from","pos","max","$to","call","_b","tippy","setProps","getReferenceClientRect","_c","isNodeSelection","node","nodeDOM","nodeViewWrapper","dataset","querySelector","firstChild","getBoundingClientRect","posToDOMRect","show","addEventListener","capture","on","remove","style","visibility","editorElement","options","editorIsAttached","parentElement","duration","content","interactive","trigger","placement","hideOnClick","popper","hasValidSelection","destroy","removeEventListener","off","BubbleMenuPlugin","Plugin","key","pluginKey","PluginKey","BubbleMenu","Extension","create","name","addOptions","undefined","addProseMirrorPlugins"],"sources":["../src/bubble-menu-plugin.ts","../src/bubble-menu.ts"],"sourcesContent":["import {\n  Editor, isNodeSelection, isTextSelection, posToDOMRect,\n} from '@tiptap/core'\nimport { EditorState, Plugin, PluginKey } from '@tiptap/pm/state'\nimport { EditorView } from '@tiptap/pm/view'\nimport tippy, { Instance, Props } from 'tippy.js'\n\nexport interface BubbleMenuPluginProps {\n  /**\n   * The plugin key.\n   * @type {PluginKey | string}\n   * @default 'bubbleMenu'\n   */\n  pluginKey: PluginKey | string\n\n  /**\n   * The editor instance.\n   */\n  editor: Editor\n\n  /**\n   * The DOM element that contains your menu.\n   * @type {HTMLElement}\n   * @default null\n   */\n  element: HTMLElement\n\n  /**\n   * The options for the tippy.js instance.\n   * @see https://atomiks.github.io/tippyjs/v6/all-props/\n   */\n  tippyOptions?: Partial<Props>\n\n  /**\n   * The delay in milliseconds before the menu should be updated.\n   * This can be useful to prevent performance issues.\n   * @type {number}\n   * @default 250\n   */\n  updateDelay?: number\n\n  /**\n   * A function that determines whether the menu should be shown or not.\n   * If this function returns `false`, the menu will be hidden, otherwise it will be shown.\n   */\n  shouldShow?:\n    | ((props: {\n        editor: Editor\n        element: HTMLElement\n        view: EditorView\n        state: EditorState\n        oldState?: EditorState\n        from: number\n        to: number\n      }) => boolean)\n    | null\n}\n\nexport type BubbleMenuViewProps = BubbleMenuPluginProps & {\n  view: EditorView\n}\n\nexport class BubbleMenuView {\n  public editor: Editor\n\n  public element: HTMLElement\n\n  public view: EditorView\n\n  public preventHide = false\n\n  public tippy: Instance | undefined\n\n  public tippyOptions?: Partial<Props>\n\n  public updateDelay: number\n\n  private updateDebounceTimer: number | undefined\n\n  public shouldShow: Exclude<BubbleMenuPluginProps['shouldShow'], null> = ({\n    view,\n    state,\n    from,\n    to,\n  }) => {\n    const { doc, selection } = state\n    const { empty } = selection\n\n    // Sometime check for `empty` is not enough.\n    // Doubleclick an empty paragraph returns a node size of 2.\n    // So we check also for an empty text size.\n    const isEmptyTextBlock = !doc.textBetween(from, to).length && isTextSelection(state.selection)\n\n    // When clicking on a element inside the bubble menu the editor \"blur\" event\n    // is called and the bubble menu item is focussed. In this case we should\n    // consider the menu as part of the editor and keep showing the menu\n    const isChildOfMenu = this.element.contains(document.activeElement)\n\n    const hasEditorFocus = view.hasFocus() || isChildOfMenu\n\n    if (!hasEditorFocus || empty || isEmptyTextBlock || !this.editor.isEditable) {\n      return false\n    }\n\n    return true\n  }\n\n  constructor({\n    editor,\n    element,\n    view,\n    tippyOptions = {},\n    updateDelay = 250,\n    shouldShow,\n  }: BubbleMenuViewProps) {\n    this.editor = editor\n    this.element = element\n    this.view = view\n    this.updateDelay = updateDelay\n\n    if (shouldShow) {\n      this.shouldShow = shouldShow\n    }\n\n    this.element.addEventListener('mousedown', this.mousedownHandler, { capture: true })\n    this.view.dom.addEventListener('dragstart', this.dragstartHandler)\n    this.editor.on('focus', this.focusHandler)\n    this.editor.on('blur', this.blurHandler)\n    this.tippyOptions = tippyOptions\n    // Detaches menu content from its current parent\n    this.element.remove()\n    this.element.style.visibility = 'visible'\n  }\n\n  mousedownHandler = () => {\n    this.preventHide = true\n  }\n\n  dragstartHandler = () => {\n    this.hide()\n  }\n\n  focusHandler = () => {\n    // we use `setTimeout` to make sure `selection` is already updated\n    setTimeout(() => this.update(this.editor.view))\n  }\n\n  blurHandler = ({ event }: { event: FocusEvent }) => {\n    if (this.preventHide) {\n      this.preventHide = false\n\n      return\n    }\n\n    if (event?.relatedTarget && this.element.parentNode?.contains(event.relatedTarget as Node)) {\n      return\n    }\n\n    if (\n      event?.relatedTarget === this.editor.view.dom\n    ) {\n      return\n    }\n\n    this.hide()\n  }\n\n  tippyBlurHandler = (event: FocusEvent) => {\n    this.blurHandler({ event })\n  }\n\n  createTooltip() {\n    const { element: editorElement } = this.editor.options\n    const editorIsAttached = !!editorElement.parentElement\n\n    if (this.tippy || !editorIsAttached) {\n      return\n    }\n\n    this.tippy = tippy(editorElement, {\n      duration: 0,\n      getReferenceClientRect: null,\n      content: this.element,\n      interactive: true,\n      trigger: 'manual',\n      placement: 'top',\n      hideOnClick: 'toggle',\n      ...this.tippyOptions,\n    })\n\n    // maybe we have to hide tippy on its own blur event as well\n    if (this.tippy.popper.firstChild) {\n      (this.tippy.popper.firstChild as HTMLElement).addEventListener('blur', this.tippyBlurHandler)\n    }\n  }\n\n  update(view: EditorView, oldState?: EditorState) {\n    const { state } = view\n    const hasValidSelection = state.selection.from !== state.selection.to\n\n    if (this.updateDelay > 0 && hasValidSelection) {\n      this.handleDebouncedUpdate(view, oldState)\n      return\n    }\n\n    const selectionChanged = !oldState?.selection.eq(view.state.selection)\n    const docChanged = !oldState?.doc.eq(view.state.doc)\n\n    this.updateHandler(view, selectionChanged, docChanged, oldState)\n  }\n\n  handleDebouncedUpdate = (view: EditorView, oldState?: EditorState) => {\n    const selectionChanged = !oldState?.selection.eq(view.state.selection)\n    const docChanged = !oldState?.doc.eq(view.state.doc)\n\n    if (!selectionChanged && !docChanged) {\n      return\n    }\n\n    if (this.updateDebounceTimer) {\n      clearTimeout(this.updateDebounceTimer)\n    }\n\n    this.updateDebounceTimer = window.setTimeout(() => {\n      this.updateHandler(view, selectionChanged, docChanged, oldState)\n    }, this.updateDelay)\n  }\n\n  updateHandler = (view: EditorView, selectionChanged: boolean, docChanged: boolean, oldState?: EditorState) => {\n    const { state, composing } = view\n    const { selection } = state\n\n    const isSame = !selectionChanged && !docChanged\n\n    if (composing || isSame) {\n      return\n    }\n\n    this.createTooltip()\n\n    // support for CellSelections\n    const { ranges } = selection\n    const from = Math.min(...ranges.map(range => range.$from.pos))\n    const to = Math.max(...ranges.map(range => range.$to.pos))\n\n    const shouldShow = this.shouldShow?.({\n      editor: this.editor,\n      element: this.element,\n      view,\n      state,\n      oldState,\n      from,\n      to,\n    })\n\n    if (!shouldShow) {\n      this.hide()\n\n      return\n    }\n\n    this.tippy?.setProps({\n      getReferenceClientRect:\n        this.tippyOptions?.getReferenceClientRect\n        || (() => {\n          if (isNodeSelection(state.selection)) {\n            let node = view.nodeDOM(from) as HTMLElement\n\n            if (node) {\n              const nodeViewWrapper = node.dataset.nodeViewWrapper ? node : node.querySelector('[data-node-view-wrapper]')\n\n              if (nodeViewWrapper) {\n                node = nodeViewWrapper.firstChild as HTMLElement\n              }\n\n              if (node) {\n                return node.getBoundingClientRect()\n              }\n            }\n          }\n\n          return posToDOMRect(view, from, to)\n        }),\n    })\n\n    this.show()\n  }\n\n  show() {\n    this.tippy?.show()\n  }\n\n  hide() {\n    this.tippy?.hide()\n  }\n\n  destroy() {\n    if (this.tippy?.popper.firstChild) {\n      (this.tippy.popper.firstChild as HTMLElement).removeEventListener(\n        'blur',\n        this.tippyBlurHandler,\n      )\n    }\n    this.tippy?.destroy()\n    this.element.removeEventListener('mousedown', this.mousedownHandler, { capture: true })\n    this.view.dom.removeEventListener('dragstart', this.dragstartHandler)\n    this.editor.off('focus', this.focusHandler)\n    this.editor.off('blur', this.blurHandler)\n  }\n}\n\nexport const BubbleMenuPlugin = (options: BubbleMenuPluginProps) => {\n  return new Plugin({\n    key:\n      typeof options.pluginKey === 'string' ? new PluginKey(options.pluginKey) : options.pluginKey,\n    view: view => new BubbleMenuView({ view, ...options }),\n  })\n}\n","import { Extension } from '@tiptap/core'\n\nimport { BubbleMenuPlugin, BubbleMenuPluginProps } from './bubble-menu-plugin.js'\n\nexport type BubbleMenuOptions = Omit<BubbleMenuPluginProps, 'editor' | 'element'> & {\n  /**\n   * The DOM element that contains your menu.\n   * @type {HTMLElement}\n   * @default null\n   */\n  element: HTMLElement | null,\n}\n\n/**\n * This extension allows you to create a bubble menu.\n * @see https://tiptap.dev/api/extensions/bubble-menu\n */\nexport const BubbleMenu = Extension.create<BubbleMenuOptions>({\n  name: 'bubbleMenu',\n\n  addOptions() {\n    return {\n      element: null,\n      tippyOptions: {},\n      pluginKey: 'bubbleMenu',\n      updateDelay: undefined,\n      shouldShow: null,\n    }\n  },\n\n  addProseMirrorPlugins() {\n    if (!this.options.element) {\n      return []\n    }\n\n    return [\n      BubbleMenuPlugin({\n        pluginKey: this.options.pluginKey,\n        editor: this.editor,\n        element: this.options.element,\n        tippyOptions: this.options.tippyOptions,\n        updateDelay: this.options.updateDelay,\n        shouldShow: this.options.shouldShow,\n      }),\n    ]\n  },\n})\n"],"mappings":";;;;;MA8DaA,cAAc;EA6CzBC,YAAY;IACVC,MAAM;IACNC,OAAO;IACPC,IAAI;IACJC,YAAY,GAAG,EAAE;IACjBC,WAAW,GAAG,GAAG;IACjBC;EAAU,CACU;IA7Cf,IAAW,CAAAC,WAAA,GAAG,KAAK;IAUnB,KAAAD,UAAU,GAAuD,CAAC;MACvEH,IAAI;MACJK,KAAK;MACLC,IAAI;MACJC;IAAE,CACH,KAAI;MACH,MAAM;QAAEC,GAAG;QAAEC;MAAS,CAAE,GAAGJ,KAAK;MAChC,MAAM;QAAEK;MAAK,CAAE,GAAGD,SAAS;;;;MAK3B,MAAME,gBAAgB,GAAG,CAACH,GAAG,CAACI,WAAW,CAACN,IAAI,EAAEC,EAAE,CAAC,CAACM,MAAM,IAAIC,eAAe,CAACT,KAAK,CAACI,SAAS,CAAC;;;;MAK9F,MAAMM,aAAa,GAAG,IAAI,CAAChB,OAAO,CAACiB,QAAQ,CAACC,QAAQ,CAACC,aAAa,CAAC;MAEnE,MAAMC,cAAc,GAAGnB,IAAI,CAACoB,QAAQ,EAAE,IAAIL,aAAa;MAEvD,IAAI,CAACI,cAAc,IAAIT,KAAK,IAAIC,gBAAgB,IAAI,CAAC,IAAI,CAACb,MAAM,CAACuB,UAAU,EAAE;QAC3E,OAAO,KAAK;;MAGd,OAAO,IAAI;IACb,CAAC;IA6BD,IAAgB,CAAAC,gBAAA,GAAG,MAAK;MACtB,IAAI,CAAClB,WAAW,GAAG,IAAI;IACzB,CAAC;IAED,IAAgB,CAAAmB,gBAAA,GAAG,MAAK;MACtB,IAAI,CAACC,IAAI,EAAE;IACb,CAAC;IAED,IAAY,CAAAC,YAAA,GAAG,MAAK;;MAElBC,UAAU,CAAC,MAAM,IAAI,CAACC,MAAM,CAAC,IAAI,CAAC7B,MAAM,CAACE,IAAI,CAAC,CAAC;IACjD,CAAC;IAED,KAAA4B,WAAW,GAAG,CAAC;MAAEC;IAAK,CAAyB,KAAI;;MACjD,IAAI,IAAI,CAACzB,WAAW,EAAE;QACpB,IAAI,CAACA,WAAW,GAAG,KAAK;QAExB;;MAGF,IAAI,CAAAyB,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEC,aAAa,MAAI,CAAAC,EAAA,OAAI,CAAChC,OAAO,CAACiC,UAAU,MAAE,QAAAD,EAAA,uBAAAA,EAAA,CAAAf,QAAQ,CAACa,KAAK,CAACC,aAAqB,CAAC,GAAE;QAC1F;;MAGF,IACE,CAAAD,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEC,aAAa,MAAK,IAAI,CAAChC,MAAM,CAACE,IAAI,CAACiC,GAAG,EAC7C;QACA;;MAGF,IAAI,CAACT,IAAI,EAAE;IACb,CAAC;IAED,KAAAU,gBAAgB,GAAIL,KAAiB,IAAI;MACvC,IAAI,CAACD,WAAW,CAAC;QAAEC;MAAK,CAAE,CAAC;IAC7B,CAAC;IA0CD,KAAAM,qBAAqB,GAAG,CAACnC,IAAgB,EAAEoC,QAAsB,KAAI;MACnE,MAAMC,gBAAgB,GAAG,EAACD,QAAQ,KAAR,QAAAA,QAAQ,uBAARA,QAAQ,CAAE3B,SAAS,CAAC6B,EAAE,CAACtC,IAAI,CAACK,KAAK,CAACI,SAAS,CAAC;MACtE,MAAM8B,UAAU,GAAG,EAACH,QAAQ,KAAR,QAAAA,QAAQ,uBAARA,QAAQ,CAAE5B,GAAG,CAAC8B,EAAE,CAACtC,IAAI,CAACK,KAAK,CAACG,GAAG,CAAC;MAEpD,IAAI,CAAC6B,gBAAgB,IAAI,CAACE,UAAU,EAAE;QACpC;;MAGF,IAAI,IAAI,CAACC,mBAAmB,EAAE;QAC5BC,YAAY,CAAC,IAAI,CAACD,mBAAmB,CAAC;;MAGxC,IAAI,CAACA,mBAAmB,GAAGE,MAAM,CAAChB,UAAU,CAAC,MAAK;QAChD,IAAI,CAACiB,aAAa,CAAC3C,IAAI,EAAEqC,gBAAgB,EAAEE,UAAU,EAAEH,QAAQ,CAAC;MAClE,CAAC,EAAE,IAAI,CAAClC,WAAW,CAAC;IACtB,CAAC;IAED,IAAa,CAAAyC,aAAA,GAAG,CAAC3C,IAAgB,EAAEqC,gBAAyB,EAAEE,UAAmB,EAAEH,QAAsB,KAAI;;MAC3G,MAAM;QAAE/B,KAAK;QAAEuC;MAAS,CAAE,GAAG5C,IAAI;MACjC,MAAM;QAAES;MAAS,CAAE,GAAGJ,KAAK;MAE3B,MAAMwC,MAAM,GAAG,CAACR,gBAAgB,IAAI,CAACE,UAAU;MAE/C,IAAIK,SAAS,IAAIC,MAAM,EAAE;QACvB;;MAGF,IAAI,CAACC,aAAa,EAAE;;MAGpB,MAAM;QAAEC;MAAM,CAAE,GAAGtC,SAAS;MAC5B,MAAMH,IAAI,GAAG0C,IAAI,CAACC,GAAG,CAAC,GAAGF,MAAM,CAACG,GAAG,CAACC,KAAK,IAAIA,KAAK,CAACC,KAAK,CAACC,GAAG,CAAC,CAAC;MAC9D,MAAM9C,EAAE,GAAGyC,IAAI,CAACM,GAAG,CAAC,GAAGP,MAAM,CAACG,GAAG,CAACC,KAAK,IAAIA,KAAK,CAACI,GAAG,CAACF,GAAG,CAAC,CAAC;MAE1D,MAAMlD,UAAU,GAAG,CAAA4B,EAAA,OAAI,CAAC5B,UAAU,MAAG,QAAA4B,EAAA,uBAAAA,EAAA,CAAAyB,IAAA;QACnC1D,MAAM,EAAE,IAAI,CAACA,MAAM;QACnBC,OAAO,EAAE,IAAI,CAACA,OAAO;QACrBC,IAAI;QACJK,KAAK;QACL+B,QAAQ;QACR9B,IAAI;QACJC;MACD,EAAC;MAEF,IAAI,CAACJ,UAAU,EAAE;QACf,IAAI,CAACqB,IAAI,EAAE;QAEX;;MAGF,CAAAiC,EAAA,OAAI,CAACC,KAAK,cAAAD,EAAA,uBAAAA,EAAA,CAAEE,QAAQ,CAAC;QACnBC,sBAAsB,EACpB,EAAAC,EAAA,OAAI,CAAC5D,YAAY,cAAA4D,EAAA,uBAAAA,EAAA,CAAED,sBAAsB,MACrC,MAAK;UACP,IAAIE,eAAe,CAACzD,KAAK,CAACI,SAAS,CAAC,EAAE;YACpC,IAAIsD,IAAI,GAAG/D,IAAI,CAACgE,OAAO,CAAC1D,IAAI,CAAgB;YAE5C,IAAIyD,IAAI,EAAE;cACR,MAAME,eAAe,GAAGF,IAAI,CAACG,OAAO,CAACD,eAAe,GAAGF,IAAI,GAAGA,IAAI,CAACI,aAAa,CAAC,0BAA0B,CAAC;cAE5G,IAAIF,eAAe,EAAE;gBACnBF,IAAI,GAAGE,eAAe,CAACG,UAAyB;;cAGlD,IAAIL,IAAI,EAAE;gBACR,OAAOA,IAAI,CAACM,qBAAqB,EAAE;;;;UAKzC,OAAOC,YAAY,CAACtE,IAAI,EAAEM,IAAI,EAAEC,EAAE,CAAC;QACrC,CAAC;MACJ,EAAC;MAEF,IAAI,CAACgE,IAAI,EAAE;IACb,CAAC;IA3KC,IAAI,CAACzE,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACC,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACC,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACE,WAAW,GAAGA,WAAW;IAE9B,IAAIC,UAAU,EAAE;MACd,IAAI,CAACA,UAAU,GAAGA,UAAU;;IAG9B,IAAI,CAACJ,OAAO,CAACyE,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAClD,gBAAgB,EAAE;MAAEmD,OAAO,EAAE;IAAI,CAAE,CAAC;IACpF,IAAI,CAACzE,IAAI,CAACiC,GAAG,CAACuC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAACjD,gBAAgB,CAAC;IAClE,IAAI,CAACzB,MAAM,CAAC4E,EAAE,CAAC,OAAO,EAAE,IAAI,CAACjD,YAAY,CAAC;IAC1C,IAAI,CAAC3B,MAAM,CAAC4E,EAAE,CAAC,MAAM,EAAE,IAAI,CAAC9C,WAAW,CAAC;IACxC,IAAI,CAAC3B,YAAY,GAAGA,YAAY;;IAEhC,IAAI,CAACF,OAAO,CAAC4E,MAAM,EAAE;IACrB,IAAI,CAAC5E,OAAO,CAAC6E,KAAK,CAACC,UAAU,GAAG,SAAS;;EAwC3C/B,aAAaA,CAAA;IACX,MAAM;MAAE/C,OAAO,EAAE+E;IAAa,CAAE,GAAG,IAAI,CAAChF,MAAM,CAACiF,OAAO;IACtD,MAAMC,gBAAgB,GAAG,CAAC,CAACF,aAAa,CAACG,aAAa;IAEtD,IAAI,IAAI,CAACvB,KAAK,IAAI,CAACsB,gBAAgB,EAAE;MACnC;;IAGF,IAAI,CAACtB,KAAK,GAAGA,KAAK,CAACoB,aAAa,EAAE;MAChCI,QAAQ,EAAE,CAAC;MACXtB,sBAAsB,EAAE,IAAI;MAC5BuB,OAAO,EAAE,IAAI,CAACpF,OAAO;MACrBqF,WAAW,EAAE,IAAI;MACjBC,OAAO,EAAE,QAAQ;MACjBC,SAAS,EAAE,KAAK;MAChBC,WAAW,EAAE,QAAQ;MACrB,GAAG,IAAI,CAACtF;IACT,EAAC;;IAGF,IAAI,IAAI,CAACyD,KAAK,CAAC8B,MAAM,CAACpB,UAAU,EAAE;MAC/B,IAAI,CAACV,KAAK,CAAC8B,MAAM,CAACpB,UAA0B,CAACI,gBAAgB,CAAC,MAAM,EAAE,IAAI,CAACtC,gBAAgB,CAAC;;;EAIjGP,MAAMA,CAAC3B,IAAgB,EAAEoC,QAAsB;IAC7C,MAAM;MAAE/B;IAAK,CAAE,GAAGL,IAAI;IACtB,MAAMyF,iBAAiB,GAAGpF,KAAK,CAACI,SAAS,CAACH,IAAI,KAAKD,KAAK,CAACI,SAAS,CAACF,EAAE;IAErE,IAAI,IAAI,CAACL,WAAW,GAAG,CAAC,IAAIuF,iBAAiB,EAAE;MAC7C,IAAI,CAACtD,qBAAqB,CAACnC,IAAI,EAAEoC,QAAQ,CAAC;MAC1C;;IAGF,MAAMC,gBAAgB,GAAG,EAACD,QAAQ,KAAR,QAAAA,QAAQ,uBAARA,QAAQ,CAAE3B,SAAS,CAAC6B,EAAE,CAACtC,IAAI,CAACK,KAAK,CAACI,SAAS,CAAC;IACtE,MAAM8B,UAAU,GAAG,EAACH,QAAQ,KAAR,QAAAA,QAAQ,uBAARA,QAAQ,CAAE5B,GAAG,CAAC8B,EAAE,CAACtC,IAAI,CAACK,KAAK,CAACG,GAAG,CAAC;IAEpD,IAAI,CAACmC,aAAa,CAAC3C,IAAI,EAAEqC,gBAAgB,EAAEE,UAAU,EAAEH,QAAQ,CAAC;;EAgFlEmC,IAAIA,CAAA;;IACF,CAAAxC,EAAA,OAAI,CAAC2B,KAAK,MAAE,QAAA3B,EAAA,uBAAAA,EAAA,CAAAwC,IAAI,EAAE;;EAGpB/C,IAAIA,CAAA;;IACF,CAAAO,EAAA,OAAI,CAAC2B,KAAK,MAAE,QAAA3B,EAAA,uBAAAA,EAAA,CAAAP,IAAI,EAAE;;EAGpBkE,OAAOA,CAAA;;IACL,IAAI,CAAA3D,EAAA,OAAI,CAAC2B,KAAK,cAAA3B,EAAA,uBAAAA,EAAA,CAAEyD,MAAM,CAACpB,UAAU,EAAE;MAChC,IAAI,CAACV,KAAK,CAAC8B,MAAM,CAACpB,UAA0B,CAACuB,mBAAmB,CAC/D,MAAM,EACN,IAAI,CAACzD,gBAAgB,CACtB;;IAEH,CAAAuB,EAAA,OAAI,CAACC,KAAK,MAAE,QAAAD,EAAA,uBAAAA,EAAA,CAAAiC,OAAO,EAAE;IACrB,IAAI,CAAC3F,OAAO,CAAC4F,mBAAmB,CAAC,WAAW,EAAE,IAAI,CAACrE,gBAAgB,EAAE;MAAEmD,OAAO,EAAE;IAAI,CAAE,CAAC;IACvF,IAAI,CAACzE,IAAI,CAACiC,GAAG,CAAC0D,mBAAmB,CAAC,WAAW,EAAE,IAAI,CAACpE,gBAAgB,CAAC;IACrE,IAAI,CAACzB,MAAM,CAAC8F,GAAG,CAAC,OAAO,EAAE,IAAI,CAACnE,YAAY,CAAC;IAC3C,IAAI,CAAC3B,MAAM,CAAC8F,GAAG,CAAC,MAAM,EAAE,IAAI,CAAChE,WAAW,CAAC;;AAE5C;AAEY,MAAAiE,gBAAgB,GAAId,OAA8B,IAAI;EACjE,OAAO,IAAIe,MAAM,CAAC;IAChBC,GAAG,EACD,OAAOhB,OAAO,CAACiB,SAAS,KAAK,QAAQ,GAAG,IAAIC,SAAS,CAAClB,OAAO,CAACiB,SAAS,CAAC,GAAGjB,OAAO,CAACiB,SAAS;IAC9FhG,IAAI,EAAEA,IAAI,IAAI,IAAIJ,cAAc,CAAC;MAAEI,IAAI;MAAE,GAAG+E;IAAO,CAAE;EACtD,EAAC;AACJ;;AChTA;;;AAGG;AACU,MAAAmB,UAAU,GAAGC,SAAS,CAACC,MAAM,CAAoB;EAC5DC,IAAI,EAAE,YAAY;EAElBC,UAAUA,CAAA;IACR,OAAO;MACLvG,OAAO,EAAE,IAAI;MACbE,YAAY,EAAE,EAAE;MAChB+F,SAAS,EAAE,YAAY;MACvB9F,WAAW,EAAEqG,SAAS;MACtBpG,UAAU,EAAE;KACb;GACF;EAEDqG,qBAAqBA,CAAA;IACnB,IAAI,CAAC,IAAI,CAACzB,OAAO,CAAChF,OAAO,EAAE;MACzB,OAAO,EAAE;;IAGX,OAAO,CACL8F,gBAAgB,CAAC;MACfG,SAAS,EAAE,IAAI,CAACjB,OAAO,CAACiB,SAAS;MACjClG,MAAM,EAAE,IAAI,CAACA,MAAM;MACnBC,OAAO,EAAE,IAAI,CAACgF,OAAO,CAAChF,OAAO;MAC7BE,YAAY,EAAE,IAAI,CAAC8E,OAAO,CAAC9E,YAAY;MACvCC,WAAW,EAAE,IAAI,CAAC6E,OAAO,CAAC7E,WAAW;MACrCC,UAAU,EAAE,IAAI,CAAC4E,OAAO,CAAC5E;KAC1B,CAAC,CACH;;AAEJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}