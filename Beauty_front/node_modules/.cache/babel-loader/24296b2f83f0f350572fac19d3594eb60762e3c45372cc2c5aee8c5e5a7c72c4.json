{"ast":null,"code":"import { createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"creation-page\"\n};\nconst _hoisted_2 = {\n  class: \"header\"\n};\nconst _hoisted_3 = {\n  class: \"form-section\"\n};\nconst _hoisted_4 = {\n  class: \"upload-box\"\n};\nconst _hoisted_5 = [\"src\"];\nconst _hoisted_6 = {\n  class: \"editor-section\"\n};\nconst _hoisted_7 = {\n  class: \"submit-btn\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_upload = _resolveComponent(\"el-upload\");\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n  const _component_el_option = _resolveComponent(\"el-option\");\n  const _component_el_select = _resolveComponent(\"el-select\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_form = _resolveComponent(\"el-form\");\n  const _component_RichTextEditor = _resolveComponent(\"RichTextEditor\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_el_button, {\n    icon: \"el-icon-arrow-left\",\n    onClick: _cache[0] || (_cache[0] = $event => _ctx.router.back())\n  }, {\n    default: _withCtx(() => _cache[5] || (_cache[5] = [_createTextVNode(\"返回\")])),\n    _: 1 /* STABLE */\n  })]), _createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_form, {\n    model: _ctx.form,\n    \"label-width\": \"80px\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_form_item, {\n      label: \"封面\"\n    }, {\n      default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_4, [_ctx.form.cover_pic ? (_openBlock(), _createElementBlock(\"img\", {\n        key: 0,\n        src: _ctx.form.cover_pic,\n        class: \"cover-img\"\n      }, null, 8 /* PROPS */, _hoisted_5)) : _createCommentVNode(\"v-if\", true), _createVNode(_component_el_upload, {\n        \"http-request\": _ctx.handleUpload,\n        \"show-file-list\": false,\n        accept: \"image/*\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_button, {\n          type: \"primary\"\n        }, {\n          default: _withCtx(() => _cache[6] || (_cache[6] = [_createTextVNode(\"上传封面\")])),\n          _: 1 /* STABLE */\n        })]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"http-request\"])])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, {\n      label: \"分类\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_select, {\n        modelValue: _ctx.form.class_id,\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => _ctx.form.class_id = $event),\n        placeholder: \"请选择分类\",\n        style: {\n          \"width\": \"160px\"\n        }\n      }, {\n        default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.classOptions, cls => {\n          return _openBlock(), _createBlock(_component_el_option, {\n            key: cls.class_id,\n            label: cls.class_name,\n            value: cls.class_id\n          }, null, 8 /* PROPS */, [\"label\", \"value\"]);\n        }), 128 /* KEYED_FRAGMENT */))]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, {\n      label: \"标题\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: _ctx.form.title,\n        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => _ctx.form.title = $event),\n        placeholder: \"1~10字\",\n        maxlength: \"10\",\n        \"show-word-limit\": \"\"\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, {\n      label: \"摘要\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: _ctx.form.abs_text,\n        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => _ctx.form.abs_text = $event),\n        placeholder: \"1~30字\",\n        maxlength: \"30\",\n        \"show-word-limit\": \"\"\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"model\"])]), _createElementVNode(\"div\", _hoisted_6, [_createVNode(_component_RichTextEditor, {\n    ref: \"richEditorRef\",\n    modelValue: _ctx.form.content,\n    \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => _ctx.form.content = $event),\n    visible: _ctx.editorVisible\n  }, null, 8 /* PROPS */, [\"modelValue\", \"visible\"])]), _createElementVNode(\"div\", _hoisted_7, [_createVNode(_component_el_button, {\n    type: \"success\",\n    onClick: _ctx.handleSubmit,\n    loading: _ctx.loading\n  }, {\n    default: _withCtx(() => _cache[7] || (_cache[7] = [_createTextVNode(\"保存修改\")])),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"onClick\", \"loading\"])])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_el_button","icon","onClick","_cache","$event","_ctx","router","back","default","_withCtx","_createTextVNode","_","_hoisted_3","_component_el_form","model","form","_component_el_form_item","label","_hoisted_4","cover_pic","key","src","_hoisted_5","_createCommentVNode","_component_el_upload","handleUpload","accept","type","_component_el_select","modelValue","class_id","placeholder","style","_Fragment","_renderList","classOptions","cls","_createBlock","_component_el_option","class_name","value","_component_el_input","title","maxlength","abs_text","_hoisted_6","_component_RichTextEditor","ref","content","visible","editorVisible","_hoisted_7","handleSubmit","loading"],"sources":["C:\\Users\\32561\\Desktop\\毕设仓库\\beauty-front\\src\\views\\UpdateCreationPage.vue"],"sourcesContent":["<script setup>\r\nimport { shallowRef, watch, onBeforeUnmount, nextTick } from 'vue'\r\nimport { Editor, Toolbar } from '@wangeditor/editor-for-vue'\r\nimport '@wangeditor/editor/dist/css/style.css'\r\nimport { uploadFile } from '@/api/fileUpload'\r\nimport { ElMessage } from 'element-plus'\r\n\r\nconst props = defineProps({\r\n  modelValue: String,\r\n  visible: Boolean\r\n})\r\nconst emit = defineEmits(['update:modelValue'])\r\n\r\nconst editorRef = shallowRef(null)\r\n\r\ndefineExpose({ editorRef })\r\n\r\nconst editorConfig = {\r\n  placeholder: '请输入内容...',\r\n  MENU_CONF: {\r\n    uploadImage: {\r\n      async customUpload(file, insertFn) {\r\n        try {\r\n          const res = await uploadFile(file)\r\n          insertFn(res.data, '', '')\r\n          ElMessage.success('图片上传成功')\r\n        } catch {\r\n          ElMessage.error('图片上传失败')\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst handleEditorChange = (editor) => {\r\n  emit('update:modelValue', editor.getHtml())\r\n}\r\n\r\n// ⛔ 移除 editor.setHtml(props.modelValue) 的旧逻辑，改用下面这个 watch 控制\r\n\r\nconst handleEditorCreated = (editor) => {\r\n  editorRef.value = editor\r\n}\r\n\r\n// ✅ 只在编辑器已创建 & 内容不一致时再 setHtml，防止循环\r\nwatch(\r\n    () => props.modelValue,\r\n    (newVal) => {\r\n      if (editorRef.value && editorRef.value.getHtml() !== newVal) {\r\n        editorRef.value.setHtml(newVal || '<p><br></p>')\r\n      }\r\n    },\r\n    { immediate: true }\r\n)\r\n\r\nwatch(() => props.visible, (val) => {\r\n  if (!val && editorRef.value) {\r\n    editorRef.value.destroy()\r\n    editorRef.value = null\r\n  }\r\n})\r\n\r\nonBeforeUnmount(() => {\r\n  if (editorRef.value) {\r\n    editorRef.value.destroy()\r\n    editorRef.value = null\r\n  }\r\n})\r\n</script>\r\n\r\n\r\n<template>\r\n  <div class=\"creation-page\">\r\n    <div class=\"header\">\r\n      <el-button icon=\"el-icon-arrow-left\" @click=\"router.back()\">返回</el-button>\r\n    </div>\r\n\r\n    <div class=\"form-section\">\r\n      <el-form :model=\"form\" label-width=\"80px\">\r\n        <el-form-item label=\"封面\">\r\n          <div class=\"upload-box\">\r\n            <img v-if=\"form.cover_pic\" :src=\"form.cover_pic\" class=\"cover-img\" />\r\n            <el-upload :http-request=\"handleUpload\" :show-file-list=\"false\" accept=\"image/*\">\r\n              <el-button type=\"primary\">上传封面</el-button>\r\n            </el-upload>\r\n          </div>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"分类\">\r\n          <el-select v-model=\"form.class_id\" placeholder=\"请选择分类\" style=\"width: 160px\">\r\n            <el-option\r\n                v-for=\"cls in classOptions\"\r\n                :key=\"cls.class_id\"\r\n                :label=\"cls.class_name\"\r\n                :value=\"cls.class_id\"\r\n            />\r\n          </el-select>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"标题\">\r\n          <el-input v-model=\"form.title\" placeholder=\"1~10字\" maxlength=\"10\" show-word-limit />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"摘要\">\r\n          <el-input v-model=\"form.abs_text\" placeholder=\"1~30字\" maxlength=\"30\" show-word-limit />\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n\r\n    <div class=\"editor-section\">\r\n      <RichTextEditor\r\n          ref=\"richEditorRef\"\r\n          v-model=\"form.content\"\r\n          :visible=\"editorVisible\"\r\n      />\r\n\r\n    </div>\r\n\r\n    <div class=\"submit-btn\">\r\n      <el-button type=\"success\" @click=\"handleSubmit\" :loading=\"loading\">保存修改</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.creation-page {\r\n  max-width: 1080px;\r\n  margin: 0 auto;\r\n  padding: 20px;\r\n  background-color: #fff;\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.header {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.upload-box {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 20px;\r\n}\r\n\r\n.cover-img {\r\n  width: 200px;\r\n  height: 120px;\r\n  object-fit: cover;\r\n  border-radius: 4px;\r\n  border: 1px solid #eee;\r\n}\r\n\r\n.form-section {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.editor-section {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.submit-btn {\r\n  text-align: center;\r\n  margin-top: 30px;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}