{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport { ref, onMounted, nextTick, onUnmounted } from 'vue';\nimport { throttle } from 'lodash-es';\nimport { useRouter } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nimport { getChatList, getHistory, sendMessage, setMessageRead } from '@/api/prMessage';\nimport { userOtherInfoService, userInfoService } from '@/api/user';\nimport RichTextEditor from \"@/components/RichTextEditor.vue\";\nexport default {\n  __name: 'MyMessage',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const chatList = ref([]);\n    const activeChat = ref(null);\n    const messages = ref([]);\n    const inputMessage = ref('');\n    const pageNum = ref(1);\n    const pageSize = ref(20);\n    const loadingMessages = ref(false);\n    const noMoreMessages = ref(false);\n    const currentUser = ref({});\n    const chatBodyRef = ref(null);\n    const router = useRouter();\n    const throttledScroll = throttle(() => {\n      if (!chatBodyRef.value) return;\n      const {\n        scrollTop,\n        scrollHeight,\n        clientHeight\n      } = chatBodyRef.value;\n      console.log('滚动位置：', {\n        scrollTop,\n        scrollHeight,\n        clientHeight\n      });\n      if (scrollTop <= 10 && !loadingMessages.value && !noMoreMessages.value) {\n        console.log('到顶了，加载更多');\n        pageNum.value += 1;\n        fetchMessages(true);\n      }\n    }, 300);\n    const handleScroll = async () => {\n      if (!chatBodyRef.value) return;\n      const {\n        scrollTop\n      } = chatBodyRef.value;\n      const {\n        scrollHeight,\n        clientHeight\n      } = chatBodyRef.value;\n      console.log('滚动检测中 scrollTop:', scrollTop);\n      if (scrollTop <= 10 && !loadingMessages.value && !noMoreMessages.value) {\n        console.log('到顶了，准备加载更多历史消息');\n        pageNum.value += 1;\n        await fetchMessages(true);\n      }\n    };\n    const goBack = () => router.back();\n    const fetchCurrentUser = async () => {\n      try {\n        const res = await userInfoService();\n        if (res.data) {\n          currentUser.value = res.data;\n        }\n      } catch (err) {\n        if (err?.response?.status !== 401) {\n          console.error('获取当前用户信息失败:', err);\n          ElMessage.error('无法获取当前登录信息');\n        }\n      }\n    };\n    const fetchChatList = async () => {\n      try {\n        const res = await getChatList();\n        if (res.code === 0) {\n          const list = res.data || [];\n          for (const chat of list) {\n            try {\n              const userRes = await userOtherInfoService(chat.target_id);\n              if (userRes.data && userRes.code === 0) {\n                chat.nickname = userRes.data.nickname;\n                chat.user_pic = userRes.data.user_pic;\n              } else {\n                chat.nickname = '未知用户';\n                chat.user_pic = '';\n              }\n            } catch {\n              chat.nickname = '未知用户';\n              chat.user_pic = '';\n            }\n          }\n          chatList.value = list;\n        } else {\n          ElMessage.error(res.msg || '获取聊天列表失败');\n        }\n      } catch (err) {\n        console.error('请求异常:', err);\n        ElMessage.error('网络错误');\n      }\n    };\n    const fetchMessages = async (append = false) => {\n      if (!activeChat.value) return;\n      loadingMessages.value = true;\n      try {\n        const res = await getHistory({\n          pageNum: pageNum.value,\n          pageSize: pageSize.value,\n          target_id: activeChat.value.target_id\n        });\n        if (res.code === 0) {\n          const list = res.data || [];\n          if (list.length === 0 && append) {\n            noMoreMessages.value = true;\n            return;\n          }\n          if (append) {\n            const oldHeight = chatBodyRef.value.scrollHeight;\n            messages.value = [...list.reverse(), ...messages.value];\n            await nextTick();\n            const newHeight = chatBodyRef.value.scrollHeight;\n            chatBodyRef.value.scrollTop = newHeight - oldHeight; // 保持滚动位置\n          } else {\n            messages.value = list.reverse();\n            await nextTick();\n            scrollToBottom();\n          }\n        } else {\n          ElMessage.error(res.msg || '拉取聊天记录失败');\n        }\n      } catch (err) {\n        console.error('获取聊天记录异常:', err);\n        ElMessage.error('网络错误');\n      } finally {\n        loadingMessages.value = false;\n      }\n    };\n    const selectChat = async chat => {\n      activeChat.value = chat;\n      pageNum.value = 1; // 重新选择聊天对象时重置页码\n      messages.value = []; // 清空旧消息\n      await setMessageRead(chat.target_id);\n      await fetchMessages(); // 拉第一页最新的消息\n      await fetchChatList();\n\n      //  拉完后，再绑定 scroll\n      nextTick(() => {\n        if (chatBodyRef.value) {\n          console.log(' selectChat里绑定scroll');\n          chatBodyRef.value.addEventListener('scroll', throttle(handleScroll, 300));\n        }\n      });\n    };\n    const sendMsg = async () => {\n      if (!inputMessage.value.trim() || !activeChat.value) return;\n      try {\n        const content = inputMessage.value.trim();\n        await sendMessage({\n          to_id: activeChat.value.target_id,\n          content\n        });\n        inputMessage.value = '';\n        await fetchMessages();\n        const now = new Date().toISOString().slice(0, 19).replace('T', ' ');\n        activeChat.value.lastMessage = content;\n        activeChat.value.lastTime = now;\n        const chat = chatList.value.find(c => c.target_id === activeChat.value.target_id);\n        if (chat) {\n          chat.lastMessage = content;\n          chat.lastTime = now;\n          chatList.value = [chat, ...chatList.value.filter(c => c.target_id !== chat.target_id)];\n        }\n        await nextTick();\n        scrollToBottom();\n      } catch (err) {\n        ElMessage.error('发送失败');\n      }\n    };\n    const scrollToBottom = () => {\n      if (chatBodyRef.value) {\n        chatBodyRef.value.scrollTop = chatBodyRef.value.scrollHeight;\n      }\n    };\n    onMounted(async () => {\n      await fetchCurrentUser();\n      await fetchChatList();\n    });\n    onUnmounted(() => {\n      if (chatBodyRef.value) {\n        chatBodyRef.value.removeEventListener('scroll', throttledScroll);\n      }\n    });\n    const __returned__ = {\n      chatList,\n      activeChat,\n      messages,\n      inputMessage,\n      pageNum,\n      pageSize,\n      loadingMessages,\n      noMoreMessages,\n      currentUser,\n      chatBodyRef,\n      router,\n      throttledScroll,\n      handleScroll,\n      goBack,\n      fetchCurrentUser,\n      fetchChatList,\n      fetchMessages,\n      selectChat,\n      sendMsg,\n      scrollToBottom,\n      ref,\n      onMounted,\n      nextTick,\n      onUnmounted,\n      get throttle() {\n        return throttle;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get getChatList() {\n        return getChatList;\n      },\n      get getHistory() {\n        return getHistory;\n      },\n      get sendMessage() {\n        return sendMessage;\n      },\n      get setMessageRead() {\n        return setMessageRead;\n      },\n      get userOtherInfoService() {\n        return userOtherInfoService;\n      },\n      get userInfoService() {\n        return userInfoService;\n      },\n      RichTextEditor\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","nextTick","onUnmounted","throttle","useRouter","ElMessage","getChatList","getHistory","sendMessage","setMessageRead","userOtherInfoService","userInfoService","RichTextEditor","chatList","activeChat","messages","inputMessage","pageNum","pageSize","loadingMessages","noMoreMessages","currentUser","chatBodyRef","router","throttledScroll","value","scrollTop","scrollHeight","clientHeight","console","log","fetchMessages","handleScroll","goBack","back","fetchCurrentUser","res","data","err","response","status","error","fetchChatList","code","list","chat","userRes","target_id","nickname","user_pic","msg","append","length","oldHeight","reverse","newHeight","scrollToBottom","selectChat","addEventListener","sendMsg","trim","content","to_id","now","Date","toISOString","slice","replace","lastMessage","lastTime","find","c","filter","removeEventListener"],"sources":["C:/Users/32561/Desktop/毕设仓库/beauty-front/src/views/Mine/MyMessage.vue"],"sourcesContent":["<script setup>\r\nimport { ref, onMounted, nextTick, onUnmounted } from 'vue'\r\nimport { throttle } from 'lodash-es'\r\nimport { useRouter } from 'vue-router'\r\nimport { ElMessage } from 'element-plus'\r\nimport { getChatList, getHistory, sendMessage, setMessageRead } from '@/api/prMessage'\r\nimport { userOtherInfoService, userInfoService } from '@/api/user'\r\nimport RichTextEditor from \"@/components/RichTextEditor.vue\";\r\n\r\nconst chatList = ref([])\r\nconst activeChat = ref(null)\r\nconst messages = ref([])\r\nconst inputMessage = ref('')\r\nconst pageNum = ref(1)\r\nconst pageSize = ref(20)\r\nconst loadingMessages = ref(false)\r\nconst noMoreMessages = ref(false)\r\nconst currentUser = ref({})\r\nconst chatBodyRef = ref(null)\r\nconst router = useRouter()\r\n\r\nconst throttledScroll = throttle(() => {\r\n  if (!chatBodyRef.value) return;\r\n\r\n  const { scrollTop, scrollHeight, clientHeight } = chatBodyRef.value;\r\n  console.log('滚动位置：', { scrollTop, scrollHeight, clientHeight });\r\n\r\n  if (scrollTop <= 10 && !loadingMessages.value && !noMoreMessages.value) {\r\n    console.log('到顶了，加载更多')\r\n    pageNum.value += 1\r\n    fetchMessages(true)\r\n  }\r\n}, 300);\r\n\r\nconst handleScroll = async () => {\r\n  if (!chatBodyRef.value) return;\r\n  const { scrollTop } = chatBodyRef.value;\r\n  const { scrollHeight, clientHeight } = chatBodyRef.value;\r\n\r\n  console.log('滚动检测中 scrollTop:', scrollTop)\r\n\r\n  if (scrollTop <= 10 && !loadingMessages.value && !noMoreMessages.value) {\r\n    console.log('到顶了，准备加载更多历史消息')\r\n    pageNum.value += 1\r\n    await fetchMessages(true)\r\n  }\r\n}\r\n\r\nconst goBack = () => router.back()\r\n\r\nconst fetchCurrentUser = async () => {\r\n  try {\r\n    const res = await userInfoService()\r\n    if (res.data) {\r\n      currentUser.value = res.data\r\n    }\r\n  } catch (err) {\r\n    if (err?.response?.status !== 401) {\r\n      console.error('获取当前用户信息失败:', err)\r\n      ElMessage.error('无法获取当前登录信息')\r\n    }\r\n  }\r\n}\r\n\r\nconst fetchChatList = async () => {\r\n  try {\r\n    const res = await getChatList()\r\n    if (res.code === 0) {\r\n      const list = res.data || []\r\n      for (const chat of list) {\r\n        try {\r\n          const userRes = await userOtherInfoService(chat.target_id)\r\n          if (userRes.data && userRes.code === 0) {\r\n            chat.nickname = userRes.data.nickname\r\n            chat.user_pic = userRes.data.user_pic\r\n          } else {\r\n            chat.nickname = '未知用户'\r\n            chat.user_pic = ''\r\n          }\r\n        } catch {\r\n          chat.nickname = '未知用户'\r\n          chat.user_pic = ''\r\n        }\r\n      }\r\n      chatList.value = list\r\n    } else {\r\n      ElMessage.error(res.msg || '获取聊天列表失败')\r\n    }\r\n  } catch (err) {\r\n    console.error('请求异常:', err)\r\n    ElMessage.error('网络错误')\r\n  }\r\n}\r\n\r\nconst fetchMessages = async (append = false) => {\r\n  if (!activeChat.value) return\r\n  loadingMessages.value = true\r\n  try {\r\n    const res = await getHistory({\r\n      pageNum: pageNum.value,\r\n      pageSize: pageSize.value,\r\n      target_id: activeChat.value.target_id\r\n    })\r\n    if (res.code === 0) {\r\n      const list = res.data || []\r\n\r\n      if (list.length === 0 && append) {\r\n        noMoreMessages.value = true\r\n        return\r\n      }\r\n\r\n      if (append) {\r\n        const oldHeight = chatBodyRef.value.scrollHeight\r\n        messages.value = [...list.reverse(), ...messages.value]\r\n        await nextTick()\r\n        const newHeight = chatBodyRef.value.scrollHeight\r\n        chatBodyRef.value.scrollTop = newHeight - oldHeight // 保持滚动位置\r\n      } else {\r\n        messages.value = list.reverse()\r\n        await nextTick()\r\n        scrollToBottom()\r\n      }\r\n    } else {\r\n      ElMessage.error(res.msg || '拉取聊天记录失败')\r\n    }\r\n  } catch (err) {\r\n    console.error('获取聊天记录异常:', err)\r\n    ElMessage.error('网络错误')\r\n  } finally {\r\n    loadingMessages.value = false\r\n  }\r\n}\r\n\r\nconst selectChat = async (chat) => {\r\n  activeChat.value = chat\r\n  pageNum.value = 1 // 重新选择聊天对象时重置页码\r\n  messages.value = [] // 清空旧消息\r\n  await setMessageRead(chat.target_id)\r\n  await fetchMessages() // 拉第一页最新的消息\r\n  await fetchChatList()\r\n\r\n  //  拉完后，再绑定 scroll\r\n  nextTick(() => {\r\n    if (chatBodyRef.value) {\r\n      console.log(' selectChat里绑定scroll')\r\n      chatBodyRef.value.addEventListener('scroll', throttle(handleScroll, 300))\r\n    }\r\n  })\r\n}\r\n\r\n\r\nconst sendMsg = async () => {\r\n  if (!inputMessage.value.trim() || !activeChat.value) return\r\n  try {\r\n    const content = inputMessage.value.trim()\r\n    await sendMessage({\r\n      to_id: activeChat.value.target_id,\r\n      content\r\n    })\r\n    inputMessage.value = ''\r\n    await fetchMessages()\r\n\r\n    const now = new Date().toISOString().slice(0, 19).replace('T', ' ')\r\n    activeChat.value.lastMessage = content\r\n    activeChat.value.lastTime = now\r\n\r\n    const chat = chatList.value.find(c => c.target_id === activeChat.value.target_id)\r\n    if (chat) {\r\n      chat.lastMessage = content\r\n      chat.lastTime = now\r\n      chatList.value = [chat, ...chatList.value.filter(c => c.target_id !== chat.target_id)]\r\n    }\r\n\r\n    await nextTick()\r\n    scrollToBottom()\r\n  } catch (err) {\r\n    ElMessage.error('发送失败')\r\n  }\r\n}\r\n\r\nconst scrollToBottom = () => {\r\n  if (chatBodyRef.value) {\r\n    chatBodyRef.value.scrollTop = chatBodyRef.value.scrollHeight\r\n  }\r\n}\r\n\r\n\r\n\r\nonMounted(async () => {\r\n  await fetchCurrentUser()\r\n  await fetchChatList()\r\n})\r\n\r\nonUnmounted(() => {\r\n  if (chatBodyRef.value) {\r\n    chatBodyRef.value.removeEventListener('scroll', throttledScroll)\r\n  }\r\n})\r\n\r\n</script>\r\n\r\n\r\n<template>\r\n  <div class=\"main-content\">\r\n    <el-button type=\"primary\" plain class=\"back-btn\" @click=\"goBack\">\r\n      返回\r\n    </el-button>\r\n    <div class=\"message-page\">\r\n      <div class=\"chat-list\">\r\n        <div\r\n            v-for=\"chat in chatList\"\r\n            :key=\"chat.target_id\"\r\n            class=\"chat-item\"\r\n            :class=\"{ active: activeChat && activeChat.target_id === chat.target_id }\"\r\n            @click=\"selectChat(chat)\"\r\n        >\r\n          <el-avatar :src=\"chat.user_pic\" size=\"large\">{{ chat.nickname ? chat.nickname[0] : '?' }}</el-avatar>\r\n          <div class=\"chat-info\">\r\n            <div class=\"chat-name\">{{ chat.nickname }}</div>\r\n            <div class=\"chat-last\" v-html=\"chat.lastMessage\"></div>\r\n          </div>\r\n          <el-badge :value=\"chat.unReadCount\" v-if=\"chat.unReadCount > 0\"/>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"chat-window\" v-if=\"activeChat\">\r\n        <div class=\"chat-header\">\r\n          与 {{ activeChat.nickname }} 的聊天\r\n        </div>\r\n\r\n        <div class=\"chat-body\" ref=\"chatBodyRef\" v-loading=\"loadingMessages\">\r\n          <div v-for=\"msg in messages\" :key=\"msg.message_id\" class=\"chat-message\"\r\n               :class=\"{ 'me': msg.from_id === currentUser.user_id }\">\r\n            <div class=\"chat-content\" v-html=\"msg.content\"></div>\r\n            <div class=\"chat-time\">{{ new Date(msg.created_at).toLocaleString() }}</div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"chat-input\">\r\n          <RichTextEditor\r\n              v-model=\"inputMessage\"\r\n              style=\"height: 200px\"\r\n              :visible=\"true\"\r\n          />\r\n          <el-button type=\"primary\" @click=\"sendMsg\" style=\"height: 60px ;margin-top: 10px;\">发送</el-button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"chat-window\" v-else>\r\n        <div class=\"chat-placeholder\">请选择一个聊天</div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.main-content {\r\n  flex: 1;\r\n  width: 1720px;\r\n  margin: 0 auto;\r\n  background: #f5f7fa;\r\n}\r\n.message-page {\r\n  display: flex;\r\n  width: 1720px;\r\n  margin: 0 auto;\r\n  margin-bottom: 10px;\r\n  height: 86vh;\r\n  background: #f5f7fa;\r\n}\r\n\r\n.chat-list {\r\n  width: 300px;\r\n  background: white;\r\n  border-right: 1px solid #ddd;\r\n  overflow-y: auto;\r\n}\r\n\r\n.chat-item {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 15px;\r\n  cursor: pointer;\r\n  border-bottom: 1px solid #eee;\r\n  transition: background-color 0.3s, box-shadow 0.3s;\r\n}\r\n\r\n.chat-item:hover {\r\n  background: #f0faff;\r\n}\r\n\r\n.chat-item.active {\r\n  background: #e6f7ff;\r\n  box-shadow: inset 4px 0 0 #409eff; /* 左边一条蓝色高亮条 */\r\n}\r\n\r\n.chat-info {\r\n  margin-left: 10px;\r\n  flex: 1;\r\n  overflow: hidden;\r\n}\r\n\r\n.chat-name {\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n}\r\n\r\n.chat-last {\r\n  color: #999;\r\n  font-size: 12px;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n}\r\n\r\n\r\n.chat-window {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.chat-header {\r\n  background: white;\r\n  padding: 15px;\r\n  border-bottom: 1px solid #ddd;\r\n  font-weight: bold;\r\n}\r\n\r\n.chat-body {\r\n  flex: 1;\r\n  height: 0;\r\n  min-height: 0;\r\n  max-height: calc(86vh - 160px);\r\n  overflow-y: auto;\r\n  padding: 15px;\r\n  background: #f9f9f9;\r\n}\r\n\r\n\r\n.chat-message {\r\n  margin-bottom: 10px;\r\n  max-width: 60%;\r\n  word-break: break-word;\r\n}\r\n\r\n.chat-message.me {\r\n  margin-left: auto;\r\n  text-align: right;\r\n}\r\n\r\n.chat-content {\r\n  display: inline-block;\r\n  background: #409eff;\r\n  color: white;\r\n  padding: 10px;\r\n  border-radius: 8px;\r\n}\r\n\r\n.chat-message.me .chat-content {\r\n  background: #67c23a;\r\n}\r\n\r\n.chat-time {\r\n  font-size: 10px;\r\n  color: #999;\r\n  margin-top: 5px;\r\n}\r\n\r\n.chat-input {\r\n  display: flex;\r\n  padding: 15px;\r\n  background: white;\r\n  border-top: 1px solid #ddd;\r\n}\r\n\r\n.chat-placeholder {\r\n  margin: auto;\r\n  font-size: 20px;\r\n  color: #ccc;\r\n}\r\n\r\n.back-btn {\r\n  margin: 5px;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}