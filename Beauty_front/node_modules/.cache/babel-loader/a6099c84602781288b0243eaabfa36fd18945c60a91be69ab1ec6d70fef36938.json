{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nimport { myOfflineList, improveOffline, delOffline } from '@/api/offline';\nimport { uploadFile } from '@/api/fileUpload';\nimport RichTextEditor from '@/components/RichTextEditor.vue';\nexport default {\n  __name: 'MyOffline',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const tableData = ref([]);\n    const pageNum = ref(1);\n    const pageSize = ref(15);\n    const total = ref(0);\n    const decodeAndCleanHTML = htmlStr => {\n      const textarea = document.createElement('textarea');\n      textarea.innerHTML = htmlStr;\n      const decoded = textarea.value;\n\n      // 清理掉真正没内容的空段落，但保留 <p><br></p>\n      return decoded.replace(/<p>(&nbsp;|\\s|<span[^>]*><\\/span>)*<\\/p>/gi, '');\n    };\n    const fetchOfflineStores = async () => {\n      try {\n        const res = await myOfflineList({\n          pageNum: pageNum.value,\n          pageSize: pageSize.value\n        });\n        tableData.value = res.data.items || [];\n        total.value = res.data.total || 0;\n      } catch (err) {\n        ElMessage.error(err.msg || '获取门店信息失败');\n      }\n    };\n    const handlePageChange = newPage => {\n      pageNum.value = newPage;\n      fetchOfflineStores();\n    };\n    const editDialogVisible = ref(false);\n    const editForm = ref({\n      offline_id: '',\n      offline_name: '',\n      offline_phone: '',\n      offline_position: '',\n      offline_pic: '',\n      offline_content: ''\n    });\n    const openEditDialog = store => {\n      editForm.value = {\n        ...store,\n        offline_content: decodeAndCleanHTML(store.offline_content)\n      };\n      editDialogVisible.value = true;\n    };\n    const handleCustomUpload = async ({\n      file\n    }) => {\n      try {\n        const res = await uploadFile(file);\n        editForm.value.offline_pic = res.data;\n        ElMessage.success('上传成功');\n      } catch (err) {\n        ElMessage.error('上传失败');\n      }\n    };\n    const saveStoreChanges = async () => {\n      try {\n        editForm.value.offline_content = decodeAndCleanHTML(editForm.value.offline_content); // 修复这里\n        await improveOffline(editForm.value);\n        ElMessage.success('更新成功');\n        editDialogVisible.value = false;\n        fetchOfflineStores();\n      } catch (err) {\n        ElMessage.error(err.msg || '更新失败');\n      }\n    };\n    const viewDetails = store => {\n      router.push(`/content/offline/${store.offline_id}`);\n    };\n    const manageMembers = store => {\n      router.push(`/myOffline/${store.offline_id}/members`);\n    };\n    const cancelStore = store => {\n      ElMessageBox.confirm(`确认要注销门店「${store.offline_name}」吗？`, '提示', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async () => {\n        try {\n          await delOffline(store.offline_id);\n          ElMessage.success('门店注销成功');\n          fetchOfflineStores();\n        } catch (err) {\n          ElMessage.error(err.msg || '注销失败');\n        }\n      }).catch(() => {});\n    };\n    onMounted(() => {\n      fetchOfflineStores();\n    });\n    const __returned__ = {\n      router,\n      tableData,\n      pageNum,\n      pageSize,\n      total,\n      decodeAndCleanHTML,\n      fetchOfflineStores,\n      handlePageChange,\n      editDialogVisible,\n      editForm,\n      openEditDialog,\n      handleCustomUpload,\n      saveStoreChanges,\n      viewDetails,\n      manageMembers,\n      cancelStore,\n      ref,\n      onMounted,\n      get useRouter() {\n        return useRouter;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get ElMessageBox() {\n        return ElMessageBox;\n      },\n      get myOfflineList() {\n        return myOfflineList;\n      },\n      get improveOffline() {\n        return improveOffline;\n      },\n      get delOffline() {\n        return delOffline;\n      },\n      get uploadFile() {\n        return uploadFile;\n      },\n      RichTextEditor\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","useRouter","ElMessage","ElMessageBox","myOfflineList","improveOffline","delOffline","uploadFile","RichTextEditor","router","tableData","pageNum","pageSize","total","decodeAndCleanHTML","htmlStr","textarea","document","createElement","innerHTML","decoded","value","replace","fetchOfflineStores","res","data","items","err","error","msg","handlePageChange","newPage","editDialogVisible","editForm","offline_id","offline_name","offline_phone","offline_position","offline_pic","offline_content","openEditDialog","store","handleCustomUpload","file","success","saveStoreChanges","viewDetails","push","manageMembers","cancelStore","confirm","confirmButtonText","cancelButtonText","type","then","catch"],"sources":["C:/Users/32561/Desktop/毕设仓库/beauty-front/src/views/Mine/MyOffline.vue"],"sourcesContent":["<script setup>\r\nimport {ref, onMounted} from 'vue'\r\nimport {useRouter} from 'vue-router'\r\nimport {ElMessage, ElMessageBox} from 'element-plus'\r\nimport {myOfflineList, improveOffline, delOffline} from '@/api/offline'\r\nimport {uploadFile} from '@/api/fileUpload'\r\nimport RichTextEditor from '@/components/RichTextEditor.vue'\r\n\r\nconst router = useRouter()\r\nconst tableData = ref([])\r\nconst pageNum = ref(1)\r\nconst pageSize = ref(15)\r\nconst total = ref(0)\r\n\r\nconst decodeAndCleanHTML = (htmlStr) => {\r\n  const textarea = document.createElement('textarea')\r\n  textarea.innerHTML = htmlStr\r\n  const decoded = textarea.value\r\n\r\n  // 清理掉真正没内容的空段落，但保留 <p><br></p>\r\n  return decoded.replace(/<p>(&nbsp;|\\s|<span[^>]*><\\/span>)*<\\/p>/gi, '')\r\n}\r\n\r\n\r\nconst fetchOfflineStores = async () => {\r\n  try {\r\n    const res = await myOfflineList({pageNum: pageNum.value, pageSize: pageSize.value})\r\n    tableData.value = res.data.items || []\r\n    total.value = res.data.total || 0\r\n  } catch (err) {\r\n    ElMessage.error(err.msg || '获取门店信息失败')\r\n  }\r\n}\r\n\r\nconst handlePageChange = (newPage) => {\r\n  pageNum.value = newPage\r\n  fetchOfflineStores()\r\n}\r\n\r\nconst editDialogVisible = ref(false)\r\nconst editForm = ref({\r\n  offline_id: '',\r\n  offline_name: '',\r\n  offline_phone: '',\r\n  offline_position: '',\r\n  offline_pic: '',\r\n  offline_content: ''\r\n})\r\n\r\nconst openEditDialog = (store) => {\r\n  editForm.value = {\r\n    ...store,\r\n    offline_content: decodeAndCleanHTML(store.offline_content)\r\n  }\r\n  editDialogVisible.value = true\r\n}\r\n\r\nconst handleCustomUpload = async ({file}) => {\r\n  try {\r\n    const res = await uploadFile(file)\r\n    editForm.value.offline_pic = res.data\r\n    ElMessage.success('上传成功')\r\n  } catch (err) {\r\n    ElMessage.error('上传失败')\r\n  }\r\n}\r\n\r\nconst saveStoreChanges = async () => {\r\n  try {\r\n    editForm.value.offline_content = decodeAndCleanHTML(editForm.value.offline_content) // 修复这里\r\n    await improveOffline(editForm.value)\r\n    ElMessage.success('更新成功')\r\n    editDialogVisible.value = false\r\n    fetchOfflineStores()\r\n  } catch (err) {\r\n    ElMessage.error(err.msg || '更新失败')\r\n  }\r\n}\r\n\r\n\r\nconst viewDetails = (store) => {\r\n  router.push(`/content/offline/${store.offline_id}`)\r\n}\r\n\r\nconst manageMembers = (store) => {\r\n  router.push(`/myOffline/${store.offline_id}/members`)\r\n}\r\n\r\nconst cancelStore = (store) => {\r\n  ElMessageBox.confirm(\r\n      `确认要注销门店「${store.offline_name}」吗？`,\r\n      '提示',\r\n      {\r\n        confirmButtonText: '确认',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }\r\n  ).then(async () => {\r\n    try {\r\n      await delOffline(store.offline_id)\r\n      ElMessage.success('门店注销成功')\r\n      fetchOfflineStores()\r\n    } catch (err) {\r\n      ElMessage.error(err.msg || '注销失败')\r\n    }\r\n  }).catch(() => {\r\n  })\r\n}\r\n\r\nonMounted(() => {\r\n  fetchOfflineStores()\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div class=\"main-content\">\r\n    <el-button\r\n        class=\"back-btn\"\r\n        type=\"primary\"\r\n        icon=\"el-icon-arrow-left\"\r\n        plain\r\n        @click=\"() => router.push('/')\"\r\n    >\r\n      返回首页\r\n    </el-button>\r\n\r\n    <div class=\"section-title\">我的门店</div>\r\n\r\n    <el-table :data=\"tableData\" style=\"width: 100%; margin-top: 10px\">\r\n      <el-table-column prop=\"offline_id\" label=\"门店ID\" width=\"100\"/>\r\n      <el-table-column prop=\"offline_name\" label=\"门店名称\" width=\"180\"/>\r\n      <el-table-column prop=\"offline_position\" label=\"门店地址\" width=\"360\"/>\r\n      <el-table-column prop=\"offline_city\" label=\"所在城市\" width=\"160\"/>\r\n      <el-table-column prop=\"offline_phone\" label=\"联系电话\" width=\"240\"/>\r\n      <el-table-column label=\"操作\" width=\"400\">\r\n        <template #default=\"{ row }\">\r\n          <el-button size=\"small\" @click=\"viewDetails(row)\">查看详情</el-button>\r\n          <el-button size=\"small\" type=\"primary\" @click=\"openEditDialog(row)\">编辑</el-button>\r\n          <el-button size=\"small\" type=\"warning\" @click=\"manageMembers(row)\">成员管理</el-button>\r\n          <el-button size=\"small\" type=\"danger\" @click=\"cancelStore(row)\">注销</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <div style=\"text-align: center; margin-top: 20px\">\r\n      <el-pagination\r\n          background\r\n          layout=\"prev, pager, next, ->, total\"\r\n          :total=\"total\"\r\n          :current-page=\"pageNum\"\r\n          :page-size=\"pageSize\"\r\n          @current-change=\"handlePageChange\"\r\n      />\r\n    </div>\r\n\r\n    <!-- 编辑门店弹窗 -->\r\n    <el-dialog v-model=\"editDialogVisible\" title=\"编辑门店\" width=\"90%\" top=\"5vh\">\r\n      <div class=\"edit-store-container\">\r\n        <div class=\"top-section\">\r\n          <div class=\"left\">\r\n            <img v-if=\"editForm.offline_pic\" :src=\"editForm.offline_pic\" class=\"preview-pic\"/>\r\n            <el-upload\r\n                :show-file-list=\"false\"\r\n                :http-request=\"handleCustomUpload\"\r\n                accept=\"image/*\"\r\n            >\r\n              <el-button type=\"primary\">上传封面</el-button>\r\n            </el-upload>\r\n          </div>\r\n          <div class=\"right\">\r\n            <label>门店名称</label>\r\n            <el-input v-model=\"editForm.offline_name\" placeholder=\"门店名称\" style=\"margin-bottom: 12px\"/>\r\n            <label>门店地址</label>\r\n            <el-input v-model=\"editForm.offline_position\" placeholder=\"门店地址\" style=\"margin-bottom: 12px\"/>\r\n            <label>联系电话</label>\r\n            <el-input v-model=\"editForm.offline_phone\" placeholder=\"联系电话\" style=\"margin-bottom: 12px\"/>\r\n          </div>\r\n        </div>\r\n        <div class=\"bottom-section\">\r\n          <RichTextEditor v-model=\"editForm.offline_content\" :visible=\"editDialogVisible\"/>\r\n        </div>\r\n      </div>\r\n      <template #footer>\r\n        <el-button @click=\"editDialogVisible = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"saveStoreChanges\">更新门店信息</el-button>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.main-content {\r\n  flex: 1;\r\n  width: 1720px;\r\n  height: 780px;\r\n  margin: 0 auto;\r\n  margin-bottom: 10px;\r\n  background: #f5f7fa;\r\n  padding: 20px;\r\n}\r\n\r\n.section-title {\r\n  font-size: 20px;\r\n  font-weight: bold;\r\n  background-color: #eef1f6;\r\n  padding: 10px 15px;\r\n  border-left: 5px solid #409EFF;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.back-btn {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.edit-store-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 20px;\r\n}\r\n\r\n.top-section {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  gap: 30px;\r\n}\r\n\r\n.left {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 10px;\r\n}\r\n\r\n.right {\r\n  flex: 2;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.preview-pic {\r\n  width: 240px;\r\n  height: 140px;\r\n  object-fit: cover;\r\n  border-radius: 8px;\r\n  border: 1px solid #ddd;\r\n}\r\n\r\n.bottom-section {\r\n  border: 1px solid #dcdfe6;\r\n  padding: 10px;\r\n  border-radius: 6px;\r\n}\r\n\r\n\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}